<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Flag.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">jacocoReport</a> &gt; <a href="index.source.html" class="el_package">net.sf.freecol.client.gui.panel</a> &gt; <span class="el_source">Flag.java</span></div><h1>Flag.java</h1><pre class="source lang-java linenums">/**
 *  Copyright (C) 2002-2015   The FreeCol Team
 *
 *  This file is part of FreeCol.
 *
 *  FreeCol is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation, either version 2 of the License, or
 *  (at your option) any later version.
 *
 *  FreeCol is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License
 *  along with FreeCol.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
 */

package net.sf.freecol.client.gui.panel;

import java.awt.Color;
import java.awt.geom.AffineTransform;
import java.awt.geom.GeneralPath;
import java.awt.geom.Rectangle2D;
import java.awt.Graphics2D;
import java.awt.image.BufferedImage;
import java.awt.RenderingHints;
import java.util.ArrayList;
import java.util.EnumSet;
import java.util.List;
import java.util.Set;

/**
 * This class generates the most common types of flags from a small number of
 * parameters, biased towards flags similar to that of the United States, i.e.
 * flags with a &quot;union&quot;, an area filled with stars representing the colonies of
 * the player. Obvious improvements include adding shapes other than stars (e.g.
 * the fleur-de-lys for Quebec) and larger design elements, such as the Southern
 * Cross, or coats of arms.
 *
 * Please feel free to correct any vexillological errors.
 */
public class Flag {

	/**
	 * The alignment of stripes or other design elements on the flag. Might be
	 * extended to handle diagonal alignment (Friesland, for example).
	 */
<span class="nc" id="L50">	public enum Alignment {</span>

		/** The none. */
<span class="nc" id="L53">		NONE,</span>

		/** The horizontal. */
<span class="nc" id="L56">		HORIZONTAL,</span>

		/** The vertical. */
<span class="nc" id="L59">		VERTICAL</span>
	};

	/**
	 * The &quot;background layer&quot; of the flag, generally one or several squares or
	 * triangles of different color. The alignment of the background influences
	 * the size of the canton, if there is one.
	 */
<span class="nc" id="L67">	public enum Background {</span>
		/** A plain background. */
<span class="nc" id="L69">		PLAIN(Alignment.NONE),</span>
		/** Quartered rectangularly. */
<span class="nc" id="L71">		QUARTERLY(Alignment.NONE),</span>
		/** Vertical stripes. */
<span class="nc" id="L73">		PALES(Alignment.VERTICAL),</span>
		/** Horizontal stripes. */
<span class="nc" id="L75">		FESSES(Alignment.HORIZONTAL),</span>
		/** Diagonal top left to bottom right. */
<span class="nc" id="L77">		PER_BEND(Alignment.NONE),</span>
		/** Diagonal bottom left to top right. */
<span class="nc" id="L79">		PER_BEND_SINISTER(Alignment.NONE),</span>
		/** Quartered diagonally. */
<span class="nc" id="L81">		PER_SALTIRE(Alignment.NONE);</span>

		/** The alignment. */
		public final Alignment alignment;

		/**
		 * Instantiates a new background.
		 *
		 * @param alignment
		 *            the alignment
		 */
<span class="nc" id="L92">		Background(Alignment alignment) {</span>
<span class="nc" id="L93">			this.alignment = alignment;</span>
<span class="nc" id="L94">		}</span>
	};

	/**
	 * The &quot;middle layer&quot; of the flag, generally a number of vertical,
	 * horizontal or diagonal bars. The decoration limits the shape and possible
	 * positions of the &quot;union&quot;.
	 */
<span class="nc" id="L102">	public enum Decoration {</span>

		/** The none. */
<span class="nc" id="L105">		NONE(),</span>

		/** The cross. */
<span class="nc" id="L108">		CROSS(UnionPosition.CANTON),</span>

		/** The greek cross. */
<span class="nc" id="L111">		GREEK_CROSS(UnionPosition.CANTON),</span>

		/** The scandinavian cross. */
<span class="nc" id="L114">		SCANDINAVIAN_CROSS(UnionPosition.CANTON),</span>

		/** The chevron. */
<span class="nc" id="L117">		CHEVRON(UnionShape.CHEVRON, UnionPosition.LEFT),</span>

		/** The pall. */
<span class="nc" id="L120">		PALL(UnionShape.CHEVRON, UnionPosition.LEFT),</span>

		/** The bend. */
<span class="nc" id="L123">		BEND(UnionShape.BEND, UnionPosition.TOP, UnionPosition.BOTTOM),</span>

		/** The bend sinister. */
<span class="nc" id="L126">		BEND_SINISTER(UnionShape.BEND, UnionPosition.TOP, UnionPosition.BOTTOM),</span>

		/** The saltire. */
<span class="nc" id="L129">		SALTIRE(UnionShape.CHEVRON, UnionPosition.TOP, UnionPosition.BOTTOM, UnionPosition.LEFT, UnionPosition.RIGHT),</span>

		/** The saltire and cross. */
<span class="nc" id="L132">		SALTIRE_AND_CROSS(UnionPosition.CANTON);</span>

		/** The union shape. */
<span class="nc" id="L135">		public UnionShape unionShape = UnionShape.RECTANGLE;</span>

		/** The union positions. */
<span class="nc" id="L138">		public Set&lt;UnionPosition&gt; unionPositions = EnumSet.allOf(UnionPosition.class);</span>

		/**
		 * Instantiates a new decoration.
		 *
		 * @param positions
		 *            the positions
		 */
<span class="nc" id="L146">		Decoration(UnionPosition... positions) {</span>
<span class="nc" id="L147">			this.unionPositions = EnumSet.of(UnionPosition.NONE);</span>
<span class="nc bnc" id="L148" title="All 2 branches missed.">			for (UnionPosition position : positions) {</span>
<span class="nc" id="L149">				unionPositions.add(position);</span>
			}
<span class="nc" id="L151">		}</span>

		/**
		 * Instantiates a new decoration.
		 *
		 * @param shape
		 *            the shape
		 * @param positions
		 *            the positions
		 */
		Decoration(UnionShape shape, UnionPosition... positions) {
<span class="nc" id="L162">			this(positions);</span>
<span class="nc" id="L163">			this.unionShape = shape;</span>
<span class="nc" id="L164">		}</span>

	};

	/**
	 * The shape of the &quot;union&quot;, which generally depends on the decoration or
	 * background of the flag.
	 */
<span class="nc" id="L172">	public enum UnionShape {</span>

		/** The rectangle. */
<span class="nc" id="L175">		RECTANGLE,</span>

		/** The triangle. */
<span class="nc" id="L178">		TRIANGLE,</span>

		/** The chevron. */
<span class="nc" id="L181">		CHEVRON,</span>

		/** The bend. */
<span class="nc" id="L184">		BEND,</span>

		/** The rhombus. */
<span class="nc" id="L187">		RHOMBUS</span>
	};

	/**
	 * The position of the &quot;union&quot;, which depends on the alignment of the
	 * background. The &quot;canton&quot; is the top left quarter of the flag. Other
	 * quarters might be added.
	 */
<span class="nc" id="L195">	public enum UnionPosition {</span>

		/** The left. */
<span class="nc" id="L198">		LEFT(Alignment.VERTICAL, 0),</span>

		/** The center. */
<span class="nc" id="L201">		CENTER(Alignment.VERTICAL, 1),</span>

		/** The right. */
<span class="nc" id="L204">		RIGHT(Alignment.VERTICAL, 2),</span>

		/** The top. */
<span class="nc" id="L207">		TOP(Alignment.HORIZONTAL, 0),</span>

		/** The middle. */
<span class="nc" id="L210">		MIDDLE(Alignment.HORIZONTAL, 1),</span>

		/** The bottom. */
<span class="nc" id="L213">		BOTTOM(Alignment.HORIZONTAL, 2),</span>

		/** The canton. */
<span class="nc" id="L216">		CANTON(Alignment.NONE, 0),</span>

		/** The none. */
<span class="nc" id="L219">		NONE(null, 0);</span>

		/** The alignment. */
		public final Alignment alignment;

		/** The index. */
		public final int index;

		/**
		 * Instantiates a new union position.
		 *
		 * @param alignment
		 *            the alignment
		 * @param index
		 *            the index
		 */
<span class="nc" id="L235">		UnionPosition(Alignment alignment, int index) {</span>
<span class="nc" id="L236">			this.alignment = alignment;</span>
<span class="nc" id="L237">			this.index = index;</span>
<span class="nc" id="L238">		}</span>

	}

	/**
	 * Width and height are used in the usual sense, not the vexillological
	 * sense.
	 */
	public static final int WIDTH = 150;

	/** The Constant HEIGHT. */
	public static final int HEIGHT = 100;

	/** The Constant SQRT_3. */
<span class="nc" id="L252">	public static final double SQRT_3 = Math.sqrt(3);</span>
	/**
	 * MAGIC NUMBER: the width of decoration elements.
	 */
	public static final double DECORATION_SIZE = (double) HEIGHT / 7;

	/** The Constant CHEVRON_X. */
<span class="nc" id="L259">	public static final double CHEVRON_X = SQRT_3 * HEIGHT / 2;</span>
	/**
	 * MAGIC NUMBER: the size of the stars in the union.
	 */
	public static final double STAR_SIZE = 0.07 * HEIGHT;
	/**
	 * MAGIC NUMBER: the horizontal offset of the vertical bar of the
	 * Scandinavian cross.
	 */
	public static final double CROSS_OFFSET = 2 * DECORATION_SIZE;

	/** The Constant BEND_X. */
	public static final double BEND_X = DECORATION_SIZE;

	/** The Constant BEND_Y. */
<span class="nc" id="L274">	public static final double BEND_Y = DECORATION_SIZE / SQRT_3;</span>

	/** The Constant star. */
<span class="nc" id="L277">	private static final GeneralPath star = getStar();</span>

	/**
	 * The distribution of stars in the &quot;union&quot;, based on historical flags of
	 * the United States. This really should be extended to handle rectangles of
	 * different shapes.
	 */
<span class="nc" id="L284">	private static final int[][] layout = new int[51][2];</span>

	static {
<span class="nc bnc" id="L287" title="All 2 branches missed.">		for (int[] bars : new int[][] { { 5, 4 }, { 5, 6 }, { 6, 5 }, { 5, 5 } }) {</span>
<span class="nc" id="L288">			int sum = bars[0] + bars[1];</span>
<span class="nc" id="L289">			boolean even = true;</span>
<span class="nc bnc" id="L290" title="All 2 branches missed.">			while (sum &lt; 51) {</span>
<span class="nc" id="L291">				layout[sum] = bars;</span>
<span class="nc bnc" id="L292" title="All 2 branches missed.">				if (even) {</span>
<span class="nc" id="L293">					sum += bars[0];</span>
<span class="nc" id="L294">					even = false;</span>
				} else {
<span class="nc" id="L296">					sum += bars[1];</span>
<span class="nc" id="L297">					even = true;</span>
				}
			}
		}

<span class="nc" id="L302">	}</span>

	/**
	 * If the background is striped, the background colors will be used in turn,
	 * from top to bottom, or from left to right. If the background is
	 * quartered, the colors will be used clockwise, starting at the top left.
	 * If there are more colors than stripes or quarters, the superfluous colors
	 * will be ignored.
	 */
<span class="nc" id="L311">	private List&lt;Color&gt; backgroundColors = new ArrayList&lt;&gt;();</span>

	/** The union color. */
<span class="nc" id="L314">	private Color unionColor = Color.BLUE;</span>

	/** The star color. */
<span class="nc" id="L317">	private Color starColor = Color.WHITE;</span>

	/** The decoration color. */
<span class="nc" id="L320">	private Color decorationColor = Color.WHITE;</span>

	/** The background. */
<span class="nc" id="L323">	private Background background = Background.FESSES;</span>

	/** The decoration. */
<span class="nc" id="L326">	private Decoration decoration = Decoration.NONE;</span>

	/** The union shape. */
<span class="nc" id="L329">	private UnionShape unionShape = UnionShape.RECTANGLE;</span>

	/** The union position. */
<span class="nc" id="L332">	private UnionPosition unionPosition = UnionPosition.CANTON;</span>

	/**
	 * The number of stars in the union. This value is only relevant if the flag
	 * contains a union.
	 */
<span class="nc" id="L338">	private int stars = 13;</span>

	/**
	 * The number of background stripes. This value is only relevant if the
	 * background contains stripes (currently FESSES or PALES).
	 */
<span class="nc" id="L344">	private int stripes = 13;</span>

	/**
	 * Instantiates a new flag.
	 *
	 * @param background
	 *            the background
	 * @param decoration
	 *            the decoration
	 * @param unionPosition
	 *            the union position
	 */
	public Flag(Background background, Decoration decoration, UnionPosition unionPosition) {
<span class="nc" id="L357">		this(background, decoration, unionPosition, UnionShape.RECTANGLE);</span>
<span class="nc" id="L358">	}</span>

	/**
	 * Instantiates a new flag.
	 *
	 * @param background
	 *            the background
	 * @param decoration
	 *            the decoration
	 * @param unionPosition
	 *            the union position
	 * @param unionShape
	 *            the union shape
	 */
<span class="nc" id="L372">	public Flag(Background background, Decoration decoration, UnionPosition unionPosition, UnionShape unionShape) {</span>
<span class="nc" id="L373">		this.background = background;</span>
<span class="nc" id="L374">		this.decoration = decoration;</span>
<span class="nc" id="L375">		this.unionPosition = unionPosition;</span>
<span class="nc" id="L376">		this.unionShape = unionShape;</span>
<span class="nc" id="L377">	}</span>

	/**
	 * Returns the background of the flag.
	 *
	 * @return A &lt;code&gt;Background&lt;/code&gt; value.
	 */
	public Background getBackground() {
<span class="nc" id="L385">		return background;</span>
	}

	/**
	 * Sets the background of the flag and returns the flag itself.
	 *
	 * @param background
	 *            The new &lt;code&gt;Background&lt;/code&gt; value.
	 * @return The modified flag.
	 */
	public Flag setBackground(Background background) {
<span class="nc" id="L396">		this.background = background;</span>
<span class="nc" id="L397">		return this;</span>
	}

	/**
	 * Returns the decoration of the flag.
	 *
	 * @return A &lt;code&gt;Decoration&lt;/code&gt; value.
	 */
	public Decoration getDecoration() {
<span class="nc" id="L406">		return decoration;</span>
	}

	/**
	 * Sets the decoration of the flag and returns the flag itself.
	 *
	 * @param decoration
	 *            The new &lt;code&gt;Decoration&lt;/code&gt; value.
	 * @return The modified flag.
	 */
	public Flag setDecoration(Decoration decoration) {
<span class="nc" id="L417">		this.decoration = decoration;</span>
<span class="nc" id="L418">		return this;</span>
	}

	/**
	 * Returns the union position of the flag.
	 *
	 * @return A &lt;code&gt;UnionPosition&lt;/code&gt; value.
	 */
	public UnionPosition getUnionPosition() {
<span class="nc" id="L427">		return unionPosition;</span>
	}

	/**
	 * Sets the union position of the flag and returns the flag itself.
	 *
	 * @param position
	 *            The new &lt;code&gt;UnionPosition&lt;/code&gt; value.
	 * @return The modified flag.
	 */
	public Flag setUnionPosition(UnionPosition position) {
<span class="nc" id="L438">		this.unionPosition = position;</span>
<span class="nc" id="L439">		return this;</span>
	}

	/**
	 * Returns the union shape of the flag.
	 *
	 * @return A &lt;code&gt;UnionShape&lt;/code&gt; value.
	 */
	public UnionShape getUnionShape() {
<span class="nc" id="L448">		return unionShape;</span>
	}

	/**
	 * Sets the union shape of the flag and returns the flag itself.
	 *
	 * @param shape
	 *            The new &lt;code&gt;UnionShape&lt;/code&gt; value.
	 * @return The modified flag.
	 */
	public Flag setUnionShape(UnionShape shape) {
<span class="nc" id="L459">		this.unionShape = shape;</span>
<span class="nc" id="L460">		return this;</span>
	}

	/**
	 * Returns a &lt;code&gt;List&lt;/code&gt; of background colors.
	 *
	 * @return A &lt;code&gt;List&lt;/code&gt; of background colors.
	 */
	public List&lt;Color&gt; getBackgroundColors() {
<span class="nc" id="L469">		return backgroundColors;</span>
	}

	/**
	 * Sets the background colors of the flag and returns the flag itself.
	 *
	 * @param backgroundColors
	 *            A &lt;code&gt;List&lt;/code&gt; of background colors.
	 * @return The modified flag.
	 */
	public Flag setBackgroundColors(List&lt;Color&gt; backgroundColors) {
<span class="nc" id="L480">		this.backgroundColors = backgroundColors;</span>
<span class="nc" id="L481">		return this;</span>
	}

	/**
	 * Sets the background colors of the flag and returns the flag itself.
	 *
	 * @param colors
	 *            A variable number of background colors.
	 * @return The modified flag.
	 */
	public Flag setBackgroundColors(Color... colors) {
<span class="nc" id="L492">		backgroundColors.clear();</span>
<span class="nc bnc" id="L493" title="All 2 branches missed.">		for (Color color : colors) {</span>
<span class="nc bnc" id="L494" title="All 2 branches missed.">			if (color != null) {</span>
<span class="nc" id="L495">				backgroundColors.add(color);</span>
			}
		}
<span class="nc" id="L498">		return this;</span>
	}

	/**
	 * Returns the union color of the flag.
	 *
	 * @return A &lt;code&gt;Color&lt;/code&gt; value.
	 */
	public Color getUnionColor() {
<span class="nc" id="L507">		return unionColor;</span>
	}

	/**
	 * Sets the union color of the flag and returns the flag itself.
	 *
	 * @param unionColor
	 *            The new &lt;code&gt;Color&lt;/code&gt; value.
	 * @return The modified flag.
	 */
	public Flag setUnionColor(Color unionColor) {
<span class="nc" id="L518">		this.unionColor = unionColor;</span>
<span class="nc" id="L519">		return this;</span>
	}

	/**
	 * Returns the decoration color of the flag.
	 *
	 * @return A &lt;code&gt;Color&lt;/code&gt; value.
	 */
	public Color getDecorationColor() {
<span class="nc" id="L528">		return decorationColor;</span>
	}

	/**
	 * Sets the decoration color of the flag and returns the flag itself.
	 *
	 * @param decorationColor
	 *            The new &lt;code&gt;Color&lt;/code&gt; value.
	 * @return The modified flag.
	 */
	public Flag setDecorationColor(Color decorationColor) {
<span class="nc" id="L539">		this.decorationColor = decorationColor;</span>
<span class="nc" id="L540">		return this;</span>
	}

	/**
	 * Returns the star color of the flag.
	 *
	 * @return A &lt;code&gt;Color&lt;/code&gt; value.
	 */
	public Color getStarColor() {
<span class="nc" id="L549">		return starColor;</span>
	}

	/**
	 * Sets the star color of the flag and returns the flag itself.
	 *
	 * @param starColor
	 *            The new &lt;code&gt;Color&lt;/code&gt; value.
	 * @return The modified flag.
	 */
	public Flag setStarColor(Color starColor) {
<span class="nc" id="L560">		this.starColor = starColor;</span>
<span class="nc" id="L561">		return this;</span>
	}

	/**
	 * Returns the number of stars in the union.
	 *
	 * @return The number of stars.
	 */
	public int getStars() {
<span class="nc" id="L570">		return stars;</span>
	}

	/**
	 * Sets the number of stars in the union and returns the flag itself.
	 *
	 * @param stars
	 *            The new number of stars.
	 * @return The modified flag.
	 */
	public Flag setStars(int stars) {
<span class="nc" id="L581">		this.stars = stars;</span>
<span class="nc" id="L582">		return this;</span>
	}

	/**
	 * Returns the number of background stripes.
	 *
	 * @return The number of stars.
	 */
	public int getStripes() {
<span class="nc" id="L591">		return stripes;</span>
	}

	/**
	 * Sets the number of background stripes and returns the flag itself.
	 *
	 * @param stripes
	 *            The new number of background stripes.
	 * @return The modified flag.
	 */
	public Flag setStripes(int stripes) {
<span class="nc" id="L602">		this.stripes = stripes;</span>
<span class="nc" id="L603">		return this;</span>
	}

	/**
	 * Generates an image of the flag.
	 *
	 * @return An image of the flag.
	 */
	public BufferedImage getImage() {
<span class="nc" id="L612">		BufferedImage image = new BufferedImage(WIDTH, HEIGHT, BufferedImage.TYPE_INT_RGB);</span>
<span class="nc" id="L613">		Graphics2D g = image.createGraphics();</span>
<span class="nc" id="L614">		g.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);</span>

<span class="nc bnc" id="L616" title="All 2 branches missed.">		if (backgroundColors.isEmpty()) {</span>
<span class="nc" id="L617">			backgroundColors.add(Color.BLACK);</span>
		}
		// draw background
<span class="nc bnc" id="L620" title="All 7 branches missed.">		switch (background) {</span>
		case FESSES:
		case PALES:
<span class="nc bnc" id="L623" title="All 2 branches missed.">			if (stripes &lt; 1) {</span>
<span class="nc" id="L624">				drawBackground(g);</span>
			} else {
<span class="nc" id="L626">				drawStripes(g, background.alignment, stripes);</span>
			}
<span class="nc" id="L628">			break;</span>
		case PLAIN:
<span class="nc" id="L630">			drawBackground(g);</span>
<span class="nc" id="L631">			break;</span>
		case QUARTERLY:
<span class="nc" id="L633">			drawQuarters(g);</span>
<span class="nc" id="L634">			break;</span>
		case PER_BEND:
<span class="nc" id="L636">			drawPerBend(g, false);</span>
<span class="nc" id="L637">			break;</span>
		case PER_BEND_SINISTER:
<span class="nc" id="L639">			drawPerBend(g, true);</span>
<span class="nc" id="L640">			break;</span>
		case PER_SALTIRE:
<span class="nc" id="L642">			drawPerSaltire(g);</span>
<span class="nc" id="L643">			break;</span>
		default:
			break;
		}

		// draw decoration
<span class="nc" id="L649">		GeneralPath decorationShape = null;</span>
<span class="nc bnc" id="L650" title="All 8 branches missed.">		switch (decoration) {</span>
		case GREEK_CROSS:
		case CROSS:
		case SCANDINAVIAN_CROSS:
<span class="nc" id="L654">			decorationShape = getCross(decoration);</span>
<span class="nc" id="L655">			break;</span>
		case CHEVRON:
<span class="nc" id="L657">			decorationShape = getTriangle(UnionShape.CHEVRON, false);</span>
<span class="nc" id="L658">			break;</span>
		case PALL:
<span class="nc" id="L660">			decorationShape = getPall();</span>
<span class="nc" id="L661">			break;</span>
		case BEND:
<span class="nc" id="L663">			decorationShape = getBend(false);</span>
<span class="nc" id="L664">			break;</span>
		case BEND_SINISTER:
<span class="nc" id="L666">			decorationShape = getBend(true);</span>
<span class="nc" id="L667">			break;</span>
		case SALTIRE:
<span class="nc" id="L669">			decorationShape = getBend(true);</span>
<span class="nc" id="L670">			decorationShape.append(getBend(false), false);</span>
<span class="nc" id="L671">			break;</span>
		case SALTIRE_AND_CROSS:
<span class="nc" id="L673">			decorationShape = getBend(true);</span>
<span class="nc" id="L674">			decorationShape.append(getBend(false), false);</span>
<span class="nc" id="L675">			decorationShape.append(getCross(Decoration.CROSS), false);</span>
<span class="nc" id="L676">			break;</span>
		default:
			break;
		}
<span class="nc bnc" id="L680" title="All 2 branches missed.">		if (decorationShape != null) {</span>
<span class="nc" id="L681">			g.setColor(decorationColor);</span>
<span class="nc" id="L682">			g.fill(decorationShape);</span>
		}

<span class="nc bnc" id="L685" title="All 4 branches missed.">		if (unionPosition == null || unionPosition == UnionPosition.NONE) {</span>
<span class="nc" id="L686">			return image;</span>
		}

<span class="nc" id="L689">		GeneralPath union = null;</span>
<span class="nc" id="L690">		GeneralPath starShape = null;</span>
		// draw union
<span class="nc bnc" id="L692" title="All 4 branches missed.">		if (unionShape == null &amp;&amp; decoration != null) {</span>
<span class="nc" id="L693">			unionShape = decoration.unionShape;</span>
		}
<span class="nc bnc" id="L695" title="All 6 branches missed.">		switch (unionShape) {</span>
		case RECTANGLE:
<span class="nc" id="L697">			Rectangle2D.Double rectangle = getRectangle();</span>
<span class="nc" id="L698">			union = new GeneralPath(rectangle);</span>
<span class="nc" id="L699">			starShape = getUnionRectangle(rectangle);</span>
<span class="nc" id="L700">			break;</span>
		case CHEVRON:
<span class="nc bnc" id="L702" title="All 2 branches missed.">			union = getTriangle(unionShape, decoration == Decoration.PALL);</span>
<span class="nc" id="L703">			starShape = getUnionTriangle(true);</span>
<span class="nc" id="L704">			break;</span>
		case BEND:
<span class="nc bnc" id="L706" title="All 4 branches missed.">			union = getTriangle(unionShape,</span>
					(decoration == Decoration.BEND) || (decoration == Decoration.BEND_SINISTER));
<span class="nc" id="L708">			starShape = getUnionTriangle(false);</span>
<span class="nc" id="L709">			transformBend(union);</span>
<span class="nc" id="L710">			transformBend(starShape);</span>
<span class="nc" id="L711">			break;</span>
		case RHOMBUS:
<span class="nc" id="L713">			union = getRhombus();</span>
<span class="nc" id="L714">			starShape = getUnionRhombus();</span>
<span class="nc" id="L715">			break;</span>
		case TRIANGLE:
<span class="nc bnc" id="L717" title="All 2 branches missed.">			union = getTriangle(unionShape, decoration == Decoration.SALTIRE);</span>
<span class="nc" id="L718">			starShape = getUnionTriangle(true);</span>
<span class="nc" id="L719">			transformTriangle(union);</span>
<span class="nc" id="L720">			transformTriangle(starShape);</span>
<span class="nc" id="L721">			break;</span>
		default:
			break;
		}
<span class="nc bnc" id="L725" title="All 4 branches missed.">		if (!(union == null || unionColor == null)) {</span>
<span class="nc" id="L726">			g.setColor(unionColor);</span>
<span class="nc" id="L727">			g.fill(union);</span>
		}
<span class="nc bnc" id="L729" title="All 2 branches missed.">		if (starShape != null) {</span>
<span class="nc" id="L730">			g.setColor(starColor);</span>
<span class="nc" id="L731">			g.fill(starShape);</span>
		}
<span class="nc" id="L733">		g.dispose();</span>
<span class="nc" id="L734">		return image;</span>
	}

	/**
	 * Return the stars in a rectangular &quot;union&quot;, distributed according to rules
	 * derived from historical flags of the United States.
	 *
	 * @param union
	 *            The rectangular area to fill.
	 * @return The union path
	 */
	private GeneralPath getUnionRectangle(Rectangle2D.Double union) {

<span class="nc bnc" id="L747" title="All 2 branches missed.">		if (union == null)</span>
<span class="nc" id="L748">			return null;</span>

		GeneralPath unionPath;
<span class="nc bnc" id="L751" title="All 2 branches missed.">		if (stars &lt; 14) {</span>
<span class="nc" id="L752">			double radius = 0.3 * Math.min(union.height, union.width);</span>
<span class="nc" id="L753">			unionPath = getCircleOfStars(radius);</span>
<span class="nc" id="L754">		} else {</span>
<span class="nc" id="L755">			unionPath = getGridOfStars(union);</span>
		}
<span class="nc" id="L757">		double x = union.x + union.width / 2;</span>
<span class="nc" id="L758">		double y = union.y + union.height / 2;</span>
<span class="nc" id="L759">		center(unionPath, x, y);</span>
<span class="nc" id="L760">		return unionPath;</span>
	}

	/**
	 * Gets the union triangle.
	 *
	 * @param isosceles
	 *            the isosceles
	 * @return the union triangle
	 */
	private GeneralPath getUnionTriangle(boolean isosceles) {
<span class="nc bnc" id="L771" title="All 6 branches missed.">		boolean small = (decoration == Decoration.PALL || decoration == Decoration.BEND</span>
				|| decoration == Decoration.BEND_SINISTER);

<span class="nc" id="L774">		double x = 0;</span>
<span class="nc" id="L775">		double y = 0;</span>
<span class="nc" id="L776">		double r = 0;</span>
<span class="nc bnc" id="L777" title="All 2 branches missed.">		if (unionShape == UnionShape.CHEVRON) {</span>
<span class="nc" id="L778">			x = CHEVRON_X;</span>
<span class="nc" id="L779">			y = HEIGHT;</span>
<span class="nc bnc" id="L780" title="All 2 branches missed.">			if (small) {</span>
<span class="nc" id="L781">				x -= BEND_X;</span>
<span class="nc" id="L782">				y -= 2 * BEND_Y;</span>
			}
<span class="nc" id="L784">			r = SQRT_3 * y / 6;</span>
<span class="nc bnc" id="L785" title="All 2 branches missed.">		} else if (unionShape == UnionShape.TRIANGLE) {</span>
<span class="nc bnc" id="L786" title="All 4 branches missed.">			if (unionPosition == UnionPosition.LEFT || unionPosition == UnionPosition.RIGHT) {</span>
<span class="nc" id="L787">				x = WIDTH / 2;</span>
<span class="nc" id="L788">				y = HEIGHT;</span>
<span class="nc bnc" id="L789" title="All 2 branches missed.">				if (small) {</span>
<span class="nc" id="L790">					x -= BEND_X;</span>
<span class="nc" id="L791">					y -= 2 * BEND_Y;</span>
				}
<span class="nc" id="L793">				r = SQRT_3 * y / 6;</span>
			} else {
<span class="nc" id="L795">				x = HEIGHT / 2;</span>
<span class="nc" id="L796">				y = WIDTH;</span>
<span class="nc bnc" id="L797" title="All 2 branches missed.">				if (small) {</span>
<span class="nc" id="L798">					x -= BEND_Y;</span>
<span class="nc" id="L799">					y -= 2 * BEND_X;</span>
				}
<span class="nc" id="L801">				double h = y / 2;</span>
<span class="nc" id="L802">				double c = Math.sqrt(h * h + x * x);</span>
<span class="nc" id="L803">				r = x * y / (y + 2 * c);</span>
<span class="nc" id="L804">			}</span>
		} else {
			// union shape is bend
<span class="nc" id="L807">			x = WIDTH;</span>
<span class="nc" id="L808">			y = HEIGHT;</span>
<span class="nc bnc" id="L809" title="All 2 branches missed.">			if (small) {</span>
<span class="nc" id="L810">				x -= BEND_X;</span>
<span class="nc" id="L811">				y -= BEND_Y;</span>
			}
<span class="nc" id="L813">			double c = Math.sqrt(x * x + y * y);</span>
<span class="nc" id="L814">			double A = x * y / 2;</span>
<span class="nc" id="L815">			r = 2 * A / (x + y + c);</span>
		}
		// leave a margin
<span class="nc" id="L818">		double radius = r * 0.6;</span>

<span class="nc" id="L820">		GeneralPath unionPath = new GeneralPath();</span>
<span class="nc bnc" id="L821" title="All 2 branches missed.">		if (stars &lt; 14) {</span>
<span class="nc" id="L822">			unionPath = getCircleOfStars(radius);</span>
<span class="nc bnc" id="L823" title="All 2 branches missed.">			if (isosceles) {</span>
<span class="nc bnc" id="L824" title="All 4 branches missed.">				if (unionPosition == UnionPosition.LEFT || unionPosition == UnionPosition.RIGHT) {</span>
<span class="nc" id="L825">					center(unionPath, r, HEIGHT / 2);</span>
				} else {
<span class="nc" id="L827">					center(unionPath, r, WIDTH / 2);</span>
				}
			} else {
<span class="nc" id="L830">				center(unionPath, r, r);</span>
			}
		} else {

<span class="nc" id="L834">			int sum = 0;</span>
<span class="nc" id="L835">			int rows = 1;</span>
<span class="nc bnc" id="L836" title="All 2 branches missed.">			while (sum &lt; stars) {</span>
<span class="nc" id="L837">				sum += rows;</span>
<span class="nc" id="L838">				rows++;</span>
			}
<span class="nc" id="L840">			int missing = sum - stars;</span>
<span class="nc" id="L841">			double slope = y / x;</span>
<span class="nc" id="L842">			double dx = x / rows;</span>
<span class="nc" id="L843">			double xx = dx / 2;</span>
<span class="nc" id="L844">			double height = y - xx * slope;</span>
<span class="nc" id="L845">			double offset = 0;</span>
<span class="nc" id="L846">			rows--;</span>
<span class="nc" id="L847">			double dy = height / rows;</span>
<span class="nc bnc" id="L848" title="All 2 branches missed.">			for (int index = rows; index &gt; 0; index--) {</span>
<span class="nc bnc" id="L849" title="All 2 branches missed.">				if (isosceles) {</span>
<span class="nc" id="L850">					height = y - xx * slope;</span>
<span class="nc" id="L851">					dy = height / index;</span>
<span class="nc" id="L852">					offset = (HEIGHT - height) / 2;</span>
				}
<span class="nc" id="L854">				double yy = dy / 2;</span>
<span class="nc" id="L855">				int count = index;</span>
<span class="nc bnc" id="L856" title="All 2 branches missed.">				if (missing &gt; 0) {</span>
<span class="nc" id="L857">					count = index - missing;</span>
<span class="nc" id="L858">					yy += missing / 2 * dy;</span>
<span class="nc" id="L859">					missing = 0;</span>
				}
<span class="nc bnc" id="L861" title="All 2 branches missed.">				for (int star = 0; star &lt; count; star++) {</span>
<span class="nc" id="L862">					unionPath.append(getStar(xx, yy + offset), false);</span>
<span class="nc" id="L863">					yy += dy;</span>
				}
<span class="nc" id="L865">				xx += dx;</span>
			}
		}
<span class="nc" id="L868">		return unionPath;</span>
	}

	/**
	 * Flip or rotate a top left triangle so that it fits another corner.
	 *
	 * @param triangle
	 *            The top left triangle.
	 * @return The transformed triangle.
	 */
	private GeneralPath transformBend(GeneralPath triangle) {
<span class="nc bnc" id="L879" title="All 2 branches missed.">		if (unionPosition == UnionPosition.TOP) {</span>
<span class="nc bnc" id="L880" title="All 2 branches missed.">			if (decoration == Decoration.BEND) {</span>
<span class="nc" id="L881">				triangle.transform(AffineTransform.getScaleInstance(-1, 1));</span>
<span class="nc" id="L882">				triangle.transform(AffineTransform.getTranslateInstance(WIDTH, 0));</span>
<span class="nc bnc" id="L883" title="All 2 branches missed.">			} else if (decoration == Decoration.BEND_SINISTER) {</span>
				// nothing to do: default is top left
			}
<span class="nc bnc" id="L886" title="All 2 branches missed.">		} else if (unionPosition == UnionPosition.BOTTOM) {</span>
<span class="nc bnc" id="L887" title="All 2 branches missed.">			if (decoration == Decoration.BEND) {</span>
<span class="nc" id="L888">				triangle.transform(AffineTransform.getScaleInstance(1, -1));</span>
<span class="nc" id="L889">				triangle.transform(AffineTransform.getTranslateInstance(0, HEIGHT));</span>
<span class="nc bnc" id="L890" title="All 2 branches missed.">			} else if (decoration == Decoration.BEND_SINISTER) {</span>
<span class="nc" id="L891">				triangle.transform(AffineTransform.getQuadrantRotateInstance(2));</span>
<span class="nc" id="L892">				triangle.transform(AffineTransform.getTranslateInstance(WIDTH, HEIGHT));</span>
			}
		}
<span class="nc" id="L895">		return triangle;</span>
	}

	/**
	 * Flip or rotate a left triangle so that it fits another side.
	 *
	 * @param triangle
	 *            The left triangle.
	 * @return The transformed triangle.
	 */
	private GeneralPath transformTriangle(GeneralPath triangle) {
<span class="nc bnc" id="L906" title="All 4 branches missed.">		switch (unionPosition) {</span>
		case TOP:
<span class="nc" id="L908">			triangle.transform(AffineTransform.getQuadrantRotateInstance(1));</span>
<span class="nc" id="L909">			triangle.transform(AffineTransform.getTranslateInstance(WIDTH, 0));</span>
<span class="nc" id="L910">			break;</span>
		case BOTTOM:
<span class="nc" id="L912">			triangle.transform(AffineTransform.getQuadrantRotateInstance(3));</span>
<span class="nc" id="L913">			triangle.transform(AffineTransform.getTranslateInstance(0, HEIGHT));</span>
<span class="nc" id="L914">			break;</span>
		case RIGHT:
<span class="nc" id="L916">			triangle.transform(AffineTransform.getScaleInstance(-1, 1));</span>
<span class="nc" id="L917">			triangle.transform(AffineTransform.getTranslateInstance(WIDTH, 0));</span>
<span class="nc" id="L918">			break;</span>
		case LEFT:
		default:
		}
<span class="nc" id="L922">		return triangle;</span>
	}

	/**
	 * Gets the union rhombus.
	 *
	 * @return the union rhombus
	 */
	private GeneralPath getUnionRhombus() {
<span class="nc" id="L931">		GeneralPath unionPath = new GeneralPath();</span>

<span class="nc" id="L933">		int count = 1;</span>
<span class="nc" id="L934">		int square = 1;</span>
<span class="nc bnc" id="L935" title="All 2 branches missed.">		while (square &lt; stars) {</span>
<span class="nc" id="L936">			count++;</span>
<span class="nc" id="L937">			square = count * count;</span>
		}
<span class="nc" id="L939">		int rows = stars / count;</span>
<span class="nc bnc" id="L940" title="All 2 branches missed.">		if (rows * count &lt; stars)</span>
<span class="nc" id="L941">			rows++;</span>
<span class="nc" id="L942">		int starCount = 0;</span>
<span class="nc" id="L943">		double a = WIDTH / 2 - BEND_X;</span>
<span class="nc" id="L944">		double b = HEIGHT / 2 - BEND_Y;</span>

<span class="nc bnc" id="L946" title="All 2 branches missed.">		if (stars &lt; 14) {</span>
<span class="nc" id="L947">			double c = Math.sqrt(a * a + b * b);</span>
<span class="nc" id="L948">			double r = (a * b) / c;</span>
<span class="nc" id="L949">			double radius = 0.6 * r;</span>
<span class="nc" id="L950">			unionPath = getCircleOfStars(radius);</span>
<span class="nc" id="L951">			center(unionPath, WIDTH / 2, HEIGHT / 2);</span>
<span class="nc" id="L952">		} else {</span>
<span class="nc" id="L953">			double dx = a / count;</span>
<span class="nc" id="L954">			double dy = b / count;</span>
<span class="nc" id="L955">			double dx1 = a / rows;</span>
<span class="nc" id="L956">			double dy1 = b / rows;</span>
<span class="nc bnc" id="L957" title="All 2 branches missed.">			outer: for (int index = 0; index &lt; rows; index++) {</span>
<span class="nc" id="L958">				double x = BEND_X + dx + index * dx1;</span>
<span class="nc" id="L959">				double y = HEIGHT / 2 - index * dy1;</span>
<span class="nc bnc" id="L960" title="All 2 branches missed.">				for (int star = 0; star &lt; count; star++) {</span>
<span class="nc" id="L961">					unionPath.append(getStar(x, y), false);</span>
<span class="nc" id="L962">					starCount++;</span>
<span class="nc bnc" id="L963" title="All 2 branches missed.">					if (starCount == stars) {</span>
<span class="nc" id="L964">						break outer;</span>
					} else {
<span class="nc" id="L966">						x += dx;</span>
<span class="nc" id="L967">						y += dy;</span>
					}
				}
			}
		}

<span class="nc" id="L973">		return unionPath;</span>
	}

	/**
	 * Calculate the width of stripes on the basis of the given alignment.
	 *
	 * @param alignment
	 *            The alignment of the stripes.
	 * @return The width of the stripes.
	 */
	private double getStripeWidth(Alignment alignment) {
<span class="nc bnc" id="L984" title="All 2 branches missed.">		return (alignment == Alignment.HORIZONTAL) ? WIDTH : (double) WIDTH / stripes;</span>
	}

	/**
	 * Calculate the height of stripes on the basis of the given alignment.
	 *
	 * @param alignment
	 *            The alignment of the stripes.
	 * @return The height of the stripes.
	 */
	private double getStripeHeight(Alignment alignment) {
<span class="nc bnc" id="L995" title="All 2 branches missed.">		return (alignment == Alignment.VERTICAL) ? HEIGHT : (double) HEIGHT / stripes;</span>
	}

	/**
	 * Draw background.
	 *
	 * @param g
	 *            the g
	 */
	private void drawBackground(Graphics2D g) {
<span class="nc" id="L1005">		g.setColor(backgroundColors.get(0));</span>
<span class="nc" id="L1006">		g.fillRect(0, 0, WIDTH, HEIGHT);</span>
<span class="nc" id="L1007">	}</span>

	/**
	 * Draw stripes.
	 *
	 * @param g
	 *            the g
	 * @param alignment
	 *            the alignment
	 * @param stripes
	 *            the stripes
	 */
	private void drawStripes(Graphics2D g, Alignment alignment, int stripes) {
<span class="nc" id="L1020">		int colors = backgroundColors.size();</span>
<span class="nc" id="L1021">		double stripeWidth = getStripeWidth(alignment);</span>
<span class="nc" id="L1022">		double stripeHeight = getStripeHeight(alignment);</span>
<span class="nc bnc" id="L1023" title="All 2 branches missed.">		double x = (alignment == Alignment.VERTICAL) ? stripeWidth : 0;</span>
<span class="nc bnc" id="L1024" title="All 2 branches missed.">		double y = (alignment == Alignment.HORIZONTAL) ? stripeHeight : 0;</span>
<span class="nc" id="L1025">		Rectangle2D.Double rectangle = new Rectangle2D.Double();</span>
<span class="nc bnc" id="L1026" title="All 2 branches missed.">		for (int index = 0; index &lt; stripes; index++) {</span>
<span class="nc" id="L1027">			g.setColor(backgroundColors.get(index % colors));</span>
<span class="nc" id="L1028">			rectangle.setRect(index * x, index * y, stripeWidth, stripeHeight);</span>
<span class="nc" id="L1029">			g.fill(rectangle);</span>
		}
<span class="nc" id="L1031">	}</span>

	/**
	 * Draw quarters.
	 *
	 * @param g
	 *            the g
	 */
	private void drawQuarters(Graphics2D g) {
<span class="nc" id="L1040">		int colors = backgroundColors.size();</span>
<span class="nc" id="L1041">		int[] x = { 0, 1, 1, 0 };</span>
<span class="nc" id="L1042">		int[] y = { 0, 0, 1, 1 };</span>
<span class="nc" id="L1043">		double halfWidth = WIDTH / 2;</span>
<span class="nc" id="L1044">		double halfHeight = HEIGHT / 2;</span>
<span class="nc bnc" id="L1045" title="All 2 branches missed.">		double offset = (decoration == Decoration.SCANDINAVIAN_CROSS) ? CROSS_OFFSET : 0;</span>
<span class="nc" id="L1046">		Rectangle2D.Double rectangle = new Rectangle2D.Double();</span>
<span class="nc bnc" id="L1047" title="All 2 branches missed.">		for (int index = 0; index &lt; 4; index++) {</span>
<span class="nc" id="L1048">			g.setColor(backgroundColors.get(index % colors));</span>
<span class="nc" id="L1049">			rectangle.setRect(x[index] * halfWidth - offset, y[index] * halfHeight, halfWidth + x[index] * offset,</span>
					halfHeight);
<span class="nc" id="L1051">			g.fill(rectangle);</span>
		}
<span class="nc" id="L1053">	}</span>

	/**
	 * Draw per bend.
	 *
	 * @param g
	 *            the g
	 * @param sinister
	 *            the sinister
	 */
	private void drawPerBend(Graphics2D g, boolean sinister) {
<span class="nc" id="L1064">		drawBackground(g);</span>
<span class="nc" id="L1065">		int colors = backgroundColors.size();</span>
<span class="nc" id="L1066">		GeneralPath path = new GeneralPath();</span>
<span class="nc" id="L1067">		path.moveTo(0, HEIGHT);</span>
<span class="nc bnc" id="L1068" title="All 2 branches missed.">		path.lineTo(sinister ? WIDTH : 0, 0);</span>
<span class="nc" id="L1069">		path.lineTo(WIDTH, HEIGHT);</span>
<span class="nc" id="L1070">		g.setColor(backgroundColors.get(1 % colors));</span>
<span class="nc" id="L1071">		g.fill(path);</span>
<span class="nc" id="L1072">	}</span>

	/**
	 * Draw per saltire.
	 *
	 * @param g
	 *            the g
	 */
	private void drawPerSaltire(Graphics2D g) {
<span class="nc" id="L1081">		int colors = backgroundColors.size();</span>
<span class="nc" id="L1082">		GeneralPath path = new GeneralPath();</span>
<span class="nc" id="L1083">		int[] x = { 0, WIDTH, WIDTH, 0 };</span>
<span class="nc" id="L1084">		int[] y = { 0, 0, HEIGHT, HEIGHT };</span>
<span class="nc" id="L1085">		double halfWidth = WIDTH / 2;</span>
<span class="nc" id="L1086">		double halfHeight = HEIGHT / 2;</span>
<span class="nc bnc" id="L1087" title="All 2 branches missed.">		for (int index = 0; index &lt; 4; index++) {</span>
<span class="nc" id="L1088">			path.moveTo(x[index], y[index]);</span>
<span class="nc" id="L1089">			path.lineTo(halfWidth, halfHeight);</span>
<span class="nc" id="L1090">			int nextIndex = (index + 1) % 4;</span>
<span class="nc" id="L1091">			path.lineTo(x[nextIndex], y[nextIndex]);</span>
<span class="nc" id="L1092">			g.setColor(backgroundColors.get(index % colors));</span>
<span class="nc" id="L1093">			g.fill(path);</span>
<span class="nc" id="L1094">			path.reset();</span>
		}
<span class="nc" id="L1096">	}</span>

	/**
	 * Gets the cross.
	 *
	 * @param decoration
	 *            the decoration
	 * @return the cross
	 */
	private GeneralPath getCross(Decoration decoration) {
<span class="nc" id="L1106">		double quarterWidth = (WIDTH - DECORATION_SIZE) / 2;</span>
<span class="nc" id="L1107">		double quarterHeight = (HEIGHT - DECORATION_SIZE) / 2;</span>
<span class="nc" id="L1108">		double offset = 0;</span>
<span class="nc" id="L1109">		double width = WIDTH;</span>
<span class="nc" id="L1110">		double height = HEIGHT;</span>
<span class="nc bnc" id="L1111" title="All 3 branches missed.">		switch (decoration) {</span>
		case SCANDINAVIAN_CROSS:
<span class="nc" id="L1113">			offset = CROSS_OFFSET;</span>
<span class="nc" id="L1114">			break;</span>
		case GREEK_CROSS:
<span class="nc" id="L1116">			width = height = Math.min(WIDTH, HEIGHT) - 2 * DECORATION_SIZE;</span>
<span class="nc" id="L1117">			break;</span>
		default:
			break;
		}
<span class="nc" id="L1121">		GeneralPath cross = new GeneralPath();</span>
<span class="nc" id="L1122">		cross.append(new Rectangle2D.Double((WIDTH - width) / 2, quarterHeight, width, DECORATION_SIZE), false);</span>
<span class="nc" id="L1123">		cross.append(new Rectangle2D.Double(quarterWidth - offset, (HEIGHT - height) / 2, DECORATION_SIZE, height),</span>
				false);
<span class="nc" id="L1125">		return cross;</span>
	}

	/**
	 * Gets the bend.
	 *
	 * @param sinister
	 *            the sinister
	 * @return the bend
	 */
	private GeneralPath getBend(boolean sinister) {
<span class="nc" id="L1136">		GeneralPath path = new GeneralPath();</span>
<span class="nc bnc" id="L1137" title="All 2 branches missed.">		if (sinister) {</span>
<span class="nc" id="L1138">			path.moveTo(0, HEIGHT);</span>
<span class="nc" id="L1139">			path.lineTo(0, HEIGHT - BEND_Y);</span>
<span class="nc" id="L1140">			path.lineTo(WIDTH - BEND_X, 0);</span>
<span class="nc" id="L1141">			path.lineTo(WIDTH, 0);</span>
<span class="nc" id="L1142">			path.lineTo(WIDTH, BEND_Y);</span>
<span class="nc" id="L1143">			path.lineTo(BEND_X, HEIGHT);</span>
		} else {
<span class="nc" id="L1145">			path.moveTo(0, 0);</span>
<span class="nc" id="L1146">			path.lineTo(BEND_X, 0);</span>
<span class="nc" id="L1147">			path.lineTo(WIDTH, HEIGHT - BEND_Y);</span>
<span class="nc" id="L1148">			path.lineTo(WIDTH, HEIGHT);</span>
<span class="nc" id="L1149">			path.lineTo(WIDTH - BEND_X, HEIGHT);</span>
<span class="nc" id="L1150">			path.lineTo(0, BEND_Y);</span>
		}
<span class="nc" id="L1152">		return path;</span>
	}

	/**
	 * Gets the pall.
	 *
	 * @return the pall
	 */
	private GeneralPath getPall() {
<span class="nc" id="L1161">		double y1 = (HEIGHT - DECORATION_SIZE) / 2;</span>
<span class="nc" id="L1162">		double y2 = (HEIGHT + DECORATION_SIZE) / 2;</span>
<span class="nc" id="L1163">		double x = BEND_X + y1 * SQRT_3;</span>
<span class="nc" id="L1164">		GeneralPath path = new GeneralPath(getTriangle(UnionShape.CHEVRON, true));</span>
<span class="nc" id="L1165">		path.lineTo(0, HEIGHT);</span>
<span class="nc" id="L1166">		path.lineTo(BEND_X, HEIGHT);</span>
<span class="nc" id="L1167">		path.lineTo(x, y2);</span>
<span class="nc" id="L1168">		path.lineTo(WIDTH, y2);</span>
<span class="nc" id="L1169">		path.lineTo(WIDTH, y1);</span>
<span class="nc" id="L1170">		path.lineTo(x, y1);</span>
<span class="nc" id="L1171">		path.lineTo(BEND_X, 0);</span>
<span class="nc" id="L1172">		path.lineTo(0, 0);</span>
<span class="nc" id="L1173">		return path;</span>
	}

	/**
	 * Returns a triangle of the given shape and size. This is a large top left
	 * triangle if the given shape is BEND, and a small left triangle if the
	 * given shape is CHEVRON or TRIANGLE.
	 *
	 * @param unionShape
	 *            The shape of the union.
	 * @param small
	 *            Whether the shape is limited by decorations.
	 * @return the triangle
	 */
	private GeneralPath getTriangle(UnionShape unionShape, boolean small) {
<span class="nc" id="L1188">		GeneralPath path = new GeneralPath();</span>
<span class="nc" id="L1189">		double x = 0;</span>
<span class="nc" id="L1190">		double y = 0;</span>
<span class="nc bnc" id="L1191" title="All 2 branches missed.">		if (small) {</span>
<span class="nc" id="L1192">			x = BEND_X;</span>
<span class="nc" id="L1193">			y = BEND_Y;</span>
		}
<span class="nc bnc" id="L1195" title="All 4 branches missed.">		switch (unionShape) {</span>
		case BEND:
<span class="nc" id="L1197">			path.moveTo(0, HEIGHT - y);</span>
<span class="nc" id="L1198">			path.lineTo(0, 0);</span>
<span class="nc" id="L1199">			path.lineTo(WIDTH - x, 0);</span>
<span class="nc" id="L1200">			break;</span>
		case CHEVRON:
<span class="nc" id="L1202">			path.moveTo(0, y);</span>
<span class="nc" id="L1203">			path.lineTo(CHEVRON_X - x, HEIGHT / 2);</span>
<span class="nc" id="L1204">			path.lineTo(0, HEIGHT - y);</span>
<span class="nc" id="L1205">			break;</span>
		case TRIANGLE:
<span class="nc bnc" id="L1207" title="All 4 branches missed.">			if (unionPosition == UnionPosition.LEFT || unionPosition == UnionPosition.RIGHT) {</span>
<span class="nc" id="L1208">				path.moveTo(0, y);</span>
<span class="nc" id="L1209">				path.lineTo(WIDTH / 2 - x, HEIGHT / 2);</span>
<span class="nc" id="L1210">				path.lineTo(0, HEIGHT - y);</span>
			} else {
<span class="nc" id="L1212">				path.moveTo(0, x);</span>
<span class="nc" id="L1213">				path.lineTo(HEIGHT / 2 - y, WIDTH / 2);</span>
<span class="nc" id="L1214">				path.lineTo(0, WIDTH - x);</span>
			}
<span class="nc" id="L1216">			break;</span>
		default:
			break;
		}
<span class="nc" id="L1220">		return path;</span>
	}

	/**
	 * Gets the rhombus.
	 *
	 * @return the rhombus
	 */
	private GeneralPath getRhombus() {
<span class="nc" id="L1229">		GeneralPath rhombus = new GeneralPath();</span>
<span class="nc" id="L1230">		rhombus.moveTo(WIDTH / 2, BEND_Y);</span>
<span class="nc" id="L1231">		rhombus.lineTo(WIDTH - BEND_X, HEIGHT / 2);</span>
<span class="nc" id="L1232">		rhombus.lineTo(WIDTH / 2, HEIGHT - BEND_Y);</span>
<span class="nc" id="L1233">		rhombus.lineTo(BEND_X, HEIGHT / 2);</span>
<span class="nc" id="L1234">		return rhombus;</span>
	}

	/**
	 * Gets the rectangle.
	 *
	 * @return the rectangle
	 */
	private Rectangle2D.Double getRectangle() {
<span class="nc bnc" id="L1243" title="All 4 branches missed.">		if (unionPosition == null || unionPosition == UnionPosition.NONE) {</span>
<span class="nc" id="L1244">			return null;</span>
		}
<span class="nc" id="L1246">		Rectangle2D.Double union = new Rectangle2D.Double();</span>
<span class="nc bnc" id="L1247" title="All 2 branches missed.">		if (unionPosition.alignment == Alignment.VERTICAL) {</span>
<span class="nc bnc" id="L1248" title="All 4 branches missed.">			if (background.alignment == Alignment.VERTICAL &amp;&amp; stripes &lt; 3) {</span>
<span class="nc" id="L1249">				union.width = WIDTH / stripes;</span>
<span class="nc bnc" id="L1250" title="All 4 branches missed.">				if (stripes == 2 &amp;&amp; unionPosition == UnionPosition.RIGHT) {</span>
<span class="nc" id="L1251">					union.x = WIDTH / 2;</span>
				}
			} else {
<span class="nc" id="L1254">				union.width = WIDTH / 3;</span>
<span class="nc" id="L1255">				union.x = unionPosition.index * union.width;</span>
			}
<span class="nc" id="L1257">			union.height = HEIGHT;</span>
<span class="nc bnc" id="L1258" title="All 2 branches missed.">		} else if (unionPosition.alignment == Alignment.HORIZONTAL) {</span>
<span class="nc bnc" id="L1259" title="All 4 branches missed.">			if (background.alignment == Alignment.HORIZONTAL &amp;&amp; stripes &lt; 3) {</span>
<span class="nc" id="L1260">				union.height = HEIGHT / stripes;</span>
<span class="nc bnc" id="L1261" title="All 4 branches missed.">				if (stripes == 2 &amp;&amp; unionPosition == UnionPosition.BOTTOM) {</span>
<span class="nc" id="L1262">					union.y = HEIGHT / 2;</span>
				}
			} else {
<span class="nc" id="L1265">				union.height = HEIGHT / 3;</span>
<span class="nc" id="L1266">				union.y = unionPosition.index * union.height;</span>
			}
<span class="nc" id="L1268">			union.width = WIDTH;</span>
		} else {
			// canton
<span class="nc" id="L1271">			union.width = WIDTH / 2;</span>
<span class="nc" id="L1272">			union.height = HEIGHT / 2;</span>
<span class="nc bnc" id="L1273" title="All 2 branches missed.">			if (background.alignment == Alignment.HORIZONTAL) {</span>
<span class="nc bnc" id="L1274" title="All 2 branches missed.">				union.height = (stripes &lt; 3) ? HEIGHT / 2 : (stripes / 2) * getStripeHeight(background.alignment);</span>
<span class="nc bnc" id="L1275" title="All 2 branches missed.">			} else if (background.alignment == Alignment.VERTICAL) {</span>
<span class="nc bnc" id="L1276" title="All 2 branches missed.">				union.width = (stripes &lt; 3) ? WIDTH / 2 : (stripes / 2) * getStripeWidth(background.alignment);</span>
			}
<span class="nc bnc" id="L1278" title="All 4 branches missed.">			if (decoration == Decoration.GREEK_CROSS || decoration == Decoration.CROSS) {</span>
<span class="nc" id="L1279">				union.width = (WIDTH - DECORATION_SIZE) / 2;</span>
<span class="nc" id="L1280">				union.height = (HEIGHT - DECORATION_SIZE) / 2;</span>
<span class="nc bnc" id="L1281" title="All 2 branches missed.">			} else if (decoration == Decoration.SCANDINAVIAN_CROSS) {</span>
<span class="nc" id="L1282">				union.width = (WIDTH - DECORATION_SIZE) / 2 - CROSS_OFFSET;</span>
<span class="nc" id="L1283">				union.height = (HEIGHT - DECORATION_SIZE) / 2;</span>
			}
		}

<span class="nc" id="L1287">		return union;</span>
	}

	/**
	 * Return the basic five-point star.
	 *
	 * @return the basic star shape
	 */
	private static GeneralPath getStar() {
<span class="nc" id="L1296">		GeneralPath star = new GeneralPath(GeneralPath.WIND_NON_ZERO);</span>
<span class="nc" id="L1297">		double angle = 2 * Math.PI / 5;</span>
<span class="nc" id="L1298">		double radius = STAR_SIZE / 2;</span>
<span class="nc" id="L1299">		double x = 0;</span>
<span class="nc" id="L1300">		double y = -radius;</span>
<span class="nc" id="L1301">		star.moveTo(x, y);</span>
<span class="nc" id="L1302">		int[] vertex = { 2, 4, 1, 3 };</span>
<span class="nc bnc" id="L1303" title="All 2 branches missed.">		for (int i : vertex) {</span>
<span class="nc" id="L1304">			double phi = i * angle;</span>
<span class="nc" id="L1305">			x = radius * Math.sin(phi);</span>
<span class="nc" id="L1306">			y = -radius * Math.cos(phi);</span>
<span class="nc" id="L1307">			star.lineTo(x, y);</span>
		}
<span class="nc" id="L1309">		star.closePath();</span>
<span class="nc" id="L1310">		return star;</span>
	}

	/**
	 * Returns a star at the given coordinates (x, y).
	 *
	 * @param x
	 *            The x coordinate of the star.
	 * @param y
	 *            The y coordinate of the star.
	 * @return the star
	 */
	public GeneralPath getStar(double x, double y) {
<span class="nc" id="L1323">		return getStar(-1, x, y);</span>
	}

	/**
	 * Returns a star of the given scale at the given coordinates (x, y).
	 *
	 * @param scale
	 *            The scale of the star.
	 * @param x
	 *            The x coordinate of the star.
	 * @param y
	 *            The y coordinate of the star.
	 * @return the star
	 */
	public GeneralPath getStar(double scale, double x, double y) {
<span class="nc" id="L1338">		GeneralPath newStar = new GeneralPath(star);</span>
<span class="nc bnc" id="L1339" title="All 2 branches missed.">		if (scale &gt; 0) {</span>
<span class="nc" id="L1340">			newStar.transform(AffineTransform.getScaleInstance(scale, scale));</span>
		}
<span class="nc" id="L1342">		newStar.transform(AffineTransform.getTranslateInstance(x, y));</span>
<span class="nc" id="L1343">		return newStar;</span>
	}

	/**
	 * Centers the given path on the given point (x,y).
	 *
	 * @param path
	 *            The path to center.
	 * @param x
	 *            The x coordinate of the center.
	 * @param y
	 *            The y coordinate of the center.
	 */
	private void center(GeneralPath path, double x, double y) {
<span class="nc" id="L1357">		double dx = x - path.getBounds().getX() - path.getBounds().getWidth() / 2;</span>
<span class="nc" id="L1358">		double dy = y - path.getBounds().getY() - path.getBounds().getHeight() / 2;</span>
<span class="nc" id="L1359">		path.transform(AffineTransform.getTranslateInstance(dx, dy));</span>
<span class="nc" id="L1360">	}</span>

	/**
	 * Returns either a single star, or a circle of stars with the given radius,
	 * centered at the origin.
	 *
	 * @param radius
	 *            The radius of the circle.
	 * @return The circle of stars.
	 */
	private GeneralPath getCircleOfStars(double radius) {
<span class="nc" id="L1371">		double phi = Math.PI * 2 / stars;</span>
<span class="nc" id="L1372">		GeneralPath unionPath = new GeneralPath();</span>
<span class="nc bnc" id="L1373" title="All 2 branches missed.">		if (stars == 0) {</span>
			// nothing to do
<span class="nc bnc" id="L1375" title="All 2 branches missed.">		} else if (stars == 1) {</span>
			// one double sized star
<span class="nc" id="L1377">			unionPath = getStar(2, 0, 0);</span>
<span class="nc bnc" id="L1378" title="All 2 branches missed.">		} else if (stars == 2) {</span>
			// two larger stars, on the x axis
<span class="nc" id="L1380">			unionPath.append(getStar(1.5, -radius, 0), false);</span>
<span class="nc" id="L1381">			unionPath.append(getStar(1.5, radius, 0), false);</span>
		} else {
			// a general circle of stars
<span class="nc bnc" id="L1384" title="All 2 branches missed.">			for (int i = 0; i &lt; stars; i++) {</span>
<span class="nc" id="L1385">				double x = -radius - radius * Math.sin(i * phi);</span>
<span class="nc" id="L1386">				double y = -radius * Math.cos(i * phi);</span>
<span class="nc" id="L1387">				unionPath.append(getStar(x, y), false);</span>
			}
		}
<span class="nc" id="L1390">		return unionPath;</span>
	}

	/**
	 * Gets the grid of stars.
	 *
	 * @param union
	 *            the union
	 * @return the grid of stars
	 */
	public GeneralPath getGridOfStars(Rectangle2D.Double union) {
<span class="nc" id="L1401">		int[] bars = new int[2];</span>
<span class="nc bnc" id="L1402" title="All 2 branches missed.">		for (int count = stars; count &lt; 51; count++) {</span>
<span class="nc bnc" id="L1403" title="All 2 branches missed.">			if (layout[count][0] &gt; 0) {</span>
<span class="nc" id="L1404">				bars = layout[count];</span>
<span class="nc" id="L1405">				break;</span>
			}
		}
<span class="nc" id="L1408">		int maxCols = Math.max(bars[0], bars[1]);</span>
<span class="nc" id="L1409">		int rows = 2;</span>
<span class="nc" id="L1410">		int sum = bars[0] + bars[1];</span>
<span class="nc bnc" id="L1411" title="All 2 branches missed.">		while (sum &lt; stars) {</span>
<span class="nc" id="L1412">			sum += bars[rows % 2];</span>
<span class="nc" id="L1413">			rows++;</span>
		}
<span class="nc" id="L1415">		double hSpace = union.getWidth() / (2 * maxCols);</span>
<span class="nc" id="L1416">		double vSpace = union.getHeight() / (2 * rows);</span>
<span class="nc" id="L1417">		double y = 0;</span>
<span class="nc" id="L1418">		GeneralPath grid = new GeneralPath();</span>
<span class="nc" id="L1419">		int count = 1;</span>
<span class="nc bnc" id="L1420" title="All 2 branches missed.">		for (int row = 0; row &lt; rows; row++) {</span>
<span class="nc" id="L1421">			int cols = bars[row % 2];</span>
<span class="nc bnc" id="L1422" title="All 2 branches missed.">			double x = (cols == maxCols) ? 0 : hSpace;</span>
<span class="nc bnc" id="L1423" title="All 2 branches missed.">			for (int col = 0; col &lt; cols; col++) {</span>
<span class="nc bnc" id="L1424" title="All 2 branches missed.">				if (count &gt; stars) {</span>
<span class="nc" id="L1425">					break;</span>
				}
<span class="nc" id="L1427">				grid.append(getStar(x, y), false);</span>
<span class="nc" id="L1428">				x += 2 * hSpace;</span>
<span class="nc" id="L1429">				count++;</span>
			}
<span class="nc" id="L1431">			y += 2 * vSpace;</span>
		}
<span class="nc" id="L1433">		return grid;</span>
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span></div></body></html>