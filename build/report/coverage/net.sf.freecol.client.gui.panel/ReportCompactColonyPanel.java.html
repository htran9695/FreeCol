<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ReportCompactColonyPanel.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">jacocoReport</a> &gt; <a href="index.source.html" class="el_package">net.sf.freecol.client.gui.panel</a> &gt; <span class="el_source">ReportCompactColonyPanel.java</span></div><h1>ReportCompactColonyPanel.java</h1><pre class="source lang-java linenums">/**
 *  Copyright (C) 2002-2015   The FreeCol Team
 *
 *  This file is part of FreeCol.
 *
 *  FreeCol is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation, either version 2 of the License, or
 *  (at your option) any later version.
 *
 *  FreeCol is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License
 *  along with FreeCol.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
 */

package net.sf.freecol.client.gui.panel;

import java.awt.Color;
import java.awt.Font;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.util.ArrayList;
import java.util.Collections;
import java.util.Comparator;
import java.util.Iterator;
import java.util.Map;
import java.util.Map.Entry;
import java.util.HashMap;
import java.util.List;
import java.util.function.BinaryOperator;

import javax.swing.ImageIcon;
import javax.swing.JButton;
import javax.swing.JComponent;
import javax.swing.JLabel;
import javax.swing.JSeparator;
import javax.swing.SwingConstants;

import net.miginfocom.swing.MigLayout;

import net.sf.freecol.client.FreeColClient;
import net.sf.freecol.client.gui.ImageLibrary;
import net.sf.freecol.common.i18n.Messages;
import net.sf.freecol.common.model.Ability;
import net.sf.freecol.common.model.AbstractGoods;
import net.sf.freecol.common.model.BuildableType;
import net.sf.freecol.common.model.Building;
import net.sf.freecol.common.model.Colony;
import net.sf.freecol.common.model.Colony.TileImprovementSuggestion;
import net.sf.freecol.common.model.ExportData;
import net.sf.freecol.common.model.FreeColObject;
import net.sf.freecol.common.model.Game;
import net.sf.freecol.common.model.GoodsContainer;
import net.sf.freecol.common.model.GoodsType;
import net.sf.freecol.common.model.Market;
import net.sf.freecol.common.model.Player;
import net.sf.freecol.common.model.ProductionInfo;
import net.sf.freecol.common.model.Region;
import net.sf.freecol.common.model.Specification;
import net.sf.freecol.common.model.StringTemplate;
import net.sf.freecol.common.model.Tile;
import net.sf.freecol.common.model.TileImprovementType;
import net.sf.freecol.common.model.Unit;
import net.sf.freecol.common.model.UnitType;
import net.sf.freecol.common.model.WorkLocation;
import net.sf.freecol.common.model.WorkLocation.Suggestion;
import net.sf.freecol.common.resources.ResourceManager;
import static net.sf.freecol.common.util.CollectionUtils.*;

/**
 * This panel displays the compact colony report.
 */
public final class ReportCompactColonyPanel extends ReportPanel implements ActionListener {

	/** Container class for all the information about a colony. */
	private static class ColonySummary {

		/** Types of production for a given goods type. */
<span class="nc" id="L83">		public static enum ProductionStatus {</span>

			/** The fail. */
<span class="nc" id="L86">			FAIL,</span>
			/** The bad. */
			// Negative production and below low alarm level
<span class="nc" id="L89">			BAD,</span>
			/** The none. */
			// Negative production
<span class="nc" id="L92">			NONE,</span>
			/** The zero. */
			// No production at all
<span class="nc" id="L95">			ZERO,</span>
			/** The good. */
			// Production == consumption
<span class="nc" id="L98">			GOOD,</span>
			/** The export. */
			// Positive production
<span class="nc" id="L101">			EXPORT,</span>
			/** The excess. */
			// Positive production and exporting
<span class="nc" id="L104">			EXCESS,</span>
			/** The overflow. */
			// Positive production and above high alarm level
<span class="nc" id="L107">			OVERFLOW,</span>
			/** The production. */
			// Positive production and above capacity
<span class="nc" id="L110">			PRODUCTION,</span>
			/** The consumption. */
			// Positive production but could produce more
<span class="nc" id="L113">			CONSUMPTION, // Positive production but could consume more</span>
		};

		/** The goods production accumulator. */
<span class="nc" id="L117">		public static BinaryOperator&lt;GoodsProduction&gt; goodsProductionAccumulator = (g1, g2) -&gt; {</span>
<span class="nc" id="L118">			g1.amount += g2.amount;</span>
<span class="nc bnc" id="L119" title="All 8 branches missed.">			g1.status = (g1.status == ProductionStatus.NONE &amp;&amp; g2.status == ProductionStatus.NONE)</span>
					? ProductionStatus.NONE
					: (g1.amount &lt; 0) ? ProductionStatus.BAD
							: (g1.amount &gt; 0) ? ProductionStatus.GOOD : ProductionStatus.ZERO;
<span class="nc" id="L123">			g1.extra = 0;</span>
<span class="nc" id="L124">			return g1;</span>
		};

		/** Container class for goods production. */
		public static class GoodsProduction {

			/** The amount. */
			public int amount;

			/** The status. */
			public ProductionStatus status;

			/** The extra. */
			public int extra;

			/**
			 * Instantiates a new goods production.
			 *
			 * @param amount
			 *            the amount
			 * @param status
			 *            the status
			 * @param extra
			 *            the extra
			 */
<span class="nc" id="L149">			public GoodsProduction(int amount, ProductionStatus status, int extra) {</span>
<span class="nc" id="L150">				this.amount = amount;</span>
<span class="nc" id="L151">				this.status = status;</span>
<span class="nc" id="L152">				this.extra = extra;</span>
<span class="nc" id="L153">			}</span>
		};

		/** The colony being summarized. */
		public final Colony colony;

		/** The level of teaching-building. */
		public final int schoolLevel;

		/** Possible tile improvements. */
<span class="nc" id="L163">		public final List&lt;TileImprovementSuggestion&gt; tileSuggestions = new ArrayList&lt;&gt;();</span>

		/** Famine warning required?. */
		public final boolean famine;

		/**
		 * Turns to new colonist if positive, no colonist if zero, -turns-1 to
		 * starvation if negative.
		 */
		public final int newColonist;

		/** Current production bonus. */
		public final int bonus;

		/** Preferred size change. */
		public final int sizeChange;

		/** Goods production. */
<span class="nc" id="L181">		public final Map&lt;GoodsType, GoodsProduction&gt; production = new HashMap&lt;&gt;();</span>

		/** Teacher units mapped to turns to complete. */
<span class="nc" id="L184">		public final Map&lt;Unit, Integer&gt; teachers = new HashMap&lt;&gt;();</span>
		/** Units present that are not working. */
<span class="nc" id="L186">		public final List&lt;Unit&gt; notWorking = new ArrayList&lt;&gt;();</span>
		/** Units present that might be working. */
<span class="nc" id="L188">		public final List&lt;UnitType&gt; couldWork = new ArrayList&lt;&gt;();</span>
		/** Suggested better unit use. */
<span class="nc" id="L190">		public final Map&lt;UnitType, Suggestion&gt; improve = new HashMap&lt;&gt;();</span>
		/** Suggested new unit use. */
<span class="nc" id="L192">		public final Map&lt;UnitType, Suggestion&gt; want = new HashMap&lt;&gt;();</span>

		/** Currently building. */
		public final BuildableType build;

		/** The complete turns. */
		public final int completeTurns;

		/** The needed. */
		public final AbstractGoods needed;

		/**
		 * Create the colony summary.
		 *
		 * @param colony
		 *            The &lt;code&gt;Colony&lt;/code&gt; to summarize.
		 * @param goodsTypes
		 *            A list of &lt;code&gt;GoodsType&lt;/code&gt;s to include in the
		 *            summary.
		 */
<span class="nc" id="L212">		public ColonySummary(Colony colony, List&lt;GoodsType&gt; goodsTypes) {</span>
<span class="nc" id="L213">			this.colony = colony;</span>

<span class="nc" id="L215">			WorkLocation school = colony.getWorkLocationWithAbility(Ability.TEACH);</span>
<span class="nc bnc" id="L216" title="All 2 branches missed.">			this.schoolLevel = (school instanceof Building) ? ((Building) school).getLevel() : 0;</span>

<span class="nc" id="L218">			final Specification spec = colony.getSpecification();</span>
<span class="nc" id="L219">			final Player owner = colony.getOwner();</span>
<span class="nc" id="L220">			final GoodsType foodType = spec.getPrimaryFoodType();</span>

<span class="nc" id="L222">			this.tileSuggestions.clear();</span>
<span class="nc" id="L223">			this.tileSuggestions.addAll(colony.getTileImprovementSuggestions());</span>

<span class="nc" id="L225">			int starve = colony.getStarvationTurns();</span>
<span class="nc bnc" id="L226" title="All 2 branches missed.">			if (starve &lt; 0) {</span>
<span class="nc" id="L227">				this.famine = false;</span>
<span class="nc" id="L228">				this.newColonist = colony.getNewColonistTurns();</span>
			} else {
<span class="nc bnc" id="L230" title="All 2 branches missed.">				this.famine = starve &lt;= Colony.FAMINE_TURNS;</span>
<span class="nc" id="L231">				this.newColonist = -starve - 1;</span>
			}

<span class="nc" id="L234">			this.bonus = colony.getProductionBonus();</span>

<span class="nc" id="L236">			this.sizeChange = colony.getPreferredSizeChange();</span>

<span class="nc bnc" id="L238" title="All 2 branches missed.">			for (GoodsType gt : goodsTypes)</span>
<span class="nc" id="L239">				produce(gt);</span>

<span class="nc bnc" id="L241" title="All 2 branches missed.">			for (Unit u : colony.getTile().getUnitList()) {</span>
<span class="nc bnc" id="L242" title="All 4 branches missed.">				if (u.getState() != Unit.UnitState.FORTIFIED &amp;&amp; u.getState() != Unit.UnitState.SENTRY) {</span>
<span class="nc" id="L243">					this.notWorking.add(u);</span>
				}
<span class="nc" id="L245">			}</span>

			// Collect the types of the units at work in the colony
			// (colony tiles and buildings) that are suboptimal (and
			// are not just temporarily there because they are being
			// taught), the types for sites that really need a new
			// unit, the teachers, and the units that are not working.
			//
			// FIXME: this needs to be merged with the requirements
			// checking code, but that in turn should be opened up
			// so the AI can use it...
<span class="nc bnc" id="L256" title="All 2 branches missed.">			for (WorkLocation wl : colony.getAvailableWorkLocations()) {</span>
<span class="nc bnc" id="L257" title="All 2 branches missed.">				if (!wl.canBeWorked())</span>
<span class="nc" id="L258">					continue;</span>
<span class="nc bnc" id="L259" title="All 2 branches missed.">				if (wl.canTeach()) {</span>
<span class="nc bnc" id="L260" title="All 2 branches missed.">					for (Unit u : wl.getUnitList()) {</span>
<span class="nc" id="L261">						teachers.put(u, u.getNeededTurnsOfTraining() - u.getTurnsOfTraining());</span>
<span class="nc" id="L262">					}</span>
<span class="nc" id="L263">					continue;</span>
				}

				// Check if the units are working.
<span class="nc bnc" id="L267" title="All 2 branches missed.">				for (Unit u : wl.getUnitList()) {</span>
<span class="nc bnc" id="L268" title="All 4 branches missed.">					if (u.getTeacher() == null &amp;&amp; u.getWorkType() == null) {</span>
<span class="nc" id="L269">						this.notWorking.add(u);</span>
					}
<span class="nc" id="L271">				}</span>

				// Add work location suggestions.
<span class="nc bnc" id="L274" title="All 2 branches missed.">				for (Entry&lt;Unit, Suggestion&gt; e : wl.getSuggestions().entrySet()) {</span>
<span class="nc" id="L275">					Unit u = e.getKey();</span>
<span class="nc" id="L276">					Suggestion s = e.getValue();</span>
<span class="nc" id="L277">					UnitType expert = spec.getExpertForProducing(s.goodsType);</span>
<span class="nc bnc" id="L278" title="All 2 branches missed.">					if (u == null) {</span>
<span class="nc" id="L279">						addSuggestion(this.want, expert, s);</span>
					} else {
<span class="nc" id="L281">						addSuggestion(this.improve, expert, s);</span>
					}
<span class="nc" id="L283">				}</span>
<span class="nc" id="L284">			}</span>

			// Make a list of unit types that are not working at their
			// speciality, including the units just standing around.
<span class="nc bnc" id="L288" title="All 2 branches missed.">			for (Unit u : this.notWorking) {</span>
<span class="nc" id="L289">				GoodsType t = u.getWorkType();</span>
<span class="nc" id="L290">				WorkLocation wl = u.getWorkLocation();</span>
<span class="nc bnc" id="L291" title="All 2 branches missed.">				if (wl == null)</span>
<span class="nc" id="L292">					continue;</span>
<span class="nc" id="L293">				GoodsType w = wl.getWorkFor(u);</span>
<span class="nc bnc" id="L294" title="All 4 branches missed.">				if (w == null || w != t)</span>
<span class="nc" id="L295">					this.couldWork.add(u.getType());</span>
<span class="nc" id="L296">			}</span>

<span class="nc" id="L298">			this.build = colony.getCurrentlyBuilding();</span>
<span class="nc bnc" id="L299" title="All 2 branches missed.">			if (this.build == null) {</span>
<span class="nc" id="L300">				this.completeTurns = -1;</span>
<span class="nc" id="L301">				this.needed = null;</span>
			} else {
<span class="nc" id="L303">				AbstractGoods needed = new AbstractGoods();</span>
<span class="nc" id="L304">				this.completeTurns = colony.getTurnsToComplete(build, needed);</span>
<span class="nc bnc" id="L305" title="All 2 branches missed.">				this.needed = (this.completeTurns &lt; 0) ? needed : null;</span>
			}
<span class="nc" id="L307">		}</span>

		/**
		 * Set the production map values for the given goods type.
		 *
		 * @param goodsType
		 *            The &lt;code&gt;GoodsType&lt;/code&gt; to use.
		 */
		private void produce(GoodsType goodsType) {
<span class="nc" id="L316">			final ExportData exportData = colony.getExportData(goodsType);</span>
<span class="nc" id="L317">			final int adjustment = colony.getWarehouseCapacity() / GoodsContainer.CARGO_SIZE;</span>
<span class="nc" id="L318">			final int low = exportData.getLowLevel() * adjustment;</span>
<span class="nc" id="L319">			final int high = exportData.getHighLevel() * adjustment;</span>
<span class="nc" id="L320">			final int amount = colony.getGoodsCount(goodsType);</span>
<span class="nc" id="L321">			int p = colony.getAdjustedNetProductionOf(goodsType);</span>

			ProductionStatus status;
			AbstractGoods deficit;
<span class="nc" id="L325">			int extra = 0;</span>
<span class="nc bnc" id="L326" title="All 2 branches missed.">			if (p &lt; 0) {</span>
<span class="nc bnc" id="L327" title="All 2 branches missed.">				status = (amount &lt; low) ? ProductionStatus.FAIL : ProductionStatus.BAD;</span>
<span class="nc" id="L328">				extra = -amount / p + 1;</span>
<span class="nc bnc" id="L329" title="All 4 branches missed.">			} else if (p == 0 &amp;&amp; !colony.isProducing(goodsType)) {</span>
<span class="nc" id="L330">				status = ProductionStatus.NONE;</span>
<span class="nc bnc" id="L331" title="All 2 branches missed.">			} else if (p == 0) {</span>
<span class="nc" id="L332">				status = ProductionStatus.ZERO;</span>
<span class="nc" id="L333">				extra = 0;</span>
<span class="nc" id="L334">				deficit = null;</span>
<span class="nc bnc" id="L335" title="All 2 branches missed.">				for (WorkLocation wl : colony.getWorkLocationsForProducing(goodsType)) {</span>
<span class="nc" id="L336">					ProductionInfo pi = colony.getProductionInfo(wl);</span>
<span class="nc bnc" id="L337" title="All 2 branches missed.">					if (pi == null)</span>
<span class="nc" id="L338">						continue;</span>
<span class="nc" id="L339">					deficit = AbstractGoods.findByType(goodsType, pi.getConsumptionDeficit());</span>
<span class="nc bnc" id="L340" title="All 2 branches missed.">					if (deficit != null) {</span>
<span class="nc" id="L341">						status = ProductionStatus.CONSUMPTION;</span>
<span class="nc" id="L342">						extra = deficit.getAmount();</span>
<span class="nc" id="L343">						break;</span>
					}
<span class="nc" id="L345">				}</span>
<span class="nc bnc" id="L346" title="All 2 branches missed.">			} else if (exportData.getExported()) {</span>
<span class="nc" id="L347">				status = ProductionStatus.EXPORT;</span>
<span class="nc" id="L348">				extra = exportData.getExportLevel();</span>
<span class="nc bnc" id="L349" title="All 2 branches missed.">			} else if (goodsType.limitIgnored()) {</span>
<span class="nc" id="L350">				status = ProductionStatus.GOOD;</span>
<span class="nc bnc" id="L351" title="All 2 branches missed.">			} else if (amount + p &gt; colony.getWarehouseCapacity()) {</span>
<span class="nc" id="L352">				status = ProductionStatus.OVERFLOW;</span>
<span class="nc" id="L353">				extra = amount + p - colony.getWarehouseCapacity();</span>
<span class="nc bnc" id="L354" title="All 2 branches missed.">			} else if (amount &gt;= high) {</span>
<span class="nc" id="L355">				status = ProductionStatus.EXCESS;</span>
<span class="nc" id="L356">				extra = (colony.getWarehouseCapacity() - amount) / p;</span>
			} else {
<span class="nc" id="L358">				status = ProductionStatus.GOOD;</span>
<span class="nc" id="L359">				extra = 0;</span>
<span class="nc" id="L360">				deficit = null;</span>
<span class="nc bnc" id="L361" title="All 2 branches missed.">				for (WorkLocation wl : colony.getWorkLocationsForProducing(goodsType)) {</span>
<span class="nc" id="L362">					ProductionInfo pi = colony.getProductionInfo(wl);</span>
<span class="nc bnc" id="L363" title="All 2 branches missed.">					if (pi == null)</span>
<span class="nc" id="L364">						continue;</span>
<span class="nc" id="L365">					deficit = AbstractGoods.findByType(goodsType, pi.getProductionDeficit());</span>
<span class="nc bnc" id="L366" title="All 2 branches missed.">					if (deficit != null) {</span>
<span class="nc" id="L367">						status = ProductionStatus.PRODUCTION;</span>
<span class="nc" id="L368">						extra = deficit.getAmount();</span>
<span class="nc" id="L369">						break;</span>
					}
<span class="nc" id="L371">				}</span>
			}
<span class="nc" id="L373">			this.production.put(goodsType, new GoodsProduction(p, status, extra));</span>
<span class="nc" id="L374">		}</span>

		/**
		 * Adds the suggestion.
		 *
		 * @param suggestions
		 *            the suggestions
		 * @param expert
		 *            the expert
		 * @param suggestion
		 *            the suggestion
		 */
		private void addSuggestion(Map&lt;UnitType, Suggestion&gt; suggestions, UnitType expert, Suggestion suggestion) {
<span class="nc bnc" id="L387" title="All 4 branches missed.">			if (suggestion == null || expert == null)</span>
<span class="nc" id="L388">				return;</span>
<span class="nc" id="L389">			Suggestion now = suggestions.get(expert);</span>
<span class="nc bnc" id="L390" title="All 4 branches missed.">			if (now == null || now.amount &lt; suggestion.amount) {</span>
<span class="nc" id="L391">				suggestions.put(expert, suggestion);</span>
			}
<span class="nc" id="L393">		}</span>
	};

	/** The Constant BUILDQUEUE. */
	private static final String BUILDQUEUE = &quot;buildQueue.&quot;;

	/** The Constant cAlarmKey. */
	private static final String cAlarmKey = &quot;color.report.colony.alarm&quot;;

	/** The Constant cWarnKey. */
	private static final String cWarnKey = &quot;color.report.colony.warning&quot;;

	/** The Constant cPlainKey. */
	private static final String cPlainKey = &quot;color.report.colony.plain&quot;;

	/** The Constant cExportKey. */
	private static final String cExportKey = &quot;color.report.colony.export&quot;;

	/** The Constant cGoodKey. */
	private static final String cGoodKey = &quot;color.report.colony.good&quot;;

	/** The c alarm. */
<span class="nc" id="L415">	private static Color cAlarm = null;</span>

	/** The c warn. */
	private static Color cWarn;

	/** The c plain. */
	private static Color cPlain;

	/** The c export. */
	private static Color cExport;

	/** The c good. */
	private static Color cGood;

	/** The spec. */
	private final Specification spec;

	/** The lib. */
	private final ImageLibrary lib;

	/** The colonies. */
<span class="nc" id="L436">	private final List&lt;List&lt;Colony&gt;&gt; colonies = new ArrayList&lt;&gt;();</span>

	/** The market. */
	private final Market market;

	/** The goods types. */
<span class="nc" id="L442">	private final List&lt;GoodsType&gt; goodsTypes = new ArrayList&lt;&gt;();</span>

	/**
	 * Creates a compact colony report.
	 *
	 * @param freeColClient
	 *            The &lt;code&gt;FreeColClient&lt;/code&gt; for the game.
	 */
	public ReportCompactColonyPanel(FreeColClient freeColClient) {
<span class="nc" id="L451">		super(freeColClient, &quot;reportColonyAction&quot;);</span>

<span class="nc" id="L453">		final Player player = getMyPlayer();</span>
<span class="nc" id="L454">		final Comparator&lt;Colony&gt; colonyComparator = freeColClient.getClientOptions().getColonyComparator();</span>
<span class="nc" id="L455">		final Comparator&lt;List&lt;Colony&gt;&gt; firstColonyComparator = new Comparator&lt;List&lt;Colony&gt;&gt;() {</span>
			@Override
			public int compare(List&lt;Colony&gt; l1, List&lt;Colony&gt; l2) {
<span class="nc" id="L458">				return colonyComparator.compare(l1.get(0), l2.get(0));</span>
			}
		};

<span class="nc" id="L462">		this.spec = getSpecification();</span>
<span class="nc" id="L463">		this.lib = getImageLibrary();</span>

		// Sort the colonies by continent.
<span class="nc" id="L466">		final Map&lt;Integer, List&lt;Colony&gt;&gt; continents = new HashMap&lt;&gt;();</span>
<span class="nc bnc" id="L467" title="All 2 branches missed.">		for (Colony c : freeColClient.getMySortedColonies()) {</span>
<span class="nc bnc" id="L468" title="All 2 branches missed.">			if (c.getUnitCount() &gt; 0) {</span>
				// Do not include colonies that have been abandoned
				// but are still on the colonies list.
<span class="nc" id="L471">				appendToMapList(continents, c.getTile().getContiguity(), c);</span>
			}
<span class="nc" id="L473">		}</span>
<span class="nc bnc" id="L474" title="All 2 branches missed.">		for (Entry&lt;Integer, List&lt;Colony&gt;&gt; e : mapEntriesByValue(continents, firstColonyComparator)) {</span>
<span class="nc" id="L475">			this.colonies.add(e.getValue());</span>
<span class="nc" id="L476">		}</span>

<span class="nc" id="L478">		this.market = player.getMarket();</span>

<span class="nc" id="L480">		this.goodsTypes.addAll(spec.getGoodsTypeList());</span>
<span class="nc" id="L481">		Iterator&lt;GoodsType&gt; gti = goodsTypes.iterator();</span>
<span class="nc bnc" id="L482" title="All 2 branches missed.">		while (gti.hasNext()) {</span>
<span class="nc" id="L483">			GoodsType gt = gti.next();</span>
<span class="nc bnc" id="L484" title="All 4 branches missed.">			if (!gt.isStorable() || gt.isTradeGoods())</span>
<span class="nc" id="L485">				gti.remove();</span>
<span class="nc" id="L486">		}</span>
<span class="nc" id="L487">		Collections.sort(this.goodsTypes, GoodsType.goodsTypeComparator);</span>

<span class="nc" id="L489">		loadResources();</span>

<span class="nc" id="L491">		update();</span>
<span class="nc" id="L492">	}</span>

	/**
	 * Load resources.
	 */
	private synchronized void loadResources() {
<span class="nc bnc" id="L498" title="All 2 branches missed.">		if (cAlarm != null)</span>
<span class="nc" id="L499">			return;</span>

<span class="nc bnc" id="L501" title="All 2 branches missed.">		cAlarm = (ResourceManager.hasColorResource(cAlarmKey)) ? ResourceManager.getColor(cAlarmKey) : Color.RED;</span>
<span class="nc bnc" id="L502" title="All 2 branches missed.">		cWarn = (ResourceManager.hasColorResource(cWarnKey)) ? ResourceManager.getColor(cWarnKey) : Color.MAGENTA;</span>
<span class="nc bnc" id="L503" title="All 2 branches missed.">		cPlain = (ResourceManager.hasColorResource(cPlainKey)) ? ResourceManager.getColor(cPlainKey) : Color.DARK_GRAY;</span>
<span class="nc bnc" id="L504" title="All 2 branches missed.">		cExport = (ResourceManager.hasColorResource(cExportKey)) ? ResourceManager.getColor(cExportKey) : Color.GREEN;</span>
<span class="nc bnc" id="L505" title="All 2 branches missed.">		cGood = (ResourceManager.hasColorResource(cGoodKey)) ? ResourceManager.getColor(cGoodKey) : Color.BLUE;</span>
<span class="nc" id="L506">	}</span>

	/**
	 * Stpl.
	 *
	 * @param messageId
	 *            the message id
	 * @return the string template
	 */
	private static StringTemplate stpl(String messageId) {
<span class="nc bnc" id="L516" title="All 2 branches missed.">		return (Messages.containsKey(messageId)) ? StringTemplate.template(messageId) : null;</span>
	}

	/**
	 * Stpld.
	 *
	 * @param messageId
	 *            the message id
	 * @return the string template
	 */
	private static StringTemplate stpld(String messageId) {
<span class="nc" id="L527">		messageId = Messages.descriptionKey(messageId);</span>
<span class="nc" id="L528">		return stpl(messageId);</span>
	}

	/**
	 * New label.
	 *
	 * @param h
	 *            the h
	 * @param i
	 *            the i
	 * @param c
	 *            the c
	 * @return the j label
	 */
	private JLabel newLabel(String h, ImageIcon i, Color c) {
<span class="nc" id="L543">		JLabel l = new JLabel(h, i, SwingConstants.CENTER);</span>
<span class="nc bnc" id="L544" title="All 2 branches missed.">		l.setForeground((c == null) ? Color.BLACK : c);</span>
<span class="nc" id="L545">		return l;</span>
	}

	/**
	 * New label.
	 *
	 * @param h
	 *            the h
	 * @param i
	 *            the i
	 * @param c
	 *            the c
	 * @param t
	 *            the t
	 * @return the j label
	 */
	private JLabel newLabel(String h, ImageIcon i, Color c, StringTemplate t) {
<span class="nc bnc" id="L562" title="All 4 branches missed.">		if (h != null &amp;&amp; Messages.containsKey(h))</span>
<span class="nc" id="L563">			h = Messages.message(h);</span>
<span class="nc" id="L564">		JLabel l = newLabel(h, i, c);</span>
<span class="nc bnc" id="L565" title="All 2 branches missed.">		if (t != null)</span>
<span class="nc" id="L566">			Utility.localizeToolTip(l, t);</span>
<span class="nc" id="L567">		return l;</span>
	}

	/**
	 * New button.
	 *
	 * @param action
	 *            the action
	 * @param h
	 *            the h
	 * @param i
	 *            the i
	 * @param c
	 *            the c
	 * @param t
	 *            the t
	 * @return the j button
	 */
	private JButton newButton(String action, String h, ImageIcon i, Color c, StringTemplate t) {
<span class="nc bnc" id="L586" title="All 4 branches missed.">		if (h != null &amp;&amp; Messages.containsKey(h))</span>
<span class="nc" id="L587">			h = Messages.message(h);</span>
<span class="nc" id="L588">		JButton b = Utility.getLinkButton(h, i, action);</span>
<span class="nc bnc" id="L589" title="All 2 branches missed.">		b.setForeground((c == null) ? Color.BLACK : c);</span>
<span class="nc bnc" id="L590" title="All 2 branches missed.">		if (t != null)</span>
<span class="nc" id="L591">			Utility.localizeToolTip(b, t);</span>
<span class="nc" id="L592">		b.addActionListener(this);</span>
<span class="nc" id="L593">		return b;</span>
	}

	/**
	 * Adds the together.
	 *
	 * @param components
	 *            the components
	 */
	private void addTogether(List&lt;? extends JComponent&gt; components) {
<span class="nc bnc" id="L603" title="All 2 branches missed.">		if (components.isEmpty()) {</span>
<span class="nc" id="L604">			reportPanel.add(new JLabel());</span>
<span class="nc" id="L605">			return;</span>
		}
<span class="nc bnc" id="L607" title="All 2 branches missed.">		String layout = (components.size() &gt; 1) ? &quot;split &quot; + components.size() : null;</span>
<span class="nc bnc" id="L608" title="All 2 branches missed.">		for (JComponent jc : components) {</span>
<span class="nc" id="L609">			reportPanel.add(jc, layout);</span>
<span class="nc" id="L610">			layout = null;</span>
<span class="nc" id="L611">		}</span>
<span class="nc" id="L612">	}</span>

	/**
	 * Update a single colony.
	 *
	 * @param s
	 *            The &lt;code&gt;ColonySummary&lt;/code&gt; to update from.
	 */
	private void updateColony(ColonySummary s) {
<span class="nc" id="L621">		final String cac = s.colony.getId();</span>
<span class="nc" id="L622">		final UnitType defaultUnitType = spec.getDefaultUnitType(s.colony.getOwner());</span>
<span class="nc" id="L623">		List&lt;JComponent&gt; buttons = new ArrayList&lt;&gt;();</span>
		JButton b;
		Color c;
		StringTemplate t;

		// Field: A button for the colony.
		// Colour: bonus in {-2,2} =&gt; {alarm, warn, plain, export, good}
		// Font: Bold if famine is threatening.
<span class="nc bnc" id="L631" title="All 8 branches missed.">		c = (s.bonus &lt;= -2) ? cAlarm</span>
				: (s.bonus == -1) ? cWarn : (s.bonus == 0) ? cPlain : (s.bonus == 1) ? cExport : cGood;
<span class="nc" id="L633">		b = newButton(cac, s.colony.getName(), null, c, null);</span>
<span class="nc bnc" id="L634" title="All 2 branches missed.">		if (s.famine)</span>
<span class="nc" id="L635">			b.setFont(b.getFont().deriveFont(Font.BOLD));</span>
<span class="nc" id="L636">		reportPanel.add(b, &quot;newline&quot;);</span>

		// Field: The number of colonists that can be added to a
		// colony without damaging the production bonus, unless
		// the colony is inefficient in which case add the number
		// of colonists to remove to fix the inefficiency.
		// Colour: Blue if efficient/Red if inefficient.
<span class="nc bnc" id="L643" title="All 2 branches missed.">		if (s.sizeChange &lt; 0) {</span>
<span class="nc" id="L644">			c = cAlarm;</span>
<span class="nc" id="L645">			t = stpld(&quot;report.colony.shrinking&quot;).addName(&quot;%colony%&quot;, s.colony.getName()).addAmount(&quot;%amount%&quot;,</span>
<span class="nc" id="L646">					-s.sizeChange);</span>
<span class="nc" id="L647">			b = newButton(cac, Integer.toString(-s.sizeChange), null, c, t);</span>
<span class="nc bnc" id="L648" title="All 2 branches missed.">		} else if (s.sizeChange &gt; 0) {</span>
<span class="nc" id="L649">			c = cGood;</span>
<span class="nc" id="L650">			t = stpld(&quot;report.colony.growing&quot;).addName(&quot;%colony%&quot;, s.colony.getName()).addAmount(&quot;%amount%&quot;,</span>
<span class="nc" id="L651">					s.sizeChange);</span>
<span class="nc" id="L652">			b = newButton(cac, Integer.toString(s.sizeChange), null, c, t);</span>
		} else {
<span class="nc" id="L654">			b = null;</span>
		}
<span class="nc bnc" id="L656" title="All 2 branches missed.">		reportPanel.add((b == null) ? new JLabel() : b);</span>

		// Field: The number of potential colony tiles that need
		// exploring.
		// Colour: Always cAlarm
<span class="nc" id="L661">		int n = 0;</span>
<span class="nc bnc" id="L662" title="All 2 branches missed.">		for (TileImprovementSuggestion tis : s.tileSuggestions) {</span>
<span class="nc bnc" id="L663" title="All 2 branches missed.">			if (tis.isExploration())</span>
<span class="nc" id="L664">				n++;</span>
<span class="nc" id="L665">		}</span>
<span class="nc bnc" id="L666" title="All 2 branches missed.">		if (n &gt; 0) {</span>
<span class="nc" id="L667">			t = stpld(&quot;report.colony.exploring&quot;).addName(&quot;%colony%&quot;, s.colony.getName()).addAmount(&quot;%amount%&quot;, n);</span>
<span class="nc" id="L668">			b = newButton(cac, Integer.toString(n), null, cAlarm, t);</span>
		} else {
<span class="nc" id="L670">			b = null;</span>
		}
<span class="nc bnc" id="L672" title="All 2 branches missed.">		reportPanel.add((b == null) ? new JLabel() : b);</span>

		// Fields: The number of existing colony tiles that would
		// benefit from improvements.
		// Colour: Always cAlarm
		// Font: Bold if one of the tiles is the colony center.
<span class="nc bnc" id="L678" title="All 2 branches missed.">		for (TileImprovementType ti : spec.getTileImprovementTypeList()) {</span>
<span class="nc bnc" id="L679" title="All 2 branches missed.">			if (ti.isNatural())</span>
<span class="nc" id="L680">				continue;</span>
<span class="nc" id="L681">			n = 0;</span>
<span class="nc" id="L682">			boolean center = false;</span>
<span class="nc bnc" id="L683" title="All 2 branches missed.">			for (TileImprovementSuggestion tis : s.tileSuggestions) {</span>
<span class="nc bnc" id="L684" title="All 2 branches missed.">				if (tis.tileImprovementType == ti) {</span>
<span class="nc" id="L685">					n++;</span>
<span class="nc bnc" id="L686" title="All 2 branches missed.">					if (tis.tile == s.colony.getTile())</span>
<span class="nc" id="L687">						center = true;</span>
				}
<span class="nc" id="L689">			}</span>
<span class="nc bnc" id="L690" title="All 2 branches missed.">			if (n &gt; 0) {</span>
<span class="nc" id="L691">				c = cAlarm;</span>
<span class="nc bnc" id="L692" title="All 2 branches missed.">				if (n == 1) {</span>
<span class="nc" id="L693">					TileImprovementSuggestion tis = s.tileSuggestions.get(0);</span>
<span class="nc bnc" id="L694" title="All 2 branches missed.">					for (Unit u : tis.tile.getUnitList()) {</span>
<span class="nc bnc" id="L695" title="All 4 branches missed.">						if (u.getState() == Unit.UnitState.IMPROVING &amp;&amp; u.getWorkImprovement() != null</span>
<span class="nc bnc" id="L696" title="All 2 branches missed.">								&amp;&amp; u.getWorkImprovement().getType() == tis.tileImprovementType) {</span>
<span class="nc" id="L697">							c = cWarn; // Work is underway</span>
<span class="nc" id="L698">							break;</span>
						}
<span class="nc" id="L700">					}</span>
<span class="nc" id="L701">					t = stpld(&quot;report.colony.tile.&quot; + ti.getSuffix() + &quot;.specific&quot;)</span>
<span class="nc" id="L702">							.addName(&quot;%colony%&quot;, s.colony.getName())</span>
<span class="nc" id="L703">							.addStringTemplate(&quot;%location%&quot;, tis.tile.getColonyTileLocationLabel(s.colony));</span>
<span class="nc" id="L704">				} else {</span>
<span class="nc" id="L705">					t = stpld(&quot;report.colony.tile.&quot; + ti.getSuffix()).addName(&quot;%colony%&quot;, s.colony.getName())</span>
<span class="nc" id="L706">							.addAmount(&quot;%amount%&quot;, n);</span>
				}
<span class="nc" id="L708">				b = newButton(cac, Integer.toString(n), null, c, t);</span>
<span class="nc bnc" id="L709" title="All 2 branches missed.">				if (center)</span>
<span class="nc" id="L710">					b.setFont(b.getFont().deriveFont(Font.BOLD));</span>
			} else {
<span class="nc" id="L712">				b = null;</span>
			}
<span class="nc bnc" id="L714" title="All 2 branches missed.">			reportPanel.add((b == null) ? new JLabel() : b);</span>
<span class="nc" id="L715">		}</span>

		// Fields: The net production of each storable+non-trade-goods
		// goods type.
		// Colour: cAlarm if too low, cWarn if negative, empty if no
		// production, cPlain if production balanced at zero,
		// otherwise must be positive, wherein cExport
		// if exported, cAlarm if too high, else cGood.
<span class="nc bnc" id="L723" title="All 2 branches missed.">		for (GoodsType gt : this.goodsTypes) {</span>
<span class="nc" id="L724">			final ColonySummary.GoodsProduction gp = s.production.get(gt);</span>
<span class="nc bnc" id="L725" title="All 11 branches missed.">			switch (gp.status) {</span>
			case FAIL:
<span class="nc" id="L727">				c = cAlarm;</span>
<span class="nc" id="L728">				t = stpld(&quot;report.colony.production.low&quot;).addName(&quot;%colony%&quot;, s.colony.getName())</span>
<span class="nc" id="L729">						.addNamed(&quot;%goods%&quot;, gt).addAmount(&quot;%amount%&quot;, -gp.amount).addAmount(&quot;%turns%&quot;, gp.extra);</span>
<span class="nc" id="L730">				break;</span>
			case BAD:
<span class="nc" id="L732">				c = cWarn;</span>
<span class="nc" id="L733">				t = stpld(&quot;report.colony.production&quot;).addName(&quot;%colony%&quot;, s.colony.getName()).addNamed(&quot;%goods%&quot;, gt)</span>
<span class="nc" id="L734">						.addAmount(&quot;%amount%&quot;, gp.amount);</span>
<span class="nc" id="L735">				break;</span>
			case NONE:
<span class="nc" id="L737">				c = null;</span>
<span class="nc" id="L738">				t = null;</span>
<span class="nc" id="L739">				break;</span>
			case ZERO:
<span class="nc" id="L741">				c = cPlain;</span>
<span class="nc" id="L742">				t = stpld(&quot;report.colony.production&quot;).addName(&quot;%colony%&quot;, s.colony.getName()).addNamed(&quot;%goods%&quot;, gt)</span>
<span class="nc" id="L743">						.addAmount(&quot;%amount%&quot;, gp.amount);</span>
<span class="nc" id="L744">				break;</span>
			case GOOD:
<span class="nc" id="L746">				c = cGood;</span>
<span class="nc" id="L747">				t = stpld(&quot;report.colony.production&quot;).addName(&quot;%colony%&quot;, s.colony.getName()).addNamed(&quot;%goods%&quot;, gt)</span>
<span class="nc" id="L748">						.addAmount(&quot;%amount%&quot;, gp.amount);</span>
<span class="nc" id="L749">				break;</span>
			case EXPORT:
<span class="nc" id="L751">				c = cExport;</span>
<span class="nc" id="L752">				t = stpld(&quot;report.colony.production.export&quot;).addName(&quot;%colony%&quot;, s.colony.getName())</span>
<span class="nc" id="L753">						.addNamed(&quot;%goods%&quot;, gt).addAmount(&quot;%amount%&quot;, gp.amount).addAmount(&quot;%export%&quot;, gp.extra);</span>
<span class="nc" id="L754">				break;</span>
			case EXCESS:
<span class="nc" id="L756">				c = cWarn;</span>
<span class="nc" id="L757">				t = stpld(&quot;report.colony.production.high&quot;).addName(&quot;%colony%&quot;, s.colony.getName())</span>
<span class="nc" id="L758">						.addNamed(&quot;%goods%&quot;, gt).addAmount(&quot;%amount%&quot;, gp.amount).addAmount(&quot;%turns%&quot;, gp.extra);</span>
<span class="nc" id="L759">				break;</span>
			case OVERFLOW:
<span class="nc" id="L761">				c = cAlarm;</span>
<span class="nc" id="L762">				t = stpld(&quot;report.colony.production.waste&quot;).addName(&quot;%colony%&quot;, s.colony.getName())</span>
<span class="nc" id="L763">						.addNamed(&quot;%goods%&quot;, gt).addAmount(&quot;%amount%&quot;, gp.amount).addAmount(&quot;%waste%&quot;, gp.extra);</span>
<span class="nc" id="L764">				break;</span>
			case PRODUCTION:
<span class="nc" id="L766">				c = cWarn;</span>
<span class="nc" id="L767">				t = stpld(&quot;report.colony.production.maxProduction&quot;).addName(&quot;%colony%&quot;, s.colony.getName())</span>
<span class="nc" id="L768">						.addNamed(&quot;%goods%&quot;, gt).addAmount(&quot;%amount%&quot;, gp.amount).addAmount(&quot;%more%&quot;, gp.extra);</span>
<span class="nc" id="L769">				break;</span>
			case CONSUMPTION:
<span class="nc" id="L771">				c = cWarn;</span>
<span class="nc" id="L772">				t = stpld(&quot;report.colony.production.maxConsumption&quot;).addName(&quot;%colony%&quot;, s.colony.getName())</span>
<span class="nc" id="L773">						.addNamed(&quot;%goods%&quot;, gt).addAmount(&quot;%amount%&quot;, gp.amount).addAmount(&quot;%more%&quot;, gp.extra);</span>
<span class="nc" id="L774">				break;</span>
			default:
<span class="nc" id="L776">				throw new IllegalStateException(&quot;Bogus status: &quot; + gp.status);</span>
			}
<span class="nc bnc" id="L778" title="All 2 branches missed.">			reportPanel.add((c == null) ? new JLabel() : newButton(cac, Integer.toString(gp.amount), null, c, t));</span>
<span class="nc" id="L779">		}</span>

		// Field: New colonist arrival or famine warning.
		// Colour: cGood if arriving eventually, blank if not enough food
		// to grow, cWarn if negative, cAlarm if famine soon.
<span class="nc bnc" id="L784" title="All 2 branches missed.">		if (s.newColonist &gt; 0) {</span>
<span class="nc" id="L785">			t = stpld(&quot;report.colony.arriving&quot;).addName(&quot;%colony%&quot;, s.colony.getName())</span>
<span class="nc" id="L786">					.addNamed(&quot;%unit%&quot;, defaultUnitType).addAmount(&quot;%turns%&quot;, s.newColonist);</span>
<span class="nc" id="L787">			b = newButton(cac, Integer.toString(s.newColonist), null, cGood, t);</span>
<span class="nc bnc" id="L788" title="All 2 branches missed.">		} else if (s.newColonist &lt; 0) {</span>
<span class="nc bnc" id="L789" title="All 2 branches missed.">			c = (s.famine) ? cAlarm : cWarn;</span>
<span class="nc" id="L790">			t = stpld(&quot;report.colony.starving&quot;).addName(&quot;%colony%&quot;, s.colony.getName()).addAmount(&quot;%turns%&quot;,</span>
<span class="nc" id="L791">					-s.newColonist);</span>
<span class="nc" id="L792">			b = newButton(cac, Integer.toString(-s.newColonist), null, c, t);</span>
<span class="nc bnc" id="L793" title="All 2 branches missed.">			if (s.famine)</span>
<span class="nc" id="L794">				b.setFont(b.getFont().deriveFont(Font.BOLD));</span>
		} else {
<span class="nc" id="L796">			b = null;</span>
		}
<span class="nc bnc" id="L798" title="All 2 branches missed.">		reportPanel.add((b == null) ? new JLabel() : b);</span>

		// Field: What is currently being built (clickable if on the
		// buildqueue) and the turns until it completes, including
		// units being taught, or blank if nothing queued.
		// Colour: cWarn if no construction is occurring, cGood with
		// turns if completing, cAlarm with turns if will block, turns
		// indicates when blocking occurs.
		// Font: Bold if blocked right now.
<span class="nc" id="L807">		final String qac = BUILDQUEUE + cac;</span>
<span class="nc bnc" id="L808" title="All 2 branches missed.">		if (s.build != null) {</span>
<span class="nc" id="L809">			int turns = s.completeTurns;</span>
<span class="nc" id="L810">			String name = Messages.getName(s.build);</span>
<span class="nc bnc" id="L811" title="All 2 branches missed.">			if (turns == FreeColObject.UNDEFINED) {</span>
<span class="nc" id="L812">				t = stpld(&quot;report.colony.making.noconstruction&quot;).addName(&quot;%colony%&quot;, s.colony.getName());</span>
<span class="nc" id="L813">				b = newButton(qac, name, null, cWarn, t);</span>
<span class="nc bnc" id="L814" title="All 2 branches missed.">			} else if (turns &gt;= 0) {</span>
<span class="nc" id="L815">				t = stpld(&quot;report.colony.making.constructing&quot;).addName(&quot;%colony%&quot;, s.colony.getName())</span>
<span class="nc" id="L816">						.addNamed(&quot;%buildable%&quot;, s.build).addAmount(&quot;%turns%&quot;, turns);</span>
<span class="nc" id="L817">				b = newButton(qac, name + &quot; &quot; + Integer.toString(turns), null, cGood, t);</span>
<span class="nc bnc" id="L818" title="All 2 branches missed.">			} else if (turns &lt; 0) {</span>
<span class="nc" id="L819">				turns = -(turns + 1);</span>
<span class="nc" id="L820">				t = stpld(&quot;report.colony.making.blocking&quot;).addName(&quot;%colony%&quot;, s.colony.getName())</span>
<span class="nc" id="L821">						.addAmount(&quot;%amount%&quot;, s.needed.getAmount()).addNamed(&quot;%goods%&quot;, s.needed.getType())</span>
<span class="nc" id="L822">						.addNamed(&quot;%buildable%&quot;, s.build).addAmount(&quot;%turns%&quot;, turns);</span>
<span class="nc" id="L823">				b = newButton(qac, name + &quot; &quot; + Integer.toString(turns), null, cAlarm, t);</span>
<span class="nc bnc" id="L824" title="All 2 branches missed.">				if (turns == 0)</span>
<span class="nc" id="L825">					b.setFont(b.getFont().deriveFont(Font.BOLD));</span>
			}
<span class="nc" id="L827">			buttons.add(b);</span>
		}

		// Field: What is being trained, including shadow units for vacant
		// places.
		// Colour: cAlarm if completion is blocked, otherwise cPlain.
<span class="nc" id="L833">		int empty = 0;</span>
<span class="nc" id="L834">		Building school = s.colony.getWorkLocationWithAbility(Ability.TEACH, Building.class);</span>
<span class="nc bnc" id="L835" title="All 2 branches missed.">		if (school != null)</span>
<span class="nc" id="L836">			empty = school.getType().getWorkPlaces();</span>
<span class="nc bnc" id="L837" title="All 2 branches missed.">		for (Entry&lt;Unit, Integer&gt; e : mapEntriesByValue(s.teachers, descendingIntegerComparator)) {</span>
<span class="nc" id="L838">			Unit u = e.getKey();</span>
<span class="nc" id="L839">			ImageIcon ii = new ImageIcon(this.lib.getTinyUnitImage(u.getType(), false));</span>
<span class="nc bnc" id="L840" title="All 2 branches missed.">			if (e.getValue() &lt;= 0) {</span>
<span class="nc" id="L841">				t = stpld(&quot;report.colony.making.noteach&quot;).addName(&quot;%colony%&quot;, s.colony.getName())</span>
<span class="nc" id="L842">						.addStringTemplate(&quot;%teacher%&quot;, u.getLabel(Unit.UnitLabelType.NATIONAL));</span>
<span class="nc" id="L843">				b = newButton(cac, Integer.toString(0), ii, cAlarm, t);</span>
			} else {
<span class="nc" id="L845">				t = stpld(&quot;report.colony.making.educating&quot;).addName(&quot;%colony%&quot;, s.colony.getName())</span>
<span class="nc" id="L846">						.addStringTemplate(&quot;%teacher%&quot;, u.getLabel(Unit.UnitLabelType.NATIONAL))</span>
<span class="nc" id="L847">						.addAmount(&quot;%turns%&quot;, e.getValue());</span>
<span class="nc" id="L848">				b = newButton(cac, Integer.toString(e.getValue()), ii, cPlain, t);</span>
			}
<span class="nc" id="L850">			buttons.add(b);</span>
<span class="nc" id="L851">			empty--;</span>
<span class="nc" id="L852">		}</span>

<span class="nc bnc" id="L854" title="All 2 branches missed.">		if (empty &gt; 0) {</span>
<span class="nc" id="L855">			final ImageIcon emptyIcon = new ImageIcon(this.lib.getTinyUnitImage(defaultUnitType, true));</span>
<span class="nc" id="L856">			t = stpld(&quot;report.colony.making.educationVacancy&quot;).addName(&quot;%colony%&quot;, s.colony.getName())</span>
<span class="nc" id="L857">					.addAmount(&quot;%number%&quot;, empty);</span>
<span class="nc bnc" id="L858" title="All 2 branches missed.">			for (; empty &gt; 0; empty--) {</span>
<span class="nc" id="L859">				buttons.add(newButton(cac, &quot;&quot;, emptyIcon, cPlain, t));</span>
			}
		}
<span class="nc" id="L862">		addTogether(buttons);</span>

		// Field: The units that could be upgraded, followed by the units
		// that could be added.
<span class="nc bnc" id="L866" title="All 4 branches missed.">		if (s.improve.isEmpty() &amp;&amp; s.want.isEmpty()) {</span>
<span class="nc" id="L867">			reportPanel.add(new JLabel());</span>
		} else {
<span class="nc" id="L869">			buttons.clear();</span>
<span class="nc" id="L870">			buttons.addAll(unitButtons(s.improve, s.couldWork, s.colony));</span>
<span class="nc" id="L871">			buttons.add(new JLabel(&quot;/&quot;));</span>
			// Prefer to suggest an improvement over and addition.
<span class="nc bnc" id="L873" title="All 2 branches missed.">			for (UnitType ut : s.improve.keySet())</span>
<span class="nc" id="L874">				s.want.remove(ut);</span>
<span class="nc" id="L875">			buttons.addAll(unitButtons(s.want, s.couldWork, s.colony));</span>
<span class="nc" id="L876">			addTogether(buttons);</span>
		}

		// TODO: notWorking?
<span class="nc" id="L880">	}</span>

	/**
	 * Unit buttons.
	 *
	 * @param suggestions
	 *            the suggestions
	 * @param have
	 *            the have
	 * @param colony
	 *            the colony
	 * @return the list
	 */
	private List&lt;JButton&gt; unitButtons(final Map&lt;UnitType, Suggestion&gt; suggestions, List&lt;UnitType&gt; have, Colony colony) {
<span class="nc" id="L894">		final String cac = colony.getId();</span>
<span class="nc" id="L895">		List&lt;JButton&gt; result = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L896">		List&lt;UnitType&gt; types = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L897">		types.addAll(suggestions.keySet());</span>
<span class="nc" id="L898">		Collections.sort(types, new Comparator&lt;UnitType&gt;() {</span>
			@Override
			public int compare(UnitType t1, UnitType t2) {
<span class="nc" id="L901">				Suggestion s1 = suggestions.get(t1);</span>
<span class="nc" id="L902">				Suggestion s2 = suggestions.get(t2);</span>
<span class="nc" id="L903">				return Suggestion.descendingAmountComparator.compare(s1, s2);</span>
			}
		});
<span class="nc bnc" id="L906" title="All 2 branches missed.">		for (UnitType type : types) {</span>
<span class="nc" id="L907">			boolean present = have.contains(type);</span>
<span class="nc" id="L908">			Suggestion suggestion = suggestions.get(type);</span>
<span class="nc" id="L909">			String label = Integer.toString(suggestion.amount);</span>
<span class="nc" id="L910">			ImageIcon icon = new ImageIcon(this.lib.getTinyUnitImage(type, false));</span>
<span class="nc bnc" id="L911" title="All 2 branches missed.">			StringTemplate tip = (suggestion.oldType == null)</span>
<span class="nc" id="L912">					? stpld(&quot;report.colony.wanting&quot;).addName(&quot;%colony%&quot;, colony.getName()).addNamed(&quot;%unit%&quot;, type)</span>
<span class="nc" id="L913">							.addStringTemplate(&quot;%location%&quot;, suggestion.workLocation.getLabel())</span>
<span class="nc" id="L914">							.addNamed(&quot;%goods%&quot;, suggestion.goodsType).addAmount(&quot;%amount%&quot;, suggestion.amount)</span>
<span class="nc" id="L915">					: stpld(&quot;report.colony.improving&quot;).addName(&quot;%colony%&quot;, colony.getName())</span>
<span class="nc" id="L916">							.addNamed(&quot;%oldUnit%&quot;, suggestion.oldType).addNamed(&quot;%unit%&quot;, type)</span>
<span class="nc" id="L917">							.addStringTemplate(&quot;%location%&quot;, suggestion.workLocation.getLabel())</span>
<span class="nc" id="L918">							.addNamed(&quot;%goods%&quot;, suggestion.goodsType).addAmount(&quot;%amount%&quot;, suggestion.amount);</span>
<span class="nc bnc" id="L919" title="All 2 branches missed.">			JButton b = newButton(cac, label, icon, (present) ? cGood : cPlain, tip);</span>
<span class="nc bnc" id="L920" title="All 2 branches missed.">			if (present)</span>
<span class="nc" id="L921">				b.setFont(b.getFont().deriveFont(Font.BOLD));</span>
<span class="nc" id="L922">			result.add(b);</span>
<span class="nc" id="L923">		}</span>
<span class="nc" id="L924">		return result;</span>
	}

	/**
	 * Update several colonies.
	 *
	 * @param summaries
	 *            A list of &lt;code&gt;ColonySummary&lt;/code&gt;s to update from.
	 */
	private void updateCombinedColonies(List&lt;ColonySummary&gt; summaries) {
		JLabel l;
		Color c;
		StringTemplate t;

<span class="nc" id="L938">		reportPanel.add(new JSeparator(JSeparator.HORIZONTAL), &quot;newline, span, growx&quot;);</span>

		// Accumulate all the summaries
<span class="nc" id="L941">		Map&lt;Region, Integer&gt; rRegionMap = new HashMap&lt;&gt;();</span>
<span class="nc" id="L942">		List&lt;TileImprovementSuggestion&gt; rTileSuggestions = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L943">		int rFamine = 0, rBonus = 0, rSizeChange = 0, teacherLen = 0, improveLen = 0;</span>
<span class="nc" id="L944">		double rNewColonist = 0.0;</span>
<span class="nc" id="L945">		Map&lt;GoodsType, ColonySummary.GoodsProduction&gt; rProduction = new HashMap&lt;&gt;();</span>
<span class="nc" id="L946">		Map&lt;UnitType, Integer&gt; rTeachers = new HashMap&lt;&gt;();</span>
<span class="nc" id="L947">		List&lt;Unit&gt; rNotWorking = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L948">		List&lt;UnitType&gt; rCouldWork = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L949">		Map&lt;UnitType, Integer&gt; rImprove = new HashMap&lt;&gt;();</span>
<span class="nc" id="L950">		Map&lt;GoodsType, Double&gt; rNeeded = new HashMap&lt;&gt;();</span>
<span class="nc bnc" id="L951" title="All 2 branches missed.">		for (ColonySummary s : summaries) {</span>
<span class="nc" id="L952">			accumulateToMap(rRegionMap, s.colony.getTile().getRegion(), 1, integerAccumulator);</span>
<span class="nc" id="L953">			rTileSuggestions.addAll(s.tileSuggestions);</span>
<span class="nc bnc" id="L954" title="All 2 branches missed.">			if (s.famine)</span>
<span class="nc" id="L955">				rFamine++;</span>
<span class="nc bnc" id="L956" title="All 2 branches missed.">			if (s.newColonist &gt; 0)</span>
<span class="nc" id="L957">				rNewColonist += s.newColonist;</span>
<span class="nc" id="L958">			rBonus += s.bonus;</span>
<span class="nc" id="L959">			rSizeChange += s.sizeChange;</span>
<span class="nc" id="L960">			accumulateMap(rProduction, s.production, ColonySummary.goodsProductionAccumulator);</span>
<span class="nc" id="L961">			teacherLen = Math.max(teacherLen, s.teachers.size());</span>
<span class="nc bnc" id="L962" title="All 2 branches missed.">			for (Unit u : s.teachers.keySet()) {</span>
<span class="nc" id="L963">				accumulateToMap(rTeachers, u.getType(), 1, integerAccumulator);</span>
<span class="nc" id="L964">			}</span>
<span class="nc" id="L965">			rNotWorking.addAll(s.notWorking);</span>
<span class="nc" id="L966">			rCouldWork.addAll(s.couldWork);</span>
<span class="nc" id="L967">			improveLen = Math.max(improveLen, s.improve.size() + s.want.size());</span>
<span class="nc bnc" id="L968" title="All 2 branches missed.">			for (UnitType ut : s.improve.keySet()) {</span>
<span class="nc" id="L969">				accumulateToMap(rImprove, ut, 1, integerAccumulator);</span>
<span class="nc" id="L970">			}</span>
<span class="nc bnc" id="L971" title="All 2 branches missed.">			for (UnitType ut : s.want.keySet()) {</span>
<span class="nc" id="L972">				accumulateToMap(rImprove, ut, 1, integerAccumulator);</span>
<span class="nc" id="L973">			}</span>
<span class="nc bnc" id="L974" title="All 4 branches missed.">			if (s.needed != null &amp;&amp; s.needed.getType().isStorable()) {</span>
<span class="nc" id="L975">				accumulateToMap(rNeeded, s.needed.getType(), (double) s.needed.getAmount() / s.completeTurns,</span>
						doubleAccumulator);
			}
<span class="nc" id="L978">		}</span>
<span class="nc" id="L979">		rNewColonist = Math.round(rNewColonist / summaries.size());</span>

		// Field: A label for the most settled region in the list.
		// Colour: Plain
<span class="nc" id="L983">		t = mapEntriesByValue(rRegionMap, descendingIntegerComparator).get(0).getKey().getLabel();</span>
<span class="nc" id="L984">		reportPanel.add(newLabel(Messages.message(t), null, cPlain, stpld(&quot;report.colony.name.summary&quot;)), &quot;newline&quot;);</span>

		// Field: The total of the size change field.
		// Colour: cGood if efficient/cAlarm if inefficient.
<span class="nc bnc" id="L988" title="All 2 branches missed.">		reportPanel.add(newLabel(Integer.toString(rSizeChange), null, (rSizeChange &lt; 0) ? cAlarm : cGood,</span>
<span class="nc" id="L989">				stpld(&quot;report.colony.growing.summary&quot;)));</span>

		// Field: The number of potential colony tiles that need
		// exploring.
		// Colour: cAlarm
<span class="nc" id="L994">		List&lt;Tile&gt; tiles = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L995" title="All 2 branches missed.">		for (TileImprovementSuggestion tis : rTileSuggestions) {</span>
<span class="nc bnc" id="L996" title="All 4 branches missed.">			if (tis.isExploration() &amp;&amp; !tiles.contains(tis.tile)) {</span>
<span class="nc" id="L997">				tiles.add(tis.tile);</span>
			}
<span class="nc" id="L999">		}</span>
<span class="nc bnc" id="L1000" title="All 2 branches missed.">		reportPanel.add((tiles.isEmpty()) ? new JLabel()</span>
<span class="nc" id="L1001">				: newLabel(Integer.toString(tiles.size()), null, cAlarm, stpld(&quot;report.colony.exploring.summary&quot;)));</span>

		// Fields: The number of existing colony tiles that would
		// benefit from improvements.
		// Colour: cAlarm
<span class="nc bnc" id="L1006" title="All 2 branches missed.">		for (TileImprovementType ti : spec.getTileImprovementTypeList()) {</span>
<span class="nc bnc" id="L1007" title="All 2 branches missed.">			if (ti.isNatural())</span>
<span class="nc" id="L1008">				continue;</span>
<span class="nc" id="L1009">			tiles.clear();</span>
<span class="nc bnc" id="L1010" title="All 2 branches missed.">			for (TileImprovementSuggestion tis : rTileSuggestions) {</span>
<span class="nc bnc" id="L1011" title="All 4 branches missed.">				if (tis.tileImprovementType == ti &amp;&amp; !tiles.contains(tis.tile)) {</span>
<span class="nc" id="L1012">					tiles.add(tis.tile);</span>
				}
<span class="nc" id="L1014">			}</span>
<span class="nc bnc" id="L1015" title="All 2 branches missed.">			reportPanel.add((tiles.isEmpty()) ? new JLabel()</span>
<span class="nc" id="L1016">					: newLabel(Integer.toString(tiles.size()), null, cAlarm,</span>
<span class="nc" id="L1017">							stpld(&quot;report.colony.tile.&quot; + ti.getSuffix() + &quot;.summary&quot;)));</span>
<span class="nc" id="L1018">		}</span>

		// Fields: The net production of each storable+non-trade-goods
		// goods type.
		// Colour: cWarn if negative, empty if no production,
		// cPlain if production balanced at zero, otherwise cGood.
<span class="nc bnc" id="L1024" title="All 2 branches missed.">		for (GoodsType gt : this.goodsTypes) {</span>
<span class="nc" id="L1025">			final ColonySummary.GoodsProduction gp = rProduction.get(gt);</span>
<span class="nc bnc" id="L1026" title="All 5 branches missed.">			switch (gp.status) {</span>
			case BAD:
<span class="nc" id="L1028">				c = cWarn;</span>
<span class="nc" id="L1029">				break;</span>
			case NONE:
<span class="nc" id="L1031">				c = null;</span>
<span class="nc" id="L1032">				break;</span>
			case ZERO:
<span class="nc" id="L1034">				c = cPlain;</span>
<span class="nc" id="L1035">				break;</span>
			case GOOD:
<span class="nc" id="L1037">				c = cGood;</span>
<span class="nc" id="L1038">				break;</span>
			default:
<span class="nc" id="L1040">				throw new IllegalStateException(&quot;Bogus status: &quot; + gp.status);</span>
			}
<span class="nc bnc" id="L1042" title="All 2 branches missed.">			reportPanel.add((c == null) ? new JLabel()</span>
<span class="nc" id="L1043">					: newLabel(Integer.toString(gp.amount), null, c,</span>
<span class="nc" id="L1044">							stpld(&quot;report.colony.production.summary&quot;).addNamed(&quot;%goods%&quot;, gt)));</span>
<span class="nc" id="L1045">		}</span>

		// Field: New colonist arrival or famine warning.
		// Colour: cWarn if negative, else cGood
<span class="nc bnc" id="L1049" title="All 2 branches missed.">		reportPanel.add(newLabel(Integer.toString((int) rNewColonist), null, (rNewColonist &lt; 0) ? cWarn : cGood,</span>
<span class="nc" id="L1050">				stpld(&quot;report.colony.arriving.summary&quot;)));</span>

		// Field: The required goods rates.
		// Colour: cPlain
<span class="nc" id="L1054">		List&lt;JLabel&gt; labels = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L1055" title="All 2 branches missed.">		for (Entry&lt;GoodsType, Double&gt; e : mapEntriesByValue(rNeeded, descendingDoubleComparator)) {</span>
<span class="nc" id="L1056">			labels.add(newLabel(String.format(&quot;%4.1f %s&quot;, e.getValue(), Messages.getName(e.getKey())), null, cPlain,</span>
<span class="nc" id="L1057">					stpld(&quot;report.colony.making.summary&quot;).addNamed(&quot;%goods%&quot;, e.getKey())));</span>
<span class="nc" id="L1058">		}</span>

		// Field: What is being trained (attached to previous)
		// Colour: cPlain.
<span class="nc" id="L1062">		teacherLen = Math.max(3, teacherLen); // Always some room here</span>
<span class="nc" id="L1063">		labels.addAll(unitTypeLabels(rTeachers, teacherLen, stpld(&quot;report.colony.making.educating.summary&quot;)));</span>
<span class="nc" id="L1064">		addTogether(labels);</span>

		// Field: The units that could be upgraded, followed by the units
		// that could be added.
<span class="nc" id="L1068">		addTogether(unitTypeLabels(rImprove, improveLen, stpld(&quot;report.colony.improving.summary&quot;)));</span>
<span class="nc" id="L1069">	}</span>

	/**
	 * Unit type labels.
	 *
	 * @param unitTypeMap
	 *            the unit type map
	 * @param maxSize
	 *            the max size
	 * @param t
	 *            the t
	 * @return the list
	 */
	private List&lt;JLabel&gt; unitTypeLabels(Map&lt;UnitType, Integer&gt; unitTypeMap, int maxSize, StringTemplate t) {
<span class="nc" id="L1083">		List&lt;JLabel&gt; result = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L1084">		int n = 0;</span>
<span class="nc bnc" id="L1085" title="All 2 branches missed.">		for (Entry&lt;UnitType, Integer&gt; e : mapEntriesByValue(unitTypeMap, descendingIntegerComparator)) {</span>
<span class="nc" id="L1086">			ImageIcon icon = new ImageIcon(this.lib.getTinyUnitImage(e.getKey(), false));</span>
<span class="nc" id="L1087">			result.add(newLabel(Integer.toString(e.getValue()), icon, cPlain, t));</span>
<span class="nc bnc" id="L1088" title="All 2 branches missed.">			if (++n &gt;= maxSize)</span>
<span class="nc" id="L1089">				break;</span>
<span class="nc" id="L1090">		}</span>

<span class="nc" id="L1092">		return result;</span>
	}

	/**
	 * Display the header area for the concise panel.
	 *
	 * @param market
	 *            A &lt;code&gt;Market&lt;/code&gt; to check goods arrears status with.
	 */
	private void conciseHeaders(Market market) {
<span class="nc" id="L1102">		reportPanel.add(new JSeparator(JSeparator.HORIZONTAL), &quot;newline, span, growx&quot;);</span>

<span class="nc" id="L1104">		reportPanel.add(newLabel(&quot;report.colony.name.header&quot;, null, null, stpld(&quot;report.colony.name&quot;)), &quot;newline&quot;);</span>
<span class="nc" id="L1105">		reportPanel.add(newLabel(&quot;report.colony.grow.header&quot;, null, null, stpld(&quot;report.colony.grow&quot;)));</span>
<span class="nc" id="L1106">		reportPanel.add(newLabel(&quot;report.colony.explore.header&quot;, null, null, stpld(&quot;report.colony.explore&quot;)));</span>
<span class="nc bnc" id="L1107" title="All 2 branches missed.">		for (TileImprovementType ti : this.spec.getTileImprovementTypeList()) {</span>
<span class="nc bnc" id="L1108" title="All 2 branches missed.">			if (ti.isNatural())</span>
<span class="nc" id="L1109">				continue;</span>
<span class="nc" id="L1110">			String key = &quot;report.colony.tile.&quot; + ti.getSuffix() + &quot;.header&quot;;</span>
<span class="nc" id="L1111">			reportPanel.add(newLabel(key, null, null, stpld(key)));</span>
<span class="nc" id="L1112">		}</span>
<span class="nc bnc" id="L1113" title="All 2 branches missed.">		for (GoodsType gt : this.goodsTypes) {</span>
<span class="nc" id="L1114">			ImageIcon icon = new ImageIcon(this.lib.getSmallIconImage(gt));</span>
<span class="nc" id="L1115">			JLabel l = newLabel(null, icon, null, stpl(&quot;report.colony.production.header&quot;).addNamed(&quot;%goods%&quot;, gt));</span>
<span class="nc bnc" id="L1116" title="All 4 branches missed.">			l.setEnabled(market == null || market.getArrears(gt) &lt;= 0);</span>
<span class="nc" id="L1117">			reportPanel.add(l);</span>
<span class="nc" id="L1118">		}</span>

<span class="nc" id="L1120">		final UnitType type = spec.getDefaultUnitType(market.getOwner());</span>
<span class="nc" id="L1121">		ImageIcon colonistIcon = new ImageIcon(this.lib.getTinyUnitImage(type, false));</span>
<span class="nc" id="L1122">		reportPanel.add(newLabel(null, colonistIcon, null, stpld(&quot;report.colony.birth&quot;)));</span>
<span class="nc" id="L1123">		reportPanel.add(newLabel(&quot;report.colony.making.header&quot;, null, null, stpld(&quot;report.colony.making&quot;)));</span>
<span class="nc" id="L1124">		reportPanel.add(newLabel(&quot;report.colony.improve.header&quot;, null, null, stpld(&quot;report.colony.improve&quot;)));</span>

<span class="nc" id="L1126">		reportPanel.add(new JSeparator(JSeparator.HORIZONTAL), &quot;newline, span, growx&quot;);</span>
<span class="nc" id="L1127">	}</span>

	/**
	 * Update the panel.
	 */
	private void update() {
<span class="nc" id="L1133">		reportPanel.removeAll();</span>

		// Define the layout, with a column for each goods type.
<span class="nc" id="L1136">		String cols = &quot;[l][c][c][c]&quot;;</span>
<span class="nc bnc" id="L1137" title="All 2 branches missed.">		for (int i = 0; i &lt; this.goodsTypes.size(); i++)</span>
<span class="nc" id="L1138">			cols += &quot;[c]&quot;;</span>
<span class="nc" id="L1139">		cols += &quot;[c][c][l][l][l]&quot;;</span>
<span class="nc" id="L1140">		reportPanel.setLayout(new MigLayout(&quot;fillx, insets 0, gap 0 0&quot;, cols, &quot;&quot;));</span>

<span class="nc" id="L1142">		conciseHeaders(this.market);</span>
<span class="nc" id="L1143">		List&lt;ColonySummary&gt; summaries = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L1144" title="All 2 branches missed.">		for (List&lt;Colony&gt; cs : this.colonies) {</span>
<span class="nc" id="L1145">			summaries.clear();</span>
<span class="nc bnc" id="L1146" title="All 2 branches missed.">			for (Colony c : cs) {</span>
<span class="nc" id="L1147">				ColonySummary s = new ColonySummary(c, this.goodsTypes);</span>
<span class="nc" id="L1148">				summaries.add(s);</span>
<span class="nc" id="L1149">				updateColony(s);</span>
<span class="nc" id="L1150">			}</span>
<span class="nc bnc" id="L1151" title="All 2 branches missed.">			if (cs.size() &gt; 1) {</span>
<span class="nc" id="L1152">				updateCombinedColonies(summaries);</span>
			}
<span class="nc" id="L1154">			conciseHeaders(this.market);</span>
<span class="nc" id="L1155">		}</span>
<span class="nc" id="L1156">	}</span>

	// Interface ActionListener

	/**
	 * {@inheritDoc}
	 */
	@Override
	public void actionPerformed(ActionEvent ae) {
<span class="nc" id="L1165">		final Game game = getGame();</span>
<span class="nc" id="L1166">		String command = ae.getActionCommand();</span>
<span class="nc bnc" id="L1167" title="All 2 branches missed.">		if (command.startsWith(BUILDQUEUE)) {</span>
<span class="nc" id="L1168">			command = command.substring(BUILDQUEUE.length());</span>
<span class="nc" id="L1169">			Colony colony = game.getFreeColGameObject(command, Colony.class);</span>
<span class="nc bnc" id="L1170" title="All 2 branches missed.">			if (colony != null) {</span>
<span class="nc" id="L1171">				getGUI().showBuildQueuePanel(colony, () -&gt; {</span>
<span class="nc" id="L1172">					update();</span>
<span class="nc" id="L1173">				});</span>
<span class="nc" id="L1174">				return;</span>
			}
<span class="nc" id="L1176">		} else {</span>
<span class="nc" id="L1177">			Colony colony = game.getFreeColGameObject(command, Colony.class);</span>
<span class="nc bnc" id="L1178" title="All 2 branches missed.">			if (colony != null) {</span>
<span class="nc" id="L1179">				getGUI().showColonyPanel2(colony, null).addClosingCallback(() -&gt; {</span>
<span class="nc" id="L1180">					update();</span>
<span class="nc" id="L1181">				});</span>
<span class="nc" id="L1182">				return;</span>
			}
		}
<span class="nc" id="L1185">		super.actionPerformed(ae);</span>
<span class="nc" id="L1186">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span></div></body></html>