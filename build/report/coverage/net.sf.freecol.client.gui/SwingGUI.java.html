<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SwingGUI.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">jacocoReport</a> &gt; <a href="index.source.html" class="el_package">net.sf.freecol.client.gui</a> &gt; <span class="el_source">SwingGUI.java</span></div><h1>SwingGUI.java</h1><pre class="source lang-java linenums">/**
 *  Copyright (C) 2002-2015   The FreeCol Team
 *
 *  This file is part of FreeCol.
 *
 *  FreeCol is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation, either version 2 of the License, or
 *  (at your option) any later version.
 *
 *  FreeCol is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License
 *  along with FreeCol.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
 */

package net.sf.freecol.client.gui;

import java.awt.Component;
import java.awt.Dimension;
import java.awt.DisplayMode;
import java.awt.Font;
import java.awt.Graphics2D;
import java.awt.GraphicsDevice;
import java.awt.GraphicsEnvironment;
import java.awt.HeadlessException;
import java.awt.MouseInfo;
import java.awt.Point;
import java.awt.Rectangle;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.KeyEvent;
import java.awt.event.KeyListener;
import java.awt.event.MouseEvent;
import java.awt.event.MouseListener;
import java.awt.image.BufferedImage;
import java.beans.PropertyChangeEvent;
import java.io.File;
import java.io.InputStream;
import java.util.List;
import java.util.Locale;
import java.util.Map;
import java.util.logging.Level;

import javax.imageio.ImageIO;
import javax.swing.ImageIcon;
import javax.swing.JLabel;
import javax.swing.JWindow;
import javax.swing.Timer;
import javax.swing.filechooser.FileFilter;

import net.sf.freecol.client.ClientOptions;
import net.sf.freecol.client.FreeColClient;
import net.sf.freecol.client.gui.animation.Animations;
import net.sf.freecol.client.gui.panel.ColonyPanel;
import net.sf.freecol.client.gui.panel.ColorChooserPanel;
import net.sf.freecol.client.gui.panel.CornerMapControls;
import net.sf.freecol.client.gui.panel.FreeColDialog;
import net.sf.freecol.client.gui.panel.LabourData.UnitData;
import net.sf.freecol.client.gui.panel.MapControls;
import net.sf.freecol.client.gui.panel.Parameters;
import net.sf.freecol.client.gui.panel.TradeRoutePanel;
import net.sf.freecol.client.gui.panel.Utility;
import net.sf.freecol.client.gui.plaf.FreeColLookAndFeel;
import net.sf.freecol.client.gui.video.VideoComponent;
import net.sf.freecol.client.gui.video.VideoListener;
import net.sf.freecol.common.FreeColException;
import net.sf.freecol.common.ServerInfo;
import net.sf.freecol.common.i18n.Messages;
import net.sf.freecol.common.model.Colony;
import net.sf.freecol.common.model.DiplomaticTrade;
import net.sf.freecol.common.model.Europe;
import net.sf.freecol.common.model.FoundingFather;
import net.sf.freecol.common.model.FreeColGameObject;
import net.sf.freecol.common.model.FreeColObject;
import net.sf.freecol.common.model.Game;
import net.sf.freecol.common.model.Goods;
import net.sf.freecol.common.model.GoodsType;
import net.sf.freecol.common.model.HighScore;
import net.sf.freecol.common.model.IndianSettlement;
import net.sf.freecol.common.model.Location;
import net.sf.freecol.common.model.ModelMessage;
import net.sf.freecol.common.model.Monarch.MonarchAction;
import net.sf.freecol.common.model.Nation;
import net.sf.freecol.common.model.Player;
import net.sf.freecol.common.model.Settlement;
import net.sf.freecol.common.model.Specification;
import net.sf.freecol.common.model.StringTemplate;
import net.sf.freecol.common.model.Tile;
import net.sf.freecol.common.model.TileType;
import net.sf.freecol.common.model.TradeRoute;
import net.sf.freecol.common.model.TypeCountMap;
import net.sf.freecol.common.model.Unit;
import net.sf.freecol.common.model.UnitType;
import net.sf.freecol.common.model.WorkLocation;
import net.sf.freecol.common.option.BooleanOption;
import net.sf.freecol.common.option.LanguageOption;
import net.sf.freecol.common.option.LanguageOption.Language;
import net.sf.freecol.common.option.Option;
import net.sf.freecol.common.option.OptionGroup;
import net.sf.freecol.common.resources.ResourceManager;
import net.sf.freecol.common.resources.Video;

import static net.sf.freecol.common.util.StringUtils.lastPart;

/**
 * A wrapper providing functionality for the overall GUI using Java Swing.
 */
public class SwingGUI extends GUI {

	/** The graphics device. */
	private final GraphicsDevice graphicsDevice;

	/**
	 * This is the TileViewer instance used to paint the map tiles in the
	 * ColonyPanel and other panels. It should not be scaled along with the
	 * default MapViewer.
	 */
	private TileViewer tileViewer;

	/**
	 * The MapViewer instance used by canvas to paint the main map. This does
	 * need to be scaled.
	 */
	private MapViewer mapViewer;

	/** The canvas that implements much of the functionality. */
	private Canvas canvas;

	/** The map controls. */
	private MapControls mapControls;

	/** The splash. */
	private JWindow splash;

	/**
	 * Create the GUI.
	 *
	 * @param freeColClient
	 *            The &lt;code&gt;FreeColClient&lt;/code&gt; for the game.
	 * @param scaleFactor
	 *            The scale factor for the GUI.
	 */
	public SwingGUI(FreeColClient freeColClient, float scaleFactor) {
<span class="nc" id="L148">		super(freeColClient, scaleFactor);</span>
<span class="nc" id="L149">		graphicsDevice = getGoodGraphicsDevice();</span>
<span class="nc" id="L150">		logger.info(&quot;GUI constructed using scale factor &quot; + scaleFactor);</span>
<span class="nc" id="L151">	}</span>

	// Simple accessors

	/**
	 * Gets the canvas.
	 *
	 * @return the canvas
	 */
	public Canvas getCanvas() {
<span class="nc" id="L161">		return canvas;</span>
	}

	/**
	 * Gets the tile image library.
	 *
	 * @return the tile image library
	 */
	public ImageLibrary getTileImageLibrary() {
<span class="nc" id="L170">		return tileViewer.getImageLibrary();</span>
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#isWindowed()
	 */
	@Override
	public boolean isWindowed() {
<span class="nc" id="L180">		return canvas.isWindowed();</span>
	}

	// Initialization related methods

	/**
	 * 
	 * Swing system and look-and-feel initialization.
	 *
	 * @param fontName
	 *            An optional font name to be used.
	 * @throws FreeColException
	 *             the free col exception
	 */
	@Override
	public void installLookAndFeel(String fontName) throws FreeColException {
<span class="nc" id="L196">		FreeColLookAndFeel fclaf = new FreeColLookAndFeel();</span>
<span class="nc" id="L197">		FreeColLookAndFeel.install(fclaf);</span>
<span class="nc" id="L198">		Font font = FontLibrary.createMainFont(fontName, imageLibrary.getScaleFactor());</span>
<span class="nc" id="L199">		FreeColLookAndFeel.installFont(font);</span>
<span class="nc" id="L200">		Utility.initStyleContext(font);</span>
<span class="nc" id="L201">	}</span>

	/**
	 * Quit the GUI. All that is required is to exit the full screen.
	 *
	 * @throws Exception
	 *             the exception
	 */
	@Override
	public void quit() throws Exception {
<span class="nc bnc" id="L211" title="All 2 branches missed.">		if (canvas != null) {</span>
<span class="nc" id="L212">			canvas.quit();</span>
		}
<span class="nc" id="L214">	}</span>

	/**
	 * In game initializations. Called from PreGameController.startGame().
	 *
	 * @param tile
	 *            An initial &lt;code&gt;Tile&lt;/code&gt; to select.
	 */
	@Override
	public void initializeInGame(Tile tile) {
<span class="nc" id="L224">		canvas.initializeInGame();</span>
<span class="nc" id="L225">		enableMapControls(freeColClient.getClientOptions().getBoolean(ClientOptions.DISPLAY_MAP_CONTROLS));</span>
<span class="nc" id="L226">		setSelectedTile(tile);</span>
<span class="nc" id="L227">	}</span>

	/**
	 * Set up the mouse listeners for the canvas and map viewer.
	 */
	@Override
	public void setupMouseListeners() {
<span class="nc" id="L234">		canvas.setupMouseListeners();</span>
<span class="nc" id="L235">	}</span>

	/**
	 * Display the splash screen.
	 *
	 * @param splashStream
	 *            A stream to read the splash image from.
	 */
	@Override
	public void displaySplashScreen(final InputStream splashStream) {
<span class="nc" id="L245">		splash = null;</span>
<span class="nc bnc" id="L246" title="All 2 branches missed.">		if (splashStream == null)</span>
<span class="nc" id="L247">			return;</span>
		try {
<span class="nc" id="L249">			BufferedImage im = ImageIO.read(splashStream);</span>
<span class="nc" id="L250">			splash = new JWindow(graphicsDevice.getDefaultConfiguration());</span>
<span class="nc" id="L251">			splash.getContentPane().add(new JLabel(new ImageIcon(im)));</span>
<span class="nc" id="L252">			splash.pack();</span>
<span class="nc" id="L253">			Point start = splash.getLocation();</span>
<span class="nc" id="L254">			DisplayMode dm = graphicsDevice.getDisplayMode();</span>
<span class="nc" id="L255">			splash.setLocation(start.x + dm.getWidth() / 2 - splash.getWidth() / 2,</span>
<span class="nc" id="L256">					start.y + dm.getHeight() / 2 - splash.getHeight() / 2);</span>
<span class="nc" id="L257">			splash.setVisible(true);</span>
<span class="nc" id="L258">		} catch (Exception e) {</span>
<span class="nc" id="L259">			logger.log(Level.WARNING, &quot;Splash fail&quot;, e);</span>
<span class="nc" id="L260">			splash = null;</span>
<span class="nc" id="L261">		}</span>
<span class="nc" id="L262">	}</span>

	/**
	 * Hide the splash screen.
	 */
	@Override
	public void hideSplashScreen() {
<span class="nc bnc" id="L269" title="All 2 branches missed.">		if (splash != null) {</span>
<span class="nc" id="L270">			splash.setVisible(false);</span>
<span class="nc" id="L271">			splash.dispose();</span>
<span class="nc" id="L272">			splash = null;</span>
		}
<span class="nc" id="L274">	}</span>

	/**
	 * Shows the &lt;code&gt;VideoPanel&lt;/code&gt;.
	 *
	 * @param userMsg
	 *            An optional user message.
	 */
	@Override
	public void showOpeningVideo(final String userMsg) {
<span class="nc" id="L284">		canvas.closeMenus();</span>
<span class="nc" id="L285">		final Video video = ResourceManager.getVideo(&quot;video.opening&quot;);</span>
<span class="nc bnc" id="L286" title="All 2 branches missed.">		boolean muteAudio = !freeColClient.getSoundController().canPlaySound();</span>
<span class="nc" id="L287">		final VideoComponent vp = new VideoComponent(video, muteAudio);</span>

<span class="nc" id="L289">		final class AbortListener implements ActionListener, KeyListener, MouseListener, VideoListener {</span>

<span class="nc" id="L291">			private Timer t = null;</span>

			@Override
			public void keyPressed(KeyEvent e) {
<span class="nc" id="L295">			}</span>

			@Override
			public void keyReleased(KeyEvent e1) {
<span class="nc" id="L299">				execute();</span>
<span class="nc" id="L300">			}</span>

			@Override
			public void keyTyped(KeyEvent e2) {
<span class="nc" id="L304">			}</span>

			@Override
			public void mouseClicked(MouseEvent e3) {
<span class="nc" id="L308">				execute();</span>
<span class="nc" id="L309">			}</span>

			@Override
			public void mouseEntered(MouseEvent e4) {
<span class="nc" id="L313">			}</span>

			@Override
			public void mouseExited(MouseEvent e5) {
<span class="nc" id="L317">			}</span>

			@Override
			public void mousePressed(MouseEvent e6) {
<span class="nc" id="L321">			}</span>

			@Override
			public void mouseReleased(MouseEvent e7) {
<span class="nc" id="L325">			}</span>

			@Override
			public void stopped() {
<span class="nc" id="L329">				execute();</span>
<span class="nc" id="L330">			}</span>

			@Override
			public void actionPerformed(ActionEvent ae8) {
<span class="nc" id="L334">				execute();</span>
<span class="nc" id="L335">			}</span>

			private void setTimer(Timer t1) {
<span class="nc" id="L338">				this.t = t1;</span>
<span class="nc" id="L339">			}</span>

			private void execute() {
<span class="nc" id="L342">				canvas.removeKeyListener(this);</span>
<span class="nc" id="L343">				canvas.removeMouseListener(this);</span>
<span class="nc" id="L344">				vp.removeMouseListener(this);</span>
				// vp.removeVideoListener(this);
<span class="nc" id="L346">				vp.stop();</span>
<span class="nc" id="L347">				canvas.remove(vp);</span>
<span class="nc bnc" id="L348" title="All 2 branches missed.">				if (t != null) {</span>
<span class="nc" id="L349">					t.stop();</span>
				}
<span class="nc" id="L351">				playSound(&quot;sound.intro.general&quot;);</span>
<span class="nc" id="L352">				showMainPanel(userMsg);</span>
<span class="nc" id="L353">			}</span>
		}
<span class="nc" id="L355">		AbortListener l = new AbortListener();</span>
<span class="nc" id="L356">		vp.addMouseListener(l);</span>
		// vp.addVideoListener(l);
<span class="nc" id="L358">		canvas.showVideoComponent(vp, l, l);</span>
<span class="nc" id="L359">		vp.play();</span>
		// Cortado applet is failing to quit when finished, make sure it
		// eventually gets kicked. Change the magic number if we
		// change the opening video length.
<span class="nc" id="L363">		Timer t2 = new Timer(80000, l);</span>
<span class="nc" id="L364">		l.setTimer(t2);</span>
<span class="nc" id="L365">		t2.setRepeats(false);</span>
<span class="nc" id="L366">		t2.start();</span>
<span class="nc" id="L367">	}</span>

	/**
	 * Get a good screen device for starting FreeCol.
	 *
	 * @return A screen device, or null if none available (as in headless mode).
	 */
	private static GraphicsDevice getGoodGraphicsDevice() {
		try {
<span class="nc" id="L376">			return MouseInfo.getPointerInfo().getDevice();</span>
<span class="nc" id="L377">		} catch (HeadlessException he) {</span>
		}

		try {
<span class="nc" id="L381">			final GraphicsEnvironment lge = GraphicsEnvironment.getLocalGraphicsEnvironment();</span>
<span class="nc" id="L382">			return lge.getDefaultScreenDevice();</span>
<span class="nc" id="L383">		} catch (HeadlessException he) {</span>
		}

<span class="nc" id="L386">		FreeColClient.fatal(&quot;Could not find a GraphicsDevice!&quot;);</span>
<span class="nc" id="L387">		return null;</span>
	}

	/**
	 * Starts the GUI by creating and displaying the GUI-objects.
	 *
	 * @param desiredWindowSize
	 *            The desired size of the GUI window.
	 */
	@Override
	public void startGUI(final Dimension desiredWindowSize) {
<span class="nc" id="L398">		final ClientOptions opts = freeColClient.getClientOptions();</span>

		// Work around a Java 2D bug that seems to be X11 specific.
		// According to:
		// http://www.oracle.com/technetwork/java/javase/index-142560.html
		//
		// ``The use of pixmaps typically results in better
		// performance. However, in certain cases, the opposite is true.''
		//
		// The standard workaround is to use -Dsun.java2d.pmoffscreen=false,
		// but this is too hard for some users, so provide an option to
		// do it easily. However respect the initial value if present.
		//
		// Remove this if Java 2D is ever fixed. DHYB.
		//
<span class="nc" id="L413">		final String pmoffscreen = &quot;sun.java2d.pmoffscreen&quot;;</span>
<span class="nc" id="L414">		BooleanOption usePixmaps = (BooleanOption) opts.getOption(ClientOptions.USE_PIXMAPS);</span>
<span class="nc" id="L415">		String pmoffscreenValue = System.getProperty(pmoffscreen);</span>
<span class="nc bnc" id="L416" title="All 2 branches missed.">		if (pmoffscreenValue == null) {</span>
<span class="nc" id="L417">			System.setProperty(pmoffscreen, usePixmaps.getValue().toString());</span>
<span class="nc" id="L418">			logger.info(pmoffscreen + &quot; using client option: &quot; + usePixmaps.getValue());</span>
		} else {
<span class="nc" id="L420">			usePixmaps.setValue(Boolean.valueOf(pmoffscreenValue));</span>
<span class="nc" id="L421">			logger.info(pmoffscreen + &quot; overrides client option: &quot; + pmoffscreenValue);</span>
		}
<span class="nc" id="L423">		usePixmaps.addPropertyChangeListener((PropertyChangeEvent e) -&gt; {</span>
<span class="nc" id="L424">			String newValue = e.getNewValue().toString();</span>
<span class="nc" id="L425">			System.setProperty(pmoffscreen, newValue);</span>
<span class="nc" id="L426">			logger.info(&quot;Set &quot; + pmoffscreen + &quot; to: &quot; + newValue);</span>
<span class="nc" id="L427">		});</span>

<span class="nc" id="L429">		this.mapViewer = new MapViewer(freeColClient);</span>
<span class="nc" id="L430">		this.canvas = new Canvas(freeColClient, graphicsDevice, this, desiredWindowSize, mapViewer);</span>
<span class="nc" id="L431">		this.tileViewer = new TileViewer(freeColClient);</span>

		// Now that there is a canvas, prepare for language changes.
<span class="nc" id="L434">		LanguageOption o = (LanguageOption) freeColClient.getClientOptions().getOption(ClientOptions.LANGUAGE);</span>
<span class="nc" id="L435">		o.addPropertyChangeListener((PropertyChangeEvent e) -&gt; {</span>
<span class="nc" id="L436">			Language language = (Language) e.getNewValue();</span>
<span class="nc" id="L437">			logger.info(&quot;Set language to: &quot; + language);</span>
<span class="nc bnc" id="L438" title="All 2 branches missed.">			if (Messages.AUTOMATIC.equalsIgnoreCase(language.getKey())) {</span>
<span class="nc" id="L439">				showInformationMessage(&quot;info.autodetectLanguageSelected&quot;);</span>
			} else {
<span class="nc" id="L441">				Locale l = language.getLocale();</span>
<span class="nc" id="L442">				Messages.loadMessageBundle(l);</span>
<span class="nc" id="L443">				Messages.loadModMessageBundle(l);</span>
<span class="nc" id="L444">				showInformationMessage(</span>
<span class="nc" id="L445">						StringTemplate.template(&quot;info.newLanguageSelected&quot;).addName(&quot;%language%&quot;, l.getDisplayName()));</span>
			}
<span class="nc" id="L447">		});</span>

<span class="nc" id="L449">		logger.info(&quot;GUI created.&quot;);</span>
<span class="nc" id="L450">		logger.info(&quot;Starting in Move Units View Mode&quot;);</span>
<span class="nc" id="L451">	}</span>

	/**
	 * Change the windowed mode.
	 */
	@Override
	public void changeWindowedMode() {
<span class="nc" id="L458">		canvas.changeWindowedMode();</span>
<span class="nc" id="L459">	}</span>

	/**
	 * Start the GUI for the map editor.
	 */
	@Override
	public void startMapEditorGUI() {
<span class="nc" id="L466">		canvas.startMapEditorGUI();</span>
<span class="nc" id="L467">	}</span>

	// Non-trivial public routines.

	/**
	 * Start/stop the goto path display.
	 */
	@Override
	public void activateGotoPath() {
<span class="nc" id="L476">		Unit unit = getActiveUnit();</span>

		// Action should be disabled if there is no active unit, but make sure
<span class="nc bnc" id="L479" title="All 2 branches missed.">		if (unit == null)</span>
<span class="nc" id="L480">			return;</span>

		// Enter &quot;goto mode&quot; if not already activated; otherwise cancel it
<span class="nc bnc" id="L483" title="All 2 branches missed.">		if (canvas.isGotoStarted()) {</span>
<span class="nc" id="L484">			canvas.stopGoto();</span>
		} else {
<span class="nc" id="L486">			canvas.startGoto();</span>

			// Draw the path to the current mouse position, if the
			// mouse is over the screen; see also
			// CanvasMouseMotionListener.
<span class="nc" id="L491">			Point pt = canvas.getMousePosition();</span>
<span class="nc bnc" id="L492" title="All 2 branches missed.">			if (pt != null) {</span>
<span class="nc" id="L493">				Tile tile = canvas.convertToMapTile(pt.x, pt.y);</span>
<span class="nc bnc" id="L494" title="All 4 branches missed.">				if (tile != null &amp;&amp; unit.getTile() != tile) {</span>
<span class="nc" id="L495">					canvas.setGotoPath(unit.findPath(tile));</span>
				}
			}
		}
<span class="nc" id="L499">	}</span>

	/**
	 * Stop the goto path display.
	 */
	@Override
	public void clearGotoPath() {
<span class="nc" id="L506">		Unit unit = getActiveUnit();</span>

		// Action should be disabled if there is no active unit, but make sure
<span class="nc bnc" id="L509" title="All 2 branches missed.">		if (unit == null)</span>
<span class="nc" id="L510">			return;</span>
<span class="nc" id="L511">		canvas.stopGoto();</span>
<span class="nc" id="L512">	}</span>

	/**
	 * Tells the map controls that a chat message was received.
	 *
	 * @param player
	 *            The player who sent the chat message.
	 * @param message
	 *            The chat message.
	 * @param privateChat
	 *            'true' if the message is a private one, 'false' otherwise.
	 * @see GUIMessage
	 */
	@Override
	public void displayChatMessage(Player player, String message, boolean privateChat) {
<span class="nc" id="L527">		canvas.displayChatMessage(new GUIMessage(player.getName() + &quot;: &quot; + message, player.getNationColor()));</span>
<span class="nc" id="L528">	}</span>

	/**
	 * Refresh the GUI.
	 */
	@Override
	public void refresh() {
<span class="nc" id="L535">		mapViewer.forceReposition();</span>
<span class="nc" id="L536">		canvas.refresh();</span>
<span class="nc" id="L537">	}</span>

	/**
	 * Refreshes the screen at the specified Tile.
	 *
	 * @param tile
	 *            The &lt;code&gt;Tile&lt;/code&gt; to refresh.
	 */
	public void refreshTile(Tile tile) {
<span class="nc bnc" id="L546" title="All 4 branches missed.">		if (tile.getX() &gt;= 0 &amp;&amp; tile.getY() &gt;= 0) {</span>
<span class="nc" id="L547">			canvas.repaint(mapViewer.calculateTileBounds(tile));</span>
		}
<span class="nc" id="L549">	}</span>

	/**
	 * Reset the menu bar.
	 */
	@Override
	public void resetMenuBar() {
<span class="nc" id="L556">		freeColClient.updateActions();</span>
<span class="nc" id="L557">		canvas.resetMenuBar();</span>
<span class="nc" id="L558">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#resetMapZoom()
	 */
	@Override
	protected void resetMapZoom() {
<span class="nc" id="L567">		super.resetMapZoom();</span>
<span class="nc" id="L568">		mapViewer.resetMapScale();</span>
<span class="nc" id="L569">		refresh();</span>
<span class="nc" id="L570">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#canZoomInMap()
	 */
	@Override
	public boolean canZoomInMap() {
<span class="nc bnc" id="L579" title="All 2 branches missed.">		return !mapViewer.isAtMaxMapScale();</span>
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#canZoomOutMap()
	 */
	@Override
	public boolean canZoomOutMap() {
<span class="nc bnc" id="L589" title="All 2 branches missed.">		return !mapViewer.isAtMinMapScale();</span>
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#zoomInMap()
	 */
	@Override
	public void zoomInMap() {
<span class="nc" id="L599">		super.zoomInMap();</span>
<span class="nc" id="L600">		mapViewer.increaseMapScale();</span>
<span class="nc" id="L601">		refresh();</span>
<span class="nc" id="L602">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#zoomOutMap()
	 */
	@Override
	public void zoomOutMap() {
<span class="nc" id="L611">		super.zoomOutMap();</span>
<span class="nc" id="L612">		mapViewer.decreaseMapScale();</span>
<span class="nc" id="L613">		refresh();</span>
<span class="nc" id="L614">	}</span>

	/**
	 * Set the active unit.
	 *
	 * @param unit
	 *            The &lt;code&gt;Unit&lt;/code&gt; to activate.
	 * @return True if the focus was set.
	 */
	@Override
	public boolean setActiveUnit(Unit unit) {
<span class="nc" id="L625">		boolean result = mapViewer.setActiveUnit(unit);</span>
<span class="nc" id="L626">		updateMapControls();</span>
<span class="nc" id="L627">		updateMenuBar();</span>
<span class="nc bnc" id="L628" title="All 4 branches missed.">		if (unit != null &amp;&amp; !freeColClient.getMyPlayer().owns(unit)) {</span>
<span class="nc" id="L629">			canvas.refresh();</span>
		}
<span class="nc" id="L631">		return result;</span>
	}

	/**
	 * Update the menu bar.
	 *
	 * Always update the actions first so that the enabled/disabled state is
	 * correct.
	 */
	@Override
	public void updateMenuBar() {
<span class="nc" id="L642">		freeColClient.updateActions();</span>
<span class="nc" id="L643">		canvas.updateMenuBar();</span>
<span class="nc" id="L644">	}</span>

	// Animation handling

	/**
	 * Require the given tile to be in the onScreen()-area.
	 *
	 * @param tile
	 *            The &lt;code&gt;Tile&lt;/code&gt; to check.
	 * @return True if the focus was set.
	 */
	public boolean requireFocus(Tile tile) {
		// Account for the ALWAYS_CENTER client option.
<span class="nc" id="L657">		boolean required = freeColClient.getClientOptions().getBoolean(ClientOptions.ALWAYS_CENTER);</span>
<span class="nc bnc" id="L658" title="All 6 branches missed.">		if ((required &amp;&amp; tile != getFocus()) || !mapViewer.onScreen(tile)) {</span>
<span class="nc" id="L659">			setFocusImmediately(tile);</span>
<span class="nc" id="L660">			return true;</span>
		}
<span class="nc" id="L662">		return false;</span>
	}

	/**
	 * Animate a unit attack.
	 *
	 * @param attacker
	 *            The attacking &lt;code&gt;Unit&lt;/code&gt;.
	 * @param defender
	 *            The defending &lt;code&gt;Unit&lt;/code&gt;.
	 * @param attackerTile
	 *            The &lt;code&gt;Tile&lt;/code&gt; to show the attacker on.
	 * @param defenderTile
	 *            The &lt;code&gt;Tile&lt;/code&gt; to show the defender on.
	 * @param success
	 *            Did the attack succeed?
	 */
	@Override
	public void animateUnitAttack(Unit attacker, Unit defender, Tile attackerTile, Tile defenderTile, boolean success) {
<span class="nc" id="L681">		requireFocus(attackerTile);</span>
<span class="nc" id="L682">		Animations.unitAttack(freeColClient, attacker, defender, attackerTile, defenderTile, success);</span>
<span class="nc" id="L683">	}</span>

	/**
	 * Animate a unit move.
	 *
	 * @param unit
	 *            The &lt;code&gt;Unit&lt;/code&gt; that is moving.
	 * @param srcTile
	 *            The &lt;code&gt;Tile&lt;/code&gt; the unit starts at.
	 * @param dstTile
	 *            The &lt;code&gt;Tile&lt;/code&gt; the unit moves to.
	 */
	@Override
	public void animateUnitMove(Unit unit, Tile srcTile, Tile dstTile) {
<span class="nc" id="L697">		requireFocus(srcTile);</span>
<span class="nc" id="L698">		Animations.unitMove(freeColClient, unit, srcTile, dstTile);</span>
<span class="nc" id="L699">	}</span>

	// MapControls handling

	/**
	 * Enable the map controls.
	 *
	 * Called from the MapControlsAction.
	 *
	 * @param enable
	 *            If true then enable.
	 */
	@Override
	public void enableMapControls(boolean enable) {
		// Always instantiate in game.
<span class="nc bnc" id="L714" title="All 4 branches missed.">		if (enable &amp;&amp; mapControls == null) {</span>
<span class="nc" id="L715">			String className = freeColClient.getClientOptions().getString(ClientOptions.MAP_CONTROLS);</span>
			try {
<span class="nc" id="L717">				final String panelName = &quot;net.sf.freecol.client.gui.panel.&quot; + lastPart(className, &quot;.&quot;);</span>
<span class="nc" id="L718">				Class&lt;?&gt; controls = Class.forName(panelName);</span>
<span class="nc" id="L719">				mapControls = (MapControls) controls.getConstructor(FreeColClient.class).newInstance(freeColClient);</span>
<span class="nc" id="L720">				logger.info(&quot;Instantiated &quot; + panelName);</span>
<span class="nc" id="L721">			} catch (Exception e) {</span>
<span class="nc" id="L722">				logger.log(Level.INFO, &quot;Fallback to CornerMapControls from &quot; + className, e);</span>
<span class="nc" id="L723">				mapControls = new CornerMapControls(freeColClient);</span>
<span class="nc" id="L724">			}</span>
<span class="nc bnc" id="L725" title="All 2 branches missed.">			if (mapControls != null) {</span>
<span class="nc" id="L726">				mapControls.addToComponent(canvas);</span>
<span class="nc" id="L727">				mapControls.update();</span>
			}
<span class="nc bnc" id="L729" title="All 4 branches missed.">		} else if (!enable &amp;&amp; mapControls != null) {</span>
<span class="nc" id="L730">			mapControls.removeFromComponent(canvas);</span>
<span class="nc" id="L731">			mapControls = null;</span>
		}
<span class="nc" id="L733">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#updateMapControls()
	 */
	@Override
	public void updateMapControls() {
<span class="nc bnc" id="L742" title="All 2 branches missed.">		if (mapControls != null)</span>
<span class="nc" id="L743">			mapControls.update();</span>
<span class="nc" id="L744">	}</span>

	/**
	 * Update map controls in canvas.
	 */
	public void updateMapControlsInCanvas() {
<span class="nc bnc" id="L750" title="All 2 branches missed.">		if (mapControls == null)</span>
<span class="nc" id="L751">			return;</span>
<span class="nc" id="L752">		mapControls.removeFromComponent(canvas);</span>
<span class="nc" id="L753">		mapControls.addToComponent(canvas);</span>
<span class="nc" id="L754">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#zoomInMapControls()
	 */
	@Override
	public void zoomInMapControls() {
<span class="nc bnc" id="L763" title="All 2 branches missed.">		if (mapControls == null)</span>
<span class="nc" id="L764">			return;</span>
<span class="nc" id="L765">		mapControls.zoomIn();</span>
<span class="nc" id="L766">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#zoomOutMapControls()
	 */
	@Override
	public void zoomOutMapControls() {
<span class="nc bnc" id="L775" title="All 2 branches missed.">		if (mapControls == null)</span>
<span class="nc" id="L776">			return;</span>
<span class="nc" id="L777">		mapControls.zoomOut();</span>
<span class="nc" id="L778">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#canZoomInMapControls()
	 */
	@Override
	public boolean canZoomInMapControls() {
<span class="nc bnc" id="L787" title="All 4 branches missed.">		return mapControls != null &amp;&amp; mapControls.canZoomInMapControls();</span>
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#canZoomOutMapControls()
	 */
	@Override
	public boolean canZoomOutMapControls() {
<span class="nc bnc" id="L797" title="All 4 branches missed.">		return mapControls != null &amp;&amp; mapControls.canZoomOutMapControls();</span>
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#miniMapToggleViewControls()
	 */
	@Override
	public void miniMapToggleViewControls() {
<span class="nc bnc" id="L807" title="All 2 branches missed.">		if (mapControls == null)</span>
<span class="nc" id="L808">			return;</span>
<span class="nc" id="L809">		mapControls.toggleView();</span>
<span class="nc" id="L810">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#miniMapToggleFogOfWarControls()
	 */
	@Override
	public void miniMapToggleFogOfWarControls() {
<span class="nc bnc" id="L819" title="All 2 branches missed.">		if (mapControls == null)</span>
<span class="nc" id="L820">			return;</span>
<span class="nc" id="L821">		mapControls.toggleFogOfWar();</span>
<span class="nc" id="L822">	}</span>

	// Dialogs that return values

	/**
	 * Simple modal confirmation dialog.
	 *
	 * @param textKey
	 *            A string to use as the message key.
	 * @param okKey
	 *            A key for the &quot;ok&quot; button.
	 * @param cancelKey
	 *            A key for the &quot;cancel&quot; button.
	 * @return True if the &quot;ok&quot; button was selected.
	 */
	@Override
	public boolean confirm(String textKey, String okKey, String cancelKey) {
<span class="nc" id="L839">		return canvas.showConfirmDialog(null, Messages.message(textKey), null, okKey, cancelKey);</span>
	}

	/**
	 * General modal confirmation dialog.
	 *
	 * @param tile
	 *            An optional &lt;code&gt;Tile&lt;/code&gt; to expose.
	 * @param template
	 *            The &lt;code&gt;StringTemplate&lt;/code&gt; explaining the choice.
	 * @param okKey
	 *            A key for the &quot;ok&quot; button.
	 * @param cancelKey
	 *            A key for the &quot;cancel&quot; button.
	 * @return True if the &quot;ok&quot; button was selected.
	 */
	@Override
	public boolean confirm(Tile tile, StringTemplate template, String okKey, String cancelKey) {
<span class="nc" id="L857">		return canvas.showConfirmDialog(tile, Utility.localizedTextArea(template), null, okKey, cancelKey);</span>
	}

	/**
	 * General modal confirmation dialog.
	 *
	 * @param tile
	 *            An optional &lt;code&gt;Tile&lt;/code&gt; to expose.
	 * @param template
	 *            The &lt;code&gt;StringTemplate&lt;/code&gt; explaining the choice.
	 * @param unit
	 *            An optional unit to make an icon for the dialog from.
	 * @param okKey
	 *            A key for the &quot;ok&quot; button.
	 * @param cancelKey
	 *            A key for the &quot;cancel&quot; button.
	 * @return True if the &quot;ok&quot; button was selected.
	 */
	@Override
	public boolean confirm(Tile tile, StringTemplate template, Unit unit, String okKey, String cancelKey) {
<span class="nc" id="L877">		return canvas.showConfirmDialog(tile, Utility.localizedTextArea(template),</span>
<span class="nc" id="L878">				new ImageIcon(imageLibrary.getUnitImage(unit)), okKey, cancelKey);</span>
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @see
	 * net.sf.freecol.client.gui.GUI#confirm(net.sf.freecol.common.model.Tile,
	 * net.sf.freecol.common.model.StringTemplate,
	 * net.sf.freecol.common.model.Settlement, java.lang.String,
	 * java.lang.String)
	 */
	@Override
	public boolean confirm(Tile tile, StringTemplate template, Settlement settlement, String okKey, String cancelKey) {
<span class="nc" id="L892">		return canvas.showConfirmDialog(tile, Utility.localizedTextArea(template),</span>
<span class="nc" id="L893">				new ImageIcon(imageLibrary.getSettlementImage(settlement)), okKey, cancelKey);</span>
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @see
	 * net.sf.freecol.client.gui.GUI#confirm(net.sf.freecol.common.model.Tile,
	 * net.sf.freecol.common.model.StringTemplate,
	 * net.sf.freecol.common.model.GoodsType, java.lang.String,
	 * java.lang.String)
	 */
	@Override
	public boolean confirm(Tile tile, StringTemplate template, GoodsType goodsType, String okKey, String cancelKey) {
<span class="nc" id="L907">		return canvas.showConfirmDialog(tile, Utility.localizedTextArea(template),</span>
<span class="nc" id="L908">				new ImageIcon(imageLibrary.getIconImage(goodsType)), okKey, cancelKey);</span>
	}

	/**
	 * Confirm declaration of independence.
	 *
	 * @return A list of new nation and country names.
	 */
	@Override
	public List&lt;String&gt; confirmDeclaration() {
<span class="nc" id="L918">		return canvas.showConfirmDeclarationDialog();</span>
	}

	/**
	 * General modal choice dialog.
	 *
	 * @param &lt;T&gt;
	 *            the generic type
	 * @param tile
	 *            An optional &lt;code&gt;Tile&lt;/code&gt; to expose.
	 * @param explain
	 *            An object explaining the choice.
	 * @param cancelKey
	 *            A key for the &quot;cancel&quot; button.
	 * @param choices
	 *            A list a &lt;code&gt;ChoiceItem&lt;/code&gt;s to choose from.
	 * @return The selected value of the selected &lt;code&gt;ChoiceItem&lt;/code&gt;, or
	 *         null if cancelled.
	 */
	@Override
	public &lt;T&gt; T getChoice(Tile tile, Object explain, String cancelKey, List&lt;ChoiceItem&lt;T&gt;&gt; choices) {
<span class="nc" id="L939">		return canvas.showChoiceDialog(tile, explain, null, cancelKey, choices);</span>
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @see
	 * net.sf.freecol.client.gui.GUI#getChoice(net.sf.freecol.common.model.Tile,
	 * java.lang.Object, net.sf.freecol.common.model.Unit, java.lang.String,
	 * java.util.List)
	 */
	@Override
	public &lt;T&gt; T getChoice(Tile tile, Object explain, Unit unit, String cancelKey, List&lt;ChoiceItem&lt;T&gt;&gt; choices) {
<span class="nc" id="L952">		return canvas.showChoiceDialog(tile, explain, new ImageIcon(imageLibrary.getUnitImage(unit)), cancelKey,</span>
				choices);
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @see
	 * net.sf.freecol.client.gui.GUI#getChoice(net.sf.freecol.common.model.Tile,
	 * java.lang.Object, net.sf.freecol.common.model.Settlement,
	 * java.lang.String, java.util.List)
	 */
	@Override
	public &lt;T&gt; T getChoice(Tile tile, Object explain, Settlement settlement, String cancelKey,
			List&lt;ChoiceItem&lt;T&gt;&gt; choices) {
<span class="nc" id="L967">		return canvas.showChoiceDialog(tile, explain, new ImageIcon(imageLibrary.getSettlementImage(settlement)),</span>
				cancelKey, choices);
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @see
	 * net.sf.freecol.client.gui.GUI#getChoice(net.sf.freecol.common.model.Tile,
	 * java.lang.Object, net.sf.freecol.common.model.GoodsType,
	 * java.lang.String, java.util.List)
	 */
	@Override
	public &lt;T&gt; T getChoice(Tile tile, Object explain, GoodsType goodsType, String cancelKey,
			List&lt;ChoiceItem&lt;T&gt;&gt; choices) {
<span class="nc" id="L982">		return canvas.showChoiceDialog(tile, explain, new ImageIcon(imageLibrary.getIconImage(goodsType)), cancelKey,</span>
				choices);
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @see
	 * net.sf.freecol.client.gui.GUI#getChoice(net.sf.freecol.common.model.Tile,
	 * java.lang.Object, net.sf.freecol.common.model.Nation, java.lang.String,
	 * java.util.List)
	 */
	@Override
	public &lt;T&gt; T getChoice(Tile tile, Object explain, Nation nation, String cancelKey, List&lt;ChoiceItem&lt;T&gt;&gt; choices) {
<span class="nc" id="L996">		return canvas.showChoiceDialog(tile, explain, new ImageIcon(imageLibrary.getMiscIconImage(nation)), cancelKey,</span>
				choices);
	}

	/**
	 * General modal string input dialog.
	 *
	 * @param tile
	 *            An optional &lt;code&gt;Tile&lt;/code&gt; to expose.
	 * @param template
	 *            A &lt;code&gt;StringTemplate&lt;/code&gt; explaining the choice.
	 * @param defaultValue
	 *            The default value to show initially.
	 * @param okKey
	 *            A key for the &quot;ok&quot; button.
	 * @param cancelKey
	 *            A key for the &quot;cancel&quot; button.
	 * @return The chosen value.
	 */
	@Override
	public String getInput(Tile tile, StringTemplate template, String defaultValue, String okKey, String cancelKey) {
<span class="nc" id="L1017">		return canvas.showInputDialog(tile, template, defaultValue, okKey, cancelKey);</span>
	}

	// Trivial delegations to Canvas

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#closeMainPanel()
	 */
	@Override
	public void closeMainPanel() {
<span class="nc" id="L1029">		canvas.closeMainPanel();</span>
<span class="nc" id="L1030">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#closeMenus()
	 */
	@Override
	public void closeMenus() {
<span class="nc" id="L1039">		canvas.closeMenus();</span>
<span class="nc" id="L1040">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#closeStatusPanel()
	 */
	@Override
	public void closeStatusPanel() {
<span class="nc" id="L1049">		canvas.closeStatusPanel();</span>
<span class="nc" id="L1050">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#containsInGameComponents()
	 */
	@Override
	public boolean containsInGameComponents() {
<span class="nc" id="L1059">		return canvas.containsInGameComponents();</span>
	}

	/**
	 * Dialog remove.
	 *
	 * @param fcd
	 *            the fcd
	 */
	public void dialogRemove(FreeColDialog&lt;?&gt; fcd) {
<span class="nc" id="L1069">		canvas.dialogRemove(fcd);</span>
<span class="nc" id="L1070">	}</span>

	/**
	 * Show the appropriate panel for an object.
	 *
	 * TODO: Improve OO.
	 *
	 * @param fco
	 *            The &lt;code&gt;FreeColObject&lt;/code&gt; to display.
	 */
	public void displayObject(FreeColObject fco) {
<span class="nc bnc" id="L1081" title="All 2 branches missed.">		if (fco instanceof Colony) {</span>
<span class="nc" id="L1082">			canvas.showColonyPanel((Colony) fco, null);</span>
<span class="nc bnc" id="L1083" title="All 2 branches missed.">		} else if (fco instanceof Europe) {</span>
<span class="nc" id="L1084">			canvas.showEuropePanel();</span>
<span class="nc bnc" id="L1085" title="All 2 branches missed.">		} else if (fco instanceof IndianSettlement) {</span>
<span class="nc" id="L1086">			canvas.showIndianSettlementPanel((IndianSettlement) fco);</span>
<span class="nc bnc" id="L1087" title="All 2 branches missed.">		} else if (fco instanceof Tile) {</span>
<span class="nc" id="L1088">			setFocus((Tile) fco);</span>
<span class="nc bnc" id="L1089" title="All 2 branches missed.">		} else if (fco instanceof Unit) {</span>
<span class="nc" id="L1090">			Location loc = ((Unit) fco).up();</span>
<span class="nc bnc" id="L1091" title="All 2 branches missed.">			if (loc instanceof Colony) {</span>
<span class="nc" id="L1092">				canvas.showColonyPanel((Colony) loc, (Unit) fco);</span>
			} else {
<span class="nc" id="L1094">				displayObject((FreeColObject) loc);</span>
			}
<span class="nc bnc" id="L1096" title="All 2 branches missed.">		} else if (fco instanceof WorkLocation) {</span>
<span class="nc" id="L1097">			canvas.showColonyPanel(((WorkLocation) fco).getColony(), null);</span>
		}
<span class="nc" id="L1099">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#getLoadingSavegameInfo()
	 */
	@Override
	public LoadingSavegameInfo getLoadingSavegameInfo() {
<span class="nc" id="L1108">		return canvas.getLoadingSavegameDialog().getInfo();</span>
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#isClientOptionsDialogShowing()
	 */
	@Override
	public boolean isClientOptionsDialogShowing() {
<span class="nc bnc" id="L1118" title="All 4 branches missed.">		return canvas != null &amp;&amp; canvas.isClientOptionsDialogShowing();</span>
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#isMapboardActionsEnabled()
	 */
	@Override
	public boolean isMapboardActionsEnabled() {
<span class="nc bnc" id="L1128" title="All 4 branches missed.">		return canvas != null &amp;&amp; canvas.isMapboardActionsEnabled();</span>
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#isShowingSubPanel()
	 */
	@Override
	public boolean isShowingSubPanel() {
<span class="nc bnc" id="L1138" title="All 4 branches missed.">		return canvas != null &amp;&amp; canvas.isShowingSubPanel();</span>
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#paintImmediatelyCanvasIn(java.awt.
	 * Rectangle)
	 */
	@Override
	public void paintImmediatelyCanvasIn(Rectangle rectangle) {
<span class="nc" id="L1149">		canvas.paintImmediately(rectangle);</span>
<span class="nc" id="L1150">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#paintImmediatelyCanvasInItsBounds()
	 */
	@Override
	public void paintImmediatelyCanvasInItsBounds() {
<span class="nc" id="L1159">		canvas.paintImmediately(canvas.getBounds());</span>
<span class="nc" id="L1160">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#refreshPlayersTable()
	 */
	@Override
	public void refreshPlayersTable() {
<span class="nc" id="L1169">		canvas.refreshPlayersTable();</span>
<span class="nc" id="L1170">	}</span>

	/**
	 * Removes the from canvas.
	 *
	 * @param component
	 *            the component
	 */
	public void removeFromCanvas(Component component) {
<span class="nc" id="L1179">		canvas.remove(component);</span>
<span class="nc" id="L1180">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#removeInGameComponents()
	 */
	@Override
	public void removeInGameComponents() {
<span class="nc" id="L1189">		canvas.removeInGameComponents();</span>
<span class="nc" id="L1190">	}</span>

	/**
	 * Removes the trade route panel.
	 *
	 * @param panel
	 *            the panel
	 */
	public void removeTradeRoutePanel(TradeRoutePanel panel) {
<span class="nc" id="L1199">		canvas.removeTradeRoutePanel(panel);</span>
<span class="nc" id="L1200">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#requestFocusForSubPanel()
	 */
	@Override
	public void requestFocusForSubPanel() {
<span class="nc" id="L1209">		canvas.getShowingSubPanel().requestFocus();</span>
<span class="nc" id="L1210">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#requestFocusInWindow()
	 */
	@Override
	public boolean requestFocusInWindow() {
<span class="nc" id="L1219">		return canvas.requestFocusInWindow();</span>
	}

	/**
	 * Restore saved size.
	 *
	 * @param comp
	 *            the comp
	 * @param w
	 *            the w
	 * @param h
	 *            the h
	 */
	public void restoreSavedSize(Component comp, int w, int h) {
<span class="nc" id="L1233">		canvas.restoreSavedSize(comp, new Dimension(w, h));</span>
<span class="nc" id="L1234">	}</span>

	/**
	 * Restore saved size.
	 *
	 * @param comp
	 *            the comp
	 * @param size
	 *            the size
	 */
	public void restoreSavedSize(Component comp, Dimension size) {
<span class="nc" id="L1245">		canvas.restoreSavedSize(comp, size);</span>
<span class="nc" id="L1246">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#returnToTitle()
	 */
	@Override
	public void returnToTitle() {
<span class="nc" id="L1255">		canvas.returnToTitle();</span>
<span class="nc" id="L1256">		playSound(&quot;sound.intro.general&quot;);</span>
<span class="nc" id="L1257">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showAboutPanel()
	 */
	@Override
	public void showAboutPanel() {
<span class="nc" id="L1266">		canvas.showAboutPanel();</span>
<span class="nc" id="L1267">	}</span>

	/**
	 * Show build queue panel.
	 *
	 * @param colony
	 *            the colony
	 */
	public void showBuildQueuePanel(Colony colony) {
<span class="nc" id="L1276">		canvas.showBuildQueuePanel(colony);</span>
<span class="nc" id="L1277">	}</span>

	/**
	 * Show build queue panel.
	 *
	 * @param colony
	 *            the colony
	 * @param callBack
	 *            the call back
	 */
	public void showBuildQueuePanel(Colony colony, Runnable callBack) {
<span class="nc" id="L1288">		canvas.showBuildQueuePanel(colony, callBack);</span>
<span class="nc" id="L1289">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showCaptureGoodsDialog(net.sf.freecol.
	 * common.model.Unit, java.util.List,
	 * net.sf.freecol.client.gui.DialogHandler)
	 */
	@Override
	public void showCaptureGoodsDialog(final Unit unit, List&lt;Goods&gt; gl, DialogHandler&lt;List&lt;Goods&gt;&gt; handler) {
<span class="nc" id="L1300">		canvas.showCaptureGoodsDialog(unit, gl, handler);</span>
<span class="nc" id="L1301">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showChatPanel()
	 */
	@Override
	public void showChatPanel() {
<span class="nc" id="L1310">		canvas.showChatPanel();</span>
<span class="nc" id="L1311">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see
	 * net.sf.freecol.client.gui.GUI#showChooseFoundingFatherDialog(java.util.
	 * List, net.sf.freecol.client.gui.DialogHandler)
	 */
	@Override
	public void showChooseFoundingFatherDialog(final List&lt;FoundingFather&gt; ffs, DialogHandler&lt;FoundingFather&gt; handler) {
<span class="nc" id="L1322">		canvas.showChooseFoundingFatherDialog(ffs, handler);</span>
<span class="nc" id="L1323">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showClientOptionsDialog()
	 */
	@Override
	public void showClientOptionsDialog() {
<span class="nc" id="L1332">		OptionGroup group = null;</span>
		try {
<span class="nc" id="L1334">			group = canvas.showClientOptionsDialog();</span>
		} finally {
<span class="nc bnc" id="L1336" title="All 4 branches missed.">			if (group != null) {</span>
<span class="nc" id="L1337">				resetMenuBar();</span>
				// Immediately redraw the minimap if that was updated.
<span class="nc" id="L1339">				updateMapControls();</span>
			}
		}
<span class="nc bnc" id="L1342" title="All 2 branches missed.">		if (!freeColClient.isInGame())</span>
<span class="nc" id="L1343">			showMainPanel(null);</span>
<span class="nc" id="L1344">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see
	 * net.sf.freecol.client.gui.GUI#showForeignColony(net.sf.freecol.common.
	 * model.Settlement)
	 */
	@Override
	protected void showForeignColony(Settlement settlement) {
<span class="nc" id="L1355">		canvas.showForeignColony(settlement);</span>
<span class="nc" id="L1356">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see
	 * net.sf.freecol.client.gui.GUI#showColonyPanel(net.sf.freecol.common.model
	 * .Colony, net.sf.freecol.common.model.Unit)
	 */
	@Override
	public void showColonyPanel(Colony colony, Unit unit) {
<span class="nc" id="L1367">		canvas.showColonyPanel(colony, unit);</span>
<span class="nc" id="L1368">	}</span>

	/**
	 * Show colony panel 2.
	 *
	 * @param colony
	 *            the colony
	 * @param unit
	 *            the unit
	 * @return the colony panel
	 */
	public ColonyPanel showColonyPanel2(Colony colony, Unit unit) {
<span class="nc" id="L1380">		return canvas.showColonyPanel(colony, unit);</span>
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showColopediaPanel(java.lang.String)
	 */
	@Override
	public void showColopediaPanel(String nodeId) {
<span class="nc" id="L1390">		canvas.showColopediaPanel(nodeId);</span>
<span class="nc" id="L1391">	}</span>

	/**
	 * Show color chooser panel.
	 *
	 * @param al
	 *            the al
	 * @return the color chooser panel
	 */
	public ColorChooserPanel showColorChooserPanel(ActionListener al) {
<span class="nc" id="L1401">		return canvas.showColorChooserPanel(al);</span>
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showCompactLabourReport()
	 */
	@Override
	public void showCompactLabourReport() {
<span class="nc" id="L1411">		canvas.showCompactLabourReport();</span>
<span class="nc" id="L1412">	}</span>

	/**
	 * Show compact labour report.
	 *
	 * @param unitData
	 *            the unit data
	 */
	public void showCompactLabourReport(UnitData unitData) {
<span class="nc" id="L1421">		canvas.showCompactLabourReport(unitData);</span>
<span class="nc" id="L1422">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showDeclarationPanel()
	 */
	@Override
	public void showDeclarationPanel() {
<span class="nc" id="L1431">		canvas.showDeclarationPanel();</span>
<span class="nc" id="L1432">	}</span>

	/**
	 * Display a difficulty dialog allowing only viewing of game options.
	 *
	 * @return The resulting &lt;code&gt;OptionGroup&lt;/code&gt;.
	 */
	@Override
	public OptionGroup showDifficultyDialog() {
<span class="nc" id="L1441">		Game game = freeColClient.getGame();</span>
<span class="nc" id="L1442">		Specification spec = game.getSpecification();</span>
<span class="nc" id="L1443">		return canvas.showDifficultyDialog(spec, spec.getDifficultyOptionGroup(), false);</span>
	}

	/**
	 * Show difficulty dialog.
	 *
	 * @param spec
	 *            the spec
	 * @param group
	 *            the group
	 * @return the option group
	 */
	public OptionGroup showDifficultyDialog(Specification spec, OptionGroup group) {
<span class="nc" id="L1456">		return canvas.showDifficultyDialog(spec, group, group.isEditable());</span>
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @see
	 * net.sf.freecol.client.gui.GUI#showDumpCargoDialog(net.sf.freecol.common.
	 * model.Unit, net.sf.freecol.client.gui.DialogHandler)
	 */
	@Override
	public void showDumpCargoDialog(Unit unit, DialogHandler&lt;List&lt;Goods&gt;&gt; handler) {
<span class="nc" id="L1468">		canvas.showDumpCargoDialog(unit, handler);</span>
<span class="nc" id="L1469">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see
	 * net.sf.freecol.client.gui.GUI#showEditOptionDialog(net.sf.freecol.common.
	 * option.Option)
	 */
	@Override
	public boolean showEditOptionDialog(Option option) {
<span class="nc" id="L1480">		return canvas.showEditOptionDialog(option);</span>
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @see
	 * net.sf.freecol.client.gui.GUI#showEmigrationDialog(net.sf.freecol.common.
	 * model.Player, boolean, net.sf.freecol.client.gui.DialogHandler)
	 */
	@Override
	public void showEmigrationDialog(final Player player, final boolean fountainOfYouth,
			DialogHandler&lt;Integer&gt; handler) {
<span class="nc" id="L1493">		canvas.showEmigrationDialog(player, fountainOfYouth, handler);</span>
<span class="nc" id="L1494">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showEndTurnDialog(java.util.List,
	 * net.sf.freecol.client.gui.DialogHandler)
	 */
	@Override
	public void showEndTurnDialog(final List&lt;Unit&gt; units, DialogHandler&lt;Boolean&gt; handler) {
<span class="nc" id="L1504">		canvas.showEndTurnDialog(units, handler);</span>
<span class="nc" id="L1505">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see
	 * net.sf.freecol.client.gui.GUI#showErrorMessage(net.sf.freecol.common.
	 * model.StringTemplate)
	 */
	@Override
	public void showErrorMessage(StringTemplate template) {
<span class="nc" id="L1516">		canvas.showErrorMessage(Messages.message(template));</span>
<span class="nc" id="L1517">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showErrorMessage(java.lang.String)
	 */
	@Override
	public void showErrorMessage(String messageId) {
<span class="nc" id="L1526">		canvas.showErrorMessage(messageId);</span>
<span class="nc" id="L1527">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showErrorMessage(java.lang.String,
	 * java.lang.String)
	 */
	@Override
	public void showErrorMessage(String messageID, String message) {
<span class="nc" id="L1537">		canvas.showErrorMessage(messageID, message);</span>
<span class="nc" id="L1538">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showEuropePanel()
	 */
	@Override
	public void showEuropePanel() {
<span class="nc" id="L1547">		canvas.showEuropePanel();</span>
<span class="nc" id="L1548">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showEventPanel(java.lang.String,
	 * java.lang.String, java.lang.String)
	 */
	@Override
	public void showEventPanel(String header, String image, String footer) {
<span class="nc" id="L1558">		canvas.showEventPanel(header, image, footer);</span>
<span class="nc" id="L1559">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showFindSettlementPanel()
	 */
	@Override
	public void showFindSettlementPanel() {
<span class="nc" id="L1568">		canvas.showFindSettlementPanel();</span>
<span class="nc" id="L1569">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showGameOptionsDialog(boolean,
	 * boolean)
	 */
	@Override
	public OptionGroup showGameOptionsDialog(boolean editable, boolean custom) {
<span class="nc" id="L1579">		return canvas.showGameOptionsDialog(editable, custom);</span>
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showHighScoresPanel(java.lang.String,
	 * java.util.List)
	 */
	@Override
	public void showHighScoresPanel(String messageId, List&lt;HighScore&gt; scores) {
<span class="nc" id="L1590">		canvas.showHighScoresPanel(messageId, scores);</span>
<span class="nc" id="L1591">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see
	 * net.sf.freecol.client.gui.GUI#showIndianSettlementPanel(net.sf.freecol.
	 * common.model.IndianSettlement)
	 */
	@Override
	public void showIndianSettlementPanel(IndianSettlement indianSettlement) {
<span class="nc" id="L1602">		canvas.showIndianSettlementPanel(indianSettlement);</span>
<span class="nc" id="L1603">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see
	 * net.sf.freecol.client.gui.GUI#showInformationMessage(java.lang.String)
	 */
	@Override
	public void showInformationMessage(String messageId) {
<span class="nc" id="L1613">		super.showInformationMessage(messageId);</span>
<span class="nc" id="L1614">		canvas.showInformationMessage(null, null, null, StringTemplate.key(messageId));</span>
<span class="nc" id="L1615">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showInformationMessage(net.sf.freecol.
	 * common.model.StringTemplate)
	 */
	@Override
	public void showInformationMessage(StringTemplate template) {
<span class="nc" id="L1625">		super.showInformationMessage(template);</span>
<span class="nc" id="L1626">		canvas.showInformationMessage(null, null, null, template);</span>
<span class="nc" id="L1627">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showInformationMessage(net.sf.freecol.
	 * common.model.Settlement, net.sf.freecol.common.model.StringTemplate)
	 */
	@Override
	public void showInformationMessage(Settlement displayObject, StringTemplate template) {
<span class="nc" id="L1637">		super.showInformationMessage(displayObject, template);</span>
<span class="nc" id="L1638">		ImageIcon icon = null;</span>
<span class="nc" id="L1639">		Tile tile = null;</span>
<span class="nc bnc" id="L1640" title="All 2 branches missed.">		if (displayObject != null) {</span>
<span class="nc" id="L1641">			icon = new ImageIcon(imageLibrary.getSettlementImage(displayObject));</span>
<span class="nc" id="L1642">			tile = displayObject.getTile();</span>
		}
<span class="nc" id="L1644">		canvas.showInformationMessage(displayObject, tile, icon, template);</span>
<span class="nc" id="L1645">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showInformationMessage(net.sf.freecol.
	 * common.model.Unit, net.sf.freecol.common.model.StringTemplate)
	 */
	@Override
	public void showInformationMessage(Unit displayObject, StringTemplate template) {
<span class="nc" id="L1655">		super.showInformationMessage(displayObject, template);</span>
<span class="nc" id="L1656">		ImageIcon icon = null;</span>
<span class="nc" id="L1657">		Tile tile = null;</span>
<span class="nc bnc" id="L1658" title="All 2 branches missed.">		if (displayObject != null) {</span>
<span class="nc" id="L1659">			icon = new ImageIcon(imageLibrary.getUnitImage(displayObject));</span>
<span class="nc" id="L1660">			tile = displayObject.getTile();</span>
		}
<span class="nc" id="L1662">		canvas.showInformationMessage(displayObject, tile, icon, template);</span>
<span class="nc" id="L1663">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showInformationMessage(net.sf.freecol.
	 * common.model.Tile, net.sf.freecol.common.model.StringTemplate)
	 */
	@Override
	public void showInformationMessage(Tile displayObject, StringTemplate template) {
<span class="nc" id="L1673">		super.showInformationMessage(displayObject, template);</span>
<span class="nc" id="L1674">		canvas.showInformationMessage(displayObject, displayObject, null, template);</span>
<span class="nc" id="L1675">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showInformationMessage(net.sf.freecol.
	 * common.model.FreeColObject, java.lang.String)
	 */
	@Override
	public void showInformationMessage(FreeColObject displayObject, String messageId) {
<span class="nc" id="L1685">		super.showInformationMessage(displayObject, messageId);</span>
<span class="nc" id="L1686">		canvas.showInformationMessage(displayObject, StringTemplate.key(messageId));</span>
<span class="nc" id="L1687">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showInformationMessage(net.sf.freecol.
	 * common.model.FreeColObject, net.sf.freecol.common.model.StringTemplate)
	 */
	@Override
	public void showInformationMessage(FreeColObject displayObject, StringTemplate template) {
<span class="nc" id="L1697">		super.showInformationMessage(displayObject, template);</span>
<span class="nc" id="L1698">		canvas.showInformationMessage(displayObject, template);</span>
<span class="nc" id="L1699">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showLoadDialog(java.io.File)
	 */
	@Override
	public File showLoadDialog(File directory) {
<span class="nc" id="L1708">		return canvas.showLoadDialog(directory, null);</span>
	}

	/**
	 * Show load dialog.
	 *
	 * @param directory
	 *            the directory
	 * @param fileFilters
	 *            the file filters
	 * @return the file
	 */
	public File showLoadDialog(File directory, FileFilter[] fileFilters) {
<span class="nc" id="L1721">		return canvas.showLoadDialog(directory, fileFilters);</span>
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showLoadingSavegameDialog(boolean,
	 * boolean)
	 */
	@Override
	public boolean showLoadingSavegameDialog(boolean publicServer, boolean singlePlayer) {
<span class="nc" id="L1732">		return canvas.showLoadingSavegameDialog(publicServer, singlePlayer);</span>
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showLogFilePanel()
	 */
	@Override
	public void showLogFilePanel() {
<span class="nc" id="L1742">		canvas.showLogFilePanel();</span>
<span class="nc" id="L1743">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showMainPanel(java.lang.String)
	 */
	@Override
	public void showMainPanel(String userMsg) {
<span class="nc" id="L1752">		canvas.showMainPanel(userMsg);</span>
<span class="nc" id="L1753">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showMapGeneratorOptionsDialog(boolean)
	 */
	@Override
	public OptionGroup showMapGeneratorOptionsDialog(boolean editable) {
<span class="nc" id="L1762">		return canvas.showMapGeneratorOptionsDialog(editable);</span>
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showMapSizeDialog()
	 */
	@Override
	public Dimension showMapSizeDialog() {
<span class="nc" id="L1772">		return canvas.showMapSizeDialog();</span>
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showModelMessages(java.util.List)
	 */
	@Override
	public void showModelMessages(List&lt;ModelMessage&gt; modelMessages) {
<span class="nc" id="L1782">		canvas.showModelMessages(modelMessages);</span>
<span class="nc" id="L1783">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see
	 * net.sf.freecol.client.gui.GUI#showMonarchDialog(net.sf.freecol.common.
	 * model.Monarch.MonarchAction, net.sf.freecol.common.model.StringTemplate,
	 * java.lang.String, net.sf.freecol.client.gui.DialogHandler)
	 */
	@Override
	public void showMonarchDialog(final MonarchAction action, StringTemplate template, String monarchKey,
			DialogHandler&lt;Boolean&gt; handler) {
<span class="nc" id="L1796">		canvas.showMonarchDialog(action, template, monarchKey, handler);</span>
<span class="nc" id="L1797">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see
	 * net.sf.freecol.client.gui.GUI#showNamingDialog(net.sf.freecol.common.
	 * model.StringTemplate, java.lang.String, net.sf.freecol.common.model.Unit,
	 * net.sf.freecol.client.gui.DialogHandler)
	 */
	@Override
	public void showNamingDialog(StringTemplate template, final String defaultName, final Unit unit,
			DialogHandler&lt;String&gt; handler) {
<span class="nc" id="L1810">		canvas.showNamingDialog(template, defaultName, unit, handler);</span>
<span class="nc" id="L1811">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showFirstContactDialog(net.sf.freecol.
	 * common.model.Player, net.sf.freecol.common.model.Player,
	 * net.sf.freecol.common.model.Tile, int,
	 * net.sf.freecol.client.gui.DialogHandler)
	 */
	@Override
	public void showFirstContactDialog(final Player player, final Player other, final Tile tile, int settlementCount,
			DialogHandler&lt;Boolean&gt; handler) {
<span class="nc" id="L1824">		canvas.showFirstContactDialog(player, other, tile, settlementCount, handler);</span>
<span class="nc" id="L1825">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see
	 * net.sf.freecol.client.gui.GUI#showNegotiationDialog(net.sf.freecol.common
	 * .model.FreeColGameObject, net.sf.freecol.common.model.FreeColGameObject,
	 * net.sf.freecol.common.model.DiplomaticTrade,
	 * net.sf.freecol.common.model.StringTemplate)
	 */
	@Override
	public DiplomaticTrade showNegotiationDialog(FreeColGameObject our, FreeColGameObject other,
			DiplomaticTrade agreement, StringTemplate comment) {
<span class="nc" id="L1839">		return canvas.showNegotiationDialog(our, other, agreement, comment);</span>
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showNewPanel()
	 */
	@Override
	public void showNewPanel() {
<span class="nc" id="L1849">		canvas.showNewPanel(null);</span>
<span class="nc" id="L1850">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see
	 * net.sf.freecol.client.gui.GUI#showNewPanel(net.sf.freecol.common.model.
	 * Specification)
	 */
	@Override
	public void showNewPanel(Specification specification) {
<span class="nc" id="L1861">		canvas.showNewPanel(specification);</span>
<span class="nc" id="L1862">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see
	 * net.sf.freecol.client.gui.GUI#showSpyColonyPanel(net.sf.freecol.common.
	 * model.Tile, java.lang.Runnable)
	 */
	@Override
	public void showSpyColonyPanel(final Tile tile, Runnable callback) {
<span class="nc" id="L1873">		ColonyPanel panel = canvas.showSpyColonyPanel(tile);</span>
<span class="nc" id="L1874">		panel.addClosingCallback(callback);</span>
<span class="nc" id="L1875">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showParametersDialog()
	 */
	@Override
	public Parameters showParametersDialog() {
<span class="nc" id="L1884">		return canvas.showParametersDialog();</span>
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @see
	 * net.sf.freecol.client.gui.GUI#showPreCombatDialog(net.sf.freecol.common.
	 * model.Unit, net.sf.freecol.common.model.FreeColGameObject,
	 * net.sf.freecol.common.model.Tile)
	 */
	@Override
	public boolean showPreCombatDialog(Unit attacker, FreeColGameObject defender, Tile tile) {
<span class="nc" id="L1897">		return canvas.showPreCombatDialog(attacker, defender, tile);</span>
	}

	/**
	 * Show purchase panel.
	 */
	public void showPurchasePanel() {
<span class="nc" id="L1904">		canvas.showPurchasePanel();</span>
<span class="nc" id="L1905">	}</span>

	/**
	 * Show recruit panel.
	 */
	public void showRecruitPanel() {
<span class="nc" id="L1911">		canvas.showRecruitPanel();</span>
<span class="nc" id="L1912">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showReportCargoPanel()
	 */
	@Override
	public void showReportCargoPanel() {
<span class="nc" id="L1921">		canvas.showReportCargoPanel();</span>
<span class="nc" id="L1922">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showReportColonyPanel()
	 */
	@Override
	public void showReportColonyPanel() {
<span class="nc" id="L1931">		canvas.showReportColonyPanel();</span>
<span class="nc" id="L1932">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showReportContinentalCongressPanel()
	 */
	@Override
	public void showReportContinentalCongressPanel() {
<span class="nc" id="L1941">		canvas.showReportContinentalCongressPanel();</span>
<span class="nc" id="L1942">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showReportEducationPanel()
	 */
	@Override
	public void showReportEducationPanel() {
<span class="nc" id="L1951">		canvas.showReportEducationPanel();</span>
<span class="nc" id="L1952">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showReportExplorationPanel()
	 */
	@Override
	public void showReportExplorationPanel() {
<span class="nc" id="L1961">		canvas.showReportExplorationPanel();</span>
<span class="nc" id="L1962">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showReportForeignAffairPanel()
	 */
	@Override
	public void showReportForeignAffairPanel() {
<span class="nc" id="L1971">		canvas.showReportForeignAffairPanel();</span>
<span class="nc" id="L1972">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showReportHistoryPanel()
	 */
	@Override
	public void showReportHistoryPanel() {
<span class="nc" id="L1981">		canvas.showReportHistoryPanel();</span>
<span class="nc" id="L1982">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showReportIndianPanel()
	 */
	@Override
	public void showReportIndianPanel() {
<span class="nc" id="L1991">		canvas.showReportIndianPanel();</span>
<span class="nc" id="L1992">	}</span>

	/**
	 * Show report labour detail panel.
	 *
	 * @param unitType
	 *            the unit type
	 * @param data
	 *            the data
	 * @param unitCount
	 *            the unit count
	 * @param colonies
	 *            the colonies
	 */
	public void showReportLabourDetailPanel(UnitType unitType, Map&lt;UnitType, Map&lt;Location, Integer&gt;&gt; data,
			TypeCountMap&lt;UnitType&gt; unitCount, List&lt;Colony&gt; colonies) {
<span class="nc" id="L2008">		canvas.showReportLabourDetailPanel(unitType, data, unitCount, colonies);</span>
<span class="nc" id="L2009">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showReportLabourPanel()
	 */
	@Override
	public void showReportLabourPanel() {
<span class="nc" id="L2018">		canvas.showReportLabourPanel();</span>
<span class="nc" id="L2019">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showReportMilitaryPanel()
	 */
	@Override
	public void showReportMilitaryPanel() {
<span class="nc" id="L2028">		canvas.showReportMilitaryPanel();</span>
<span class="nc" id="L2029">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showReportNavalPanel()
	 */
	@Override
	public void showReportNavalPanel() {
<span class="nc" id="L2038">		canvas.showReportNavalPanel();</span>
<span class="nc" id="L2039">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showReportProductionPanel()
	 */
	@Override
	public void showReportProductionPanel() {
<span class="nc" id="L2048">		canvas.showReportProductionPanel();</span>
<span class="nc" id="L2049">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showReportReligiousPanel()
	 */
	@Override
	public void showReportReligiousPanel() {
<span class="nc" id="L2058">		canvas.showReportReligiousPanel();</span>
<span class="nc" id="L2059">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showReportRequirementsPanel()
	 */
	@Override
	public void showReportRequirementsPanel() {
<span class="nc" id="L2068">		canvas.showReportRequirementsPanel();</span>
<span class="nc" id="L2069">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showReportTradePanel()
	 */
	@Override
	public void showReportTradePanel() {
<span class="nc" id="L2078">		canvas.showReportTradePanel();</span>
<span class="nc" id="L2079">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showReportTurnPanel(java.util.List)
	 */
	@Override
	public void showReportTurnPanel(List&lt;ModelMessage&gt; messages) {
<span class="nc" id="L2088">		canvas.showReportTurnPanel(messages);</span>
<span class="nc" id="L2089">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showSaveDialog(java.io.File,
	 * java.lang.String)
	 */
	@Override
	public File showSaveDialog(File directory, String defaultName) {
<span class="nc" id="L2099">		return canvas.showSaveDialog(directory, null, defaultName);</span>
	}

	/**
	 * Show save dialog.
	 *
	 * @param directory
	 *            the directory
	 * @param fileFilters
	 *            the file filters
	 * @param defaultName
	 *            the default name
	 * @return the file
	 */
	public File showSaveDialog(File directory, FileFilter[] fileFilters, String defaultName) {
<span class="nc" id="L2114">		return canvas.showSaveDialog(directory, fileFilters, defaultName);</span>
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showScaleMapSizeDialog()
	 */
	@Override
	public Dimension showScaleMapSizeDialog() {
<span class="nc" id="L2124">		return canvas.showScaleMapSizeDialog();</span>
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showSelectAmountDialog(net.sf.freecol.
	 * common.model.GoodsType, int, int, boolean)
	 */
	@Override
	public int showSelectAmountDialog(GoodsType goodsType, int available, int defaultAmount, boolean needToPay) {
<span class="nc" id="L2135">		return canvas.showSelectAmountDialog(goodsType, available, defaultAmount, needToPay);</span>
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showSelectTributeAmountDialog(net.sf.
	 * freecol.common.model.StringTemplate, int)
	 */
	@Override
	public int showSelectTributeAmountDialog(StringTemplate question, int maximum) {
<span class="nc" id="L2146">		return canvas.showSelectTributeAmountDialog(question, maximum);</span>
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @see
	 * net.sf.freecol.client.gui.GUI#showSelectDestinationDialog(net.sf.freecol.
	 * common.model.Unit)
	 */
	@Override
	public Location showSelectDestinationDialog(Unit unit) {
<span class="nc" id="L2158">		return canvas.showSelectDestinationDialog(unit);</span>
	}

	/**
	 * Show server list panel.
	 *
	 * @param serverList
	 *            the server list
	 */
	public void showServerListPanel(List&lt;ServerInfo&gt; serverList) {
<span class="nc" id="L2168">		canvas.showServerListPanel(serverList);</span>
<span class="nc" id="L2169">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see
	 * net.sf.freecol.client.gui.GUI#showStartGamePanel(net.sf.freecol.common.
	 * model.Game, net.sf.freecol.common.model.Player, boolean)
	 */
	@Override
	public void showStartGamePanel(Game game, Player player, boolean singlePlayerMode) {
<span class="nc" id="L2180">		canvas.showStartGamePanel(game, player, singlePlayerMode);</span>
<span class="nc" id="L2181">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showStatisticsPanel()
	 */
	@Override
	public void showStatisticsPanel() {
<span class="nc" id="L2190">		canvas.showStatisticsPanel();</span>
<span class="nc" id="L2191">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showStatusPanel(java.lang.String)
	 */
	@Override
	public void showStatusPanel(String message) {
<span class="nc" id="L2200">		canvas.showStatusPanel(message);</span>
<span class="nc" id="L2201">	}</span>

	/**
	 * Show tile panel.
	 *
	 * @param tile
	 *            the tile
	 */
	public void showTilePanel(Tile tile) {
<span class="nc" id="L2210">		canvas.showTilePanel(tile);</span>
<span class="nc" id="L2211">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#showTilePopUpAtSelectedTile()
	 */
	@Override
	public void showTilePopUpAtSelectedTile() {
<span class="nc" id="L2220">		Tile tile = mapViewer.getSelectedTile();</span>
<span class="nc" id="L2221">		Point point = mapViewer.calculateTilePosition(tile);</span>
<span class="nc" id="L2222">		canvas.showTilePopup(tile, point.x + mapViewer.getTileWidth(), point.y);</span>
<span class="nc" id="L2223">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see
	 * net.sf.freecol.client.gui.GUI#showTradeRoutePanel(net.sf.freecol.common.
	 * model.Unit)
	 */
	@Override
	public void showTradeRoutePanel(Unit unit) {
<span class="nc" id="L2234">		canvas.showTradeRoutePanel(unit);</span>
<span class="nc" id="L2235">	}</span>

	/**
	 * Show trade route input panel.
	 *
	 * @param newRoute
	 *            the new route
	 * @param callBack
	 *            the call back
	 */
	public void showTradeRouteInputPanel(TradeRoute newRoute, Runnable callBack) {
<span class="nc" id="L2246">		canvas.showTradeRouteInputPanel(newRoute, callBack);</span>
<span class="nc" id="L2247">	}</span>

	/**
	 * Show train panel.
	 */
	public void showTrainPanel() {
<span class="nc" id="L2253">		canvas.showTrainPanel();</span>
<span class="nc" id="L2254">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see
	 * net.sf.freecol.client.gui.GUI#showVictoryDialog(net.sf.freecol.client.gui
	 * .DialogHandler)
	 */
	@Override
	public void showVictoryDialog(DialogHandler&lt;Boolean&gt; handler) {
<span class="nc" id="L2265">		canvas.showVictoryDialog(handler);</span>
<span class="nc" id="L2266">	}</span>

	/**
	 * Show warehouse dialog.
	 *
	 * @param colony
	 *            the colony
	 * @return true, if successful
	 */
	public boolean showWarehouseDialog(Colony colony) {
<span class="nc" id="L2276">		return canvas.showWarehouseDialog(colony);</span>
	}

	/**
	 * Show work production panel.
	 *
	 * @param unit
	 *            the unit
	 */
	public void showWorkProductionPanel(Unit unit) {
<span class="nc" id="L2286">		canvas.showWorkProductionPanel(unit);</span>
<span class="nc" id="L2287">	}</span>

	/**
	 * Update european subpanels.
	 */
	public void updateEuropeanSubpanels() {
<span class="nc" id="L2293">		canvas.updateEuropeanSubpanels();</span>
<span class="nc" id="L2294">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#updateGameOptions()
	 */
	@Override
	public void updateGameOptions() {
<span class="nc" id="L2303">		canvas.updateGameOptions();</span>
<span class="nc" id="L2304">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#updateMapGeneratorOptions()
	 */
	@Override
	public void updateMapGeneratorOptions() {
<span class="nc" id="L2313">		canvas.updateMapGeneratorOptions();</span>
<span class="nc" id="L2314">	}</span>

	// Trivial delegations to MapViewer

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#centerActiveUnit()
	 */
	@Override
	public void centerActiveUnit() {
<span class="nc" id="L2325">		mapViewer.centerActiveUnit();</span>
<span class="nc" id="L2326">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#changeViewMode(int)
	 */
	@Override
	public void changeViewMode(int newViewMode) {
<span class="nc" id="L2335">		mapViewer.changeViewMode(newViewMode);</span>
<span class="nc" id="L2336">	}</span>

	/**
	 * Calculate unit label position in tile.
	 *
	 * @param labelWidth
	 *            the label width
	 * @param labelHeight
	 *            the label height
	 * @param tileP
	 *            the tile P
	 * @return the point
	 */
	public Point calculateUnitLabelPositionInTile(int labelWidth, int labelHeight, Point tileP) {
<span class="nc" id="L2350">		return mapViewer.calculateUnitLabelPositionInTile(labelWidth, labelHeight, tileP);</span>
	}

	/**
	 * Execute with unit out for animation.
	 *
	 * @param unit
	 *            the unit
	 * @param sourceTile
	 *            the source tile
	 * @param r
	 *            the r
	 */
	public void executeWithUnitOutForAnimation(final Unit unit, final Tile sourceTile,
			final OutForAnimationCallback r) {
<span class="nc" id="L2365">		mapViewer.executeWithUnitOutForAnimation(unit, sourceTile, r);</span>
<span class="nc" id="L2366">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#getActiveUnit()
	 */
	@Override
	public Unit getActiveUnit() {
<span class="nc bnc" id="L2375" title="All 2 branches missed.">		return mapViewer == null ? null : mapViewer.getActiveUnit();</span>
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#getFocus()
	 */
	@Override
	public Tile getFocus() {
<span class="nc" id="L2385">		return mapViewer.getFocus();</span>
	}

	/**
	 * Gets the map scale.
	 *
	 * @return the map scale
	 */
	public float getMapScale() {
<span class="nc" id="L2394">		return mapViewer.getImageLibrary().getScaleFactor();</span>
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#getSelectedTile()
	 */
	@Override
	public Tile getSelectedTile() {
<span class="nc" id="L2404">		return mapViewer.getSelectedTile();</span>
	}

	/**
	 * Gets the tile bounds.
	 *
	 * @param tile
	 *            the tile
	 * @return the tile bounds
	 */
	public Rectangle getTileBounds(Tile tile) {
<span class="nc" id="L2415">		return mapViewer.calculateTileBounds(tile);</span>
	}

	/**
	 * Gets the tile position.
	 *
	 * @param tile
	 *            the tile
	 * @return the tile position
	 */
	public Point getTilePosition(Tile tile) {
<span class="nc" id="L2426">		return mapViewer.calculateTilePosition(tile);</span>
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#getViewMode()
	 */
	@Override
	public int getViewMode() {
<span class="nc" id="L2436">		return mapViewer.getViewMode();</span>
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @see
	 * net.sf.freecol.client.gui.GUI#setFocus(net.sf.freecol.common.model.Tile)
	 */
	@Override
	public void setFocus(Tile tileToFocus) {
<span class="nc" id="L2447">		mapViewer.setFocus(tileToFocus);</span>
<span class="nc" id="L2448">		canvas.refresh();</span>
<span class="nc" id="L2449">	}</span>

	/**
	 * Sets the focus immediately.
	 *
	 * @param tileToFocus
	 *            the new focus immediately
	 */
	public void setFocusImmediately(Tile tileToFocus) {
<span class="nc" id="L2458">		mapViewer.setFocus(tileToFocus);</span>
<span class="nc" id="L2459">		Dimension size = canvas.getSize();</span>
<span class="nc" id="L2460">		canvas.paintImmediately(0, 0, size.width, size.height);</span>
<span class="nc" id="L2461">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see
	 * net.sf.freecol.client.gui.GUI#setSelectedTile(net.sf.freecol.common.model
	 * .Tile)
	 */
	@Override
	public boolean setSelectedTile(Tile newTileToSelect) {
<span class="nc" id="L2472">		boolean result = mapViewer.setSelectedTile(newTileToSelect);</span>
<span class="nc" id="L2473">		updateMapControls();</span>
<span class="nc" id="L2474">		updateMenuBar();</span>
<span class="nc" id="L2475">		return result;</span>
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @see net.sf.freecol.client.gui.GUI#toggleViewMode()
	 */
	@Override
	public void toggleViewMode() {
<span class="nc" id="L2485">		mapViewer.toggleViewMode();</span>
<span class="nc" id="L2486">	}</span>

	// Forwarding to tileViewer

	/**
	 * Creates the tile image with overlay and forest.
	 *
	 * @param type
	 *            the type
	 * @param size
	 *            the size
	 * @return the buffered image
	 */
	public static BufferedImage createTileImageWithOverlayAndForest(TileType type, Dimension size) {
<span class="nc" id="L2500">		return TileViewer.createTileImageWithOverlayAndForest(type, size);</span>
	}

	/**
	 * Creates the tile image with beach border and items.
	 *
	 * @param tile
	 *            the tile
	 * @return the buffered image
	 */
	public BufferedImage createTileImageWithBeachBorderAndItems(Tile tile) {
<span class="nc" id="L2511">		return tileViewer.createTileImageWithBeachBorderAndItems(tile);</span>
	}

	/**
	 * Creates the tile image.
	 *
	 * @param tile
	 *            the tile
	 * @return the buffered image
	 */
	public BufferedImage createTileImage(Tile tile) {
<span class="nc" id="L2522">		return tileViewer.createTileImage(tile);</span>
	}

	/**
	 * Creates the colony tile image.
	 *
	 * @param tile
	 *            the tile
	 * @param colony
	 *            the colony
	 * @return the buffered image
	 */
	public BufferedImage createColonyTileImage(Tile tile, Colony colony) {
<span class="nc" id="L2535">		return tileViewer.createColonyTileImage(tile, colony);</span>
	}

	/**
	 * Display colony tiles.
	 *
	 * @param g
	 *            the g
	 * @param tiles
	 *            the tiles
	 * @param colony
	 *            the colony
	 */
	public void displayColonyTiles(Graphics2D g, Tile[][] tiles, Colony colony) {
<span class="nc" id="L2549">		tileViewer.displayColonyTiles(g, tiles, colony);</span>
<span class="nc" id="L2550">	}</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span></div></body></html>